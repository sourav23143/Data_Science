(function(g){var window=this;'use strict';var wdJ=function(Y){var u=new g.B5("und",new g.lj("Default","und",!0));u.captionTracks=Y.captionTracks;return u},W5J=function(Y){return new g.cB(function(u,n){var U=Y.length,k=[];
if(U)for(var m=function(f,Q){U--;k[f]=Q;U==0&&u(k)},X=function(f){n(f)},S,C=0;C<Y.length;C++)S=Y[C],g.zBY(S,g.QC(m,C),X);
else u(k)})},W$=function(Y){this.K=Y},eT=function(){W$.apply(this,arguments)},eFB=function(){eT.apply(this,arguments)},btg=function(){eT.apply(this,arguments)},IM$=function(){eT.apply(this,arguments)},zFy=function(){eT.apply(this,arguments)},gVG=function(){eT.apply(this,arguments)},EV$=function(){eT.apply(this,arguments)},HtB=function(){eT.apply(this,arguments)},yJg=function(){W$.apply(this,arguments)},VC$=function(){eT.apply(this,arguments)},OtX=function(){eT.apply(this,arguments)},F5y=function(){eT.apply(this,
arguments)},JJJ=function(){eT.apply(this,arguments)},qhg=function(){eT.apply(this,arguments)},aMB=function(){eT.apply(this,arguments)},$SL=function(){eT.apply(this,arguments)},YsX=function(){eT.apply(this,arguments)},usg=function(){eT.apply(this,arguments)},nyq=function(){eT.apply(this,arguments)},UYG=function(){eT.apply(this,arguments)},kyB=function(){eT.apply(this,arguments)},mYq=function(){W$.apply(this,arguments)},XmR=function(){eT.apply(this,arguments)},Pry=function(){eT.apply(this,arguments)},
Ssu=function(){eT.apply(this,arguments)},Cr$=function(){eT.apply(this,arguments)},fkq=function(){eT.apply(this,arguments)},QFq=function(){eT.apply(this,arguments)},Ne$=function(){eT.apply(this,arguments)},ix$=function(){eT.apply(this,arguments)},ZxC=function(){eT.apply(this,arguments)},Te$=function(){W$.apply(this,arguments)},rpR=function(){W$.apply(this,arguments)},Maq=function(){W$.apply(this,arguments)},sFX=function(){eT.apply(this,arguments)},dYX=function(){eT.apply(this,arguments)},GyR=function(){eT.apply(this,
arguments)},ApC=function(){eT.apply(this,arguments)},jFX=function(){eT.apply(this,arguments)},KvQ=function(){eT.apply(this,arguments)},pmG=function(){eT.apply(this,arguments)},LvX=function(){eT.apply(this,arguments)},taL=function(){eT.apply(this,arguments)},Beg=function(){eT.apply(this,arguments)},oyG=function(){eT.apply(this,arguments)},cpR=function(){eT.apply(this,arguments)},vyX=function(){eT.apply(this,arguments)},RIX=function(){eT.apply(this,arguments)},DY$=function(){eT.apply(this,arguments)},
xY$=function(){eT.apply(this,arguments)},lk$=function(){eT.apply(this,arguments)},hIQ=function(){eT.apply(this,arguments)},wm$=function(){eT.apply(this,arguments)},Wv$=function(){eT.apply(this,arguments)},eIR=function(){eT.apply(this,arguments)},bxg=function(){eT.apply(this,arguments)},Ik$=function(){eT.apply(this,arguments)},zIX=function(){eT.apply(this,arguments)},gyJ=function(){eT.apply(this,arguments)},Ey$=function(){eT.apply(this,arguments)},Hx$=function(){eT.apply(this,arguments)},yp$=function(){W$.apply(this,
arguments)},VaQ=function(){eT.apply(this,arguments)},Ox$=function(){eT.apply(this,arguments)},FvQ=function(){eT.apply(this,arguments)},JpB=function(){eT.apply(this,arguments)},qsB=function(){eT.apply(this,arguments)},ak$=function(){eT.apply(this,arguments)},$YC=function(){eT.apply(this,arguments)},Y6$=function(){eT.apply(this,arguments)},uZ$=function(){eT.apply(this,arguments)},n1u=function(){eT.apply(this,arguments)},UEq=function(){eT.apply(this,arguments)},kEy=function(){eT.apply(this,arguments)},
mEq=function(){eT.apply(this,arguments)},XBq=function(){eT.apply(this,arguments)},PsX=function(){eT.apply(this,arguments)},S6B=function(){eT.apply(this,arguments)},CsL=function(){eT.apply(this,arguments)},fe$=function(){eT.apply(this,arguments)},Q1q=function(){eT.apply(this,arguments)},NrG=function(){eT.apply(this,arguments)},iHy=function(){eT.apply(this,arguments)},ZH$=function(){eT.apply(this,arguments)},Trq=function(){eT.apply(this,arguments)},rHy=function(){eT.apply(this,arguments)},MdC=function(){eT.apply(this,
arguments)},s1$=function(){eT.apply(this,arguments)},dE$=function(){eT.apply(this,arguments)},GE$=function(){eT.apply(this,arguments)},AHg=function(){eT.apply(this,arguments)},j1y=function(){eT.apply(this,arguments)},KiC=function(){eT.apply(this,arguments)},pBQ=function(){eT.apply(this,arguments)},LiB=function(){eT.apply(this,arguments)},tdC=function(Y){Y=Y.key||Y.id;
if(!Y)throw Error("Entity key is missing");return Y},BrG=function(){if(bM)return bM();
var Y={};bM=g.FQ("PersistentEntityStoreDb",{CQ:(Y.EntityStore={aA:1},Y.EntityAssociationStore={aA:2},Y),shared:!1,upgrade:function(u,n){n(1)&&g.vF(g.pX(u,"EntityStore",{keyPath:"key"}),"entityType","entityType");n(2)&&(u=g.pX(u,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.vF(u,"byParentEntityKey","parentEntityKey"),g.vF(u,"byChildEntityKey","childEntityKey"))},
version:3});return bM()},o1C=function(Y){return g.e2(BrG(),Y)},cHC=function(Y){return g.e2((0,g.NA$)(),Y)},Iq=function(Y){this.token=Y},zJ=function(Y,u){u=u===void 0?{}:u;
g.zP.call(this,g.iPg[Y],Object.assign({},{name:"PESEncoderError",type:Y},u));this.type=Y;this.level="WARNING";Object.setPrototypeOf(this,zJ.prototype)},v1g=function(Y){return new zJ("WRONG_DATA_TYPE",{Y4:Y})},Rd$=function(Y){return Y instanceof Error?new zJ("UNKNOWN_ENCODE_ERROR",{originalMessage:Y.message}):new zJ("UNKNOWN_ENCODE_ERROR")},DEQ=function(Y){return Y instanceof Error?new zJ("UNKNOWN_DECODE_ERROR",{originalMessage:Y.message}):new zJ("UNKNOWN_DECODE_ERROR")},xEq=function(Y,u){Y=Y instanceof
zJ?Y:u(Y);
g.tl(Y);throw Y;},leg=function(){},hdJ=function(Y,u,n){try{return Y.X(u,n)}catch(U){xEq(U,Rd$)}},wBQ=function(Y){Y=(new TextEncoder).encode(Y).subarray(0,16);
var u=new Uint8Array(16);u.set(Y);return u},g4=function(Y){this.K=Y},edg=function(Y){var u=Wiu[Y];
if(u)return u;g.Br(new g.zP("Entity model not found.",{entityType:Y}))},bHy=function(Y,u){this.K=Y;
this.j=u;this.X={}},zdB=function(Y,u){a:{Y=Ieq(Y.j,u.version);
try{var n=Y.j(u.data,u.key);break a}catch(U){xEq(U,DEQ)}n=void 0}return n},EG=function(Y,u,n){return Y.K.objectStore("EntityStore").get(u).then(function(U){if(U){if(n&&U.entityType!==n)throw Error("Incorrect entity type");
return zdB(Y,U)}})},H$=function(Y,u,n){return n?(n=n.map(function(U){return EG(Y,U,u)}),g.s$.all(n)):Y.K.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(u)).then(function(U){return U.map(function(k){return zdB(Y,k)})})},VI=function(Y,u,n){var U=tdC(u),k=Ieq(Y.j,1),m=Object.assign({},u);
return Y.K.objectStore("EntityStore").get(U).then(function(X){if(X){if(X.entityType!==n)throw Error("Incorrect entity type");m.entityMetadata||(X=zdB(Y,X),m.entityMetadata=X.entityMetadata)}}).then(function(){var X={key:U,
entityType:n,data:hdJ(k,m,U),version:1};return g.s$.all([g.BF(Y.K.objectStore("EntityStore"),X),g1J(Y,m,n)])}).then(function(){yI(Y,U,n);
return U})},E1C=function(Y,u,n){u=u.map(function(U){return VI(Y,U,n)});
return g.s$.all(u)},OG=function(Y,u,n){if(n==null?0:n.Q5){var U=new Set;
return HH$(Y,u,U).then(function(){for(var m=[],X=g.A(U),S=X.next();!S.done;S=X.next())m.push(OG(Y,S.value));return g.s$.all(m).then(function(){})})}var k=g.Vw(u).entityType;
return g.s$.all([Y.K.objectStore("EntityStore").delete(u),yH$(Y,u)]).then(function(){yI(Y,u,k)})},VdR=function(Y,u){return g.lU(Y.K.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(u)},function(n){return g.s$.all([n.delete(),
yH$(Y,n.cursor.primaryKey)]).then(function(){yI(Y,n.cursor.primaryKey,u);return g.D0(n)})})},OHq=function(Y,u,n,U){var k=Ieq(Y.j,1);
return EG(Y,u,U).then(function(m){if(m){m=g.Y9(m,n);var X={key:u,entityType:U,data:hdJ(k,m,u),version:1};return g.s$.all([g.BF(Y.K.objectStore("EntityStore"),X),g1J(Y,m,U)])}}).then(function(){yI(Y,u,U);
return u})},yI=function(Y,u,n){var U=Y.X[n];
U||(U=new Set,Y.X[n]=U);U.add(u)},FiC=function(Y,u,n){var U=tdC(u);
n=edg(n);if(!n)return g.s$.resolve([]);n=new n(u);Y=Y.K.objectStore("EntityAssociationStore");u=[];n=g.A(n.j());for(var k=n.next();!k.done;k=n.next())u.push(g.BF(Y,{parentEntityKey:U,childEntityKey:k.value}));return g.s$.all(u).then(function(m){return m.map(function(X){return X[1]})})},yH$=function(Y,u){return Y.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(u))},g1J=function(Y,u,n){var U=tdC(u);
return yH$(Y,U).then(function(){return FiC(Y,u,n)})},HH$=function(Y,u,n){if(n.has(u))return g.s$.resolve(void 0);
n.add(u);return JH$(Y,u).then(function(U){return Y.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(u)).then(function(){return U})}).then(function(U){var k=g.s$.resolve(void 0);
U=g.A(U);for(var m=U.next(),X={};!m.done;X={aT:void 0},m=U.next())X.aT=m.value,k=k.then(function(S){return function(){return HH$(Y,S.aT,n)}}(X));
return k}).then(function(){})},JH$=function(Y,u){var n=Y.K.objectStore("EntityAssociationStore");
return n.index("byParentEntityKey").getAll(IDBKeyRange.only(u)).then(function(U){var k=[];U=g.A(U);for(var m=U.next();!m.done;m=U.next())m=m.value,k.push(n.index("byChildEntityKey").getAll(m.childEntityKey));return g.s$.all(k)}).then(function(U){var k=[];
U=g.A(U);for(var m=U.next();!m.done;m=U.next())m=m.value,m.length===1&&k.push(m[0].childEntityKey);return k})},Fq=function(){},q6Q=function(){this.K={};
this.K[0]=new Fq;if(!g.rL("aes_pes_encoder_killswitch")){var Y=this.K;try{var u=g.gT();var n=wBQ(u);var U=new g4(new g.SI(n),new g.Cm(n))}catch(k){throw Y=k instanceof Error?new zJ("KEY_CREATION_FAILED",{originalMessage:k.message}):new zJ("KEY_CREATION_FAILED"),g.tl(Y),Y;}Y[1]=U}},Ieq=function(Y,u){u=u===void 0?0:u;
Y=Y.K[u];if(!Y)throw u=new zJ("INVALID_ENCODER_VERSION",{Y4:u}),g.tl(u),u;return Y},JN=function(Y,u){g.e.call(this);
this.token=Y;this.K=u;this.observers=[];Y=new g.$e.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.gT());Y.onmessage=this.j.bind(this);this.channel=Y},q$=function(Y,u,n){var U,k,m,X;
return g.l(function(S){if(S.j==1)return g.D(S,o1C(Y.token),2);if(S.j!=3)return U=S.K,g.D(S,g.tE(U,["EntityStore","EntityAssociationStore"],u,function(C){k=new bHy(C,Y.K);return n(k)}),3);
m=S.K;k&&(X=k.X,Object.keys(X).length>0&&(Y.channel.postMessage(X),aeG(Y,X)));return S.return(m)})},aq=function(Y,u,n){return q$(Y,{mode:"readwrite",
A_:!0},function(U){return VI(U,u,n)})},$ER=function(Y,u){return q$(Y,{mode:"readwrite",
A_:!0},function(n){return E1C(n,u,"offlineOrchestrationActionWrapperEntity")})},YvR=function(Y,u){return q$(Y,{mode:"readwrite",
A_:!0},function(n){return OG(n,u)})},uSR=function(Y){return q$(Y,{mode:"readwrite",
A_:!0},function(u){return VdR(u,"videoPlaybackPositionEntity")})},$M=function(Y,u,n){return q$(Y,{mode:"readonly",
A_:!0},function(U){return EG(U,u,n)})},Yx=function(Y,u,n){return q$(Y,{mode:"readonly",
A_:!0},function(U){return H$(U,u,n)})},aeG=function(Y,u){Y=g.A(Y.observers);
for(var n=Y.next();!n.done;n=Y.next())n=n.value,n(u)},nW$=function(){var Y,u,n;
return g.l(function(U){if(U.j==1)return g.pY(U,2),g.D(U,g.VK(),4);if(U.j!=2){Y=U.K;if(!Y||!g.E2()||typeof g.$e.BroadcastChannel==="undefined")return U.return();u=new q6Q;return U.return(new JN(Y,u))}n=g.vc(U);n instanceof Error&&g.tl(n);return U.return()})},uP=function(){Uv$||(Uv$=nW$());
return Uv$},ksX=function(Y){var u;
Y=(u=Y.options)==null?void 0:u.persistenceOption;return Y==="ENTITY_PERSISTENCE_OPTION_PERSIST"||Y==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},mvC=function(Y){var u;
return g.l(function(n){return n.j==1?g.D(n,uP(),2):(u=n.K)?g.D(n,q$(u,"readwrite",function(U){for(var k={},m=g.A(Y),X=m.next(),S={};!X.done;S={OT:void 0,Ok:void 0},X=m.next())S.OT=X.value,S.OT.entityKey&&ksX(S.OT)&&(S.Ok=g.UF(S.OT.payload),X=void 0,S.OT.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(X=function(C){return function(){return VI(U,C.OT.payload[C.Ok],C.Ok)}}(S)),S.OT.type==="ENTITY_MUTATION_TYPE_DELETE"&&(X=function(C){return function(){return OG(U,C.OT.entityKey)}}(S)),S.OT.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(X=function(C){return function(){return OHq(U,C.OT.entityKey,C.OT.payload[C.Ok],C.Ok)}}(S)),X&&(k[S.OT.entityKey]=k[S.OT.entityKey]?k[S.OT.entityKey].then(X):X()));
return g.s$.all(Object.values(k))}),0):n.return()})},XgG=function(Y){var u;
return g.l(function(n){if(n.j==1){u=Y.mutations;if(!u||u.length<=0)return n.return();if(g.B2){var U={type:"ENTITY_LOADED"};u!==void 0&&(U.payload=u);g.B2.dispatch(U)}return g.D(n,mvC(u),2)}u.length=0;g.KY(n)})},PJX=function(Y){return Y!==void 0},Svu=function(Y){var u=g.UZ();
u=Object.assign({},u);Y=Object.assign({},Y);for(var n in u)Y[n]?(u[n]!==4&&(u[n]=Y[n]),delete Y[n]):u[n]!==2&&(u[n]=4);Object.assign(u,Y);g.bUM(u);JSON.stringify(u);return u},CJy=function(Y){var u,n;
return g.l(function(U){if(U.j==1)return g.D(U,g.VK(),2);if(U.j!=3)return(u=U.K)?g.D(U,g.X_(u),3):U.return();n=U.K;return U.return(g.tE(n,["index","media","captions"],{mode:"readwrite",A_:!0},function(k){var m=IDBKeyRange.bound(Y+"|",Y+"~");k=[k.objectStore("index").delete(m),k.objectStore("media").delete(m),k.objectStore("captions").delete(m)];return g.s$.all(k).then(function(){})}))})},fbq=function(){var Y,u;
return g.l(function(n){if(n.j==1)return g.D(n,g.VK(),2);if(n.j!=3){Y=n.K;if(!Y)throw g.rD("rvdfd");return g.D(n,g.X_(Y),3)}u=n.K;return n.return(g.tE(u,["index","media"],{mode:"readwrite",A_:!0},function(U){var k={};return g.RR(U.objectStore("index"),{},function(m){var X=m.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),S=g.s$.resolve(void 0);if(X){var C=X[1];X=X[2];k[C]=k[C]||{};var f;k[C][X]=g.HU7((f=m.getValue())==null?void 0:f.fmts)}else S=m.delete().then(function(){});
return g.s$.all([g.D0(m),S]).then(function(Q){return g.A(Q).next().value})}).then(function(){for(var m={},X=g.A(Object.keys(k)),S=X.next();!S.done;S=X.next()){S=S.value;
var C=k[S].v;m[S]=k[S].a&&C?1:2}var f=Svu(m);return g.KJB(U.objectStore("media"),{},function(Q){var N=Q.cursor.key.match(g.FuS);N&&m[N[1]]||U.objectStore("media").delete(Q.cursor.key);return g.ZpY(Q)}).then(function(){return f})})}))})},QSQ=function(Y,u){var n,U;
return g.l(function(k){if(k.j==1)return g.D(k,g.VK(),2);if(k.j!=3){n=k.K;if(!n)throw g.rD("wct");return g.D(k,g.X_(n),3)}U=k.K;return g.D(k,g.tE(U,["captions"],{mode:"readwrite",A_:!0},function(m){var X=[];m=m.objectStore("captions");for(var S=0;S<u.length;S++){var C=g.BF(m,u[S],Y+"|"+u[S].metadata.vss_id);X.push(C)}return g.s$.all(X)}),0)})},NjR=function(Y){var u,n,U;
return g.l(function(k){if(k.j==1)return u=IDBKeyRange.bound(Y+"|",Y+"~"),g.D(k,g.VK(),2);if(k.j!=3){n=k.K;if(!n)throw g.rD("gactfv");return g.D(k,g.X_(n),3)}U=k.K;return k.return(U.getAll("captions",u))})},iJL=function(Y){return g.l(function(u){g.mS(Y,0);
return u.return(CJy(Y))})},ZJX=function(Y){return{context:g.yj(),
videoIds:Y}},TjL=function(Y){return{context:g.yj(),
playlistIds:Y}},rtB=function(Y){return{context:g.yj(),
offlinePlaylistSyncChecks:Y}},MeB=function(){this.K=new Map},dvX=function(){sSq||(sSq=new MeB);
return sSq},GsB=function(Y,u){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:Y},metadata:u,statusCode:void 0,csn:void 0,can:void 0}},AtX=function(Y,u,n){if(!n){var U=U===void 0?!1:U;
n=Y.K.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!n||U)n=g.TS(16),Y.K.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",n)}Y={flowNonce:n,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:u.eventType};u.metadata&&(Y.flowMetadata=u.metadata);u.statusCode!==void 0&&(Y.flowEventStatus=u.statusCode);u.csn&&(Y.csn=u.csn);u.can&&(Y.can=u.can);g.ka("flowEvent",Y,void 0)},jSu=function(Y){var u,n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0,SM,CY,uB,cc,J7,uQ,sq,CR,Du,XH,Wu,Hu,Pq,v,IK;
return g.l(function(x$){if(x$.j==1)return g.D(x$,q$(Y,{mode:"readonly",A_:!0},function(Uu){return H$(Uu,"playbackData").then(function(ty){var p=ty.map(function(z$){return z$.transfer}).filter(function(z$){return!!z$}),nY=ty.map(function(z$){return z$.offlineVideoPolicy}).filter(function(z$){return!!z$}),Dn=ty.filter(function(z$){return!!z$.key}).map(function(z$){return g.OV(g.Vw(z$.key).entityId,"downloadStatusEntity")});
p=H$(Uu,"transfer",p);nY=H$(Uu,"offlineVideoPolicy",nY);Dn=H$(Uu,"downloadStatusEntity",Dn);var Cu=p.then(function(z$){z$=z$.reduce(function(Ou,Uq){(Uq==null?0:Uq.offlineVideoStreams)&&Ou.push.apply(Ou,g.Zu(Uq.offlineVideoStreams));return Ou},[]).filter(function(Ou){return!!Ou});
return H$(Uu,"offlineVideoStreams",z$)});
return g.s$.all([p,nY,Cu,Dn]).then(function(z$){var Ou=g.A(z$);z$=Ou.next().value;var Uq=Ou.next().value;var nu=Ou.next().value;Ou=Ou.next().value;return[ty,z$,Uq,nu,Ou]})})}),2);
if(x$.j!=3)return u=x$.K,g.D(x$,q$(Y,{mode:"readonly",A_:!0},function(Uu){return H$(Uu,"mainDownloadsListEntity").then(function(ty){var p,nY;return(nY=(p=ty[0])==null?void 0:p.downloads)!=null?nY:[]})}),3);
n=x$.K;U=g.A(u);k=U.next().value;m=U.next().value;X=U.next().value;S=U.next().value;C=U.next().value;f=k;Q=m;N=X;Z=S;T=C;r={};K={};L={};R={};c={};x=[];W=g.A(Q);for(E=W.next();!E.done;E=W.next())(J=E.value)&&(r[J.key]=J);O=g.A(N);for(Xd=O.next();!Xd.done;Xd=O.next())(T0=Xd.value)&&(K[T0.key]=T0);SM=g.A(T);for(CY=SM.next();!CY.done;CY=SM.next())(uB=CY.value)&&(L[uB.key]=uB);cc=g.A(Z);for(J7=cc.next();!J7.done;J7=cc.next())(uQ=J7.value)&&(R[uQ.key]=uQ);sq=g.A(n);for(CR=sq.next();!CR.done;CR=sq.next())Du=
CR.value,XH=void 0,c[(XH=Du.videoItem)!=null?XH:""]=!0,Du.videoItem&&(Hu=Wu=void 0,Pq=(Hu=(Wu=g.Vw(Du.videoItem))==null?void 0:Wu.entityId)!=null?Hu:"",x.push({externalVideoId:Pq}));v=f.filter(function(Uu){if(!Uu||!Uu.key||!Uu.offlineVideoPolicy)return!1;Uu=g.Vw(Uu.key).entityId;Uu=g.OV(Uu,"downloadStatusEntity");var ty;return!(Uu&&((ty=L[Uu])==null?void 0:ty.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
IK=v.map(function(Uu){var ty=r[Uu.transfer],p=[];if(ty==null?0:ty.offlineVideoStreams)for(var nY=g.A(ty.offlineVideoStreams),Dn=nY.next();!Dn.done;Dn=nY.next())(Dn=R[Dn.value])&&p.push(Dn);nY=K[Uu.offlineVideoPolicy];Dn=c;var Cu=Uu==null?void 0:Uu.playerResponseTimestamp,z$=g.Vw(nY.key).entityId;Uu=g.OV(z$,"mainVideoEntity");if(nY.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Ou="OFFLINE_VIDEO_STATE_DISABLED";nY.expirationTimestamp&&Number(nY.expirationTimestamp)<Date.now()/1E3&&(Ou="OFFLINE_VIDEO_STATE_EXPIRED")}else if(nY.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Ou="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(ty==null?void 0:ty.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Ou="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Ou="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Ou="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Ou="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Ou="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Ou="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Ou="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Ou==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(ty==null?void 0:ty.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Ou="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Ou="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Ou=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}z$={id:z$,videoState:Ou};if(ty==null?0:ty.cotn)z$.cotn=ty.cotn;if(ty==null?0:ty.maximumDownloadQuality)z$.selectedVideoQuality=ty==null?void 0:ty.maximumDownloadQuality;if(ty==null?0:ty.lastProgressTimeMs)z$.lastProgressTimeMs=ty.lastProgressTimeMs;Cu&&(z$.playerResponseSavedTimeMs=String(Number(Cu)*1E3));ty=String;Cu=0;p=g.A(p);for(Ou=p.next();!Ou.done;Ou=p.next())if(Ou=Ou.value,Ou.streamsProgress){Ou=g.A(Ou.streamsProgress);for(var Uq=Ou.next();!Uq.done;Uq=Ou.next()){var nu=
void 0;Cu+=Number((nu=Uq.value.numBytesDownloaded)!=null?nu:0)}}z$.downloadedBytes=ty(Cu);z$.selectedOfflineMode=Dn[Uu]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";nY.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(z$.offlinePlaybackDisabledReason=nY.offlinePlaybackDisabledReason);return z$});
return x$.return({offlineVideos:IK,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:x}}})})},KMq=function(){this.locks=navigator.locks},pgL=function(){try{var Y=g.nR("ytglobal.locks_");
if(Y)return Y;var u;if(u=navigator){var n=navigator;u="locks"in n&&!!n.locks}if(u)return g.$e.localStorage&&g.$e.localStorage.getItem("noop"),Y=new KMq,g.Y$("ytglobal.locks_",Y),Y}catch(U){}},nl=function(){},LMq=function(){},teu=function(Y){if(Y.includes(":"))throw Error("Invalid user cache name: "+Y);
return Y+":"+g.gT("CacheStorage get")},BjB=function(){return g.l(function(Y){if(UB!==void 0)return Y.return(UB);
UB=new Promise(function(u){var n;return g.l(function(U){switch(U.j){case 1:return g.pY(U,2),g.D(U,kx.open("test-only"),4);case 4:return g.D(U,kx.delete("test-only"),5);case 5:g.Bc(U,3);break;case 2:if(n=g.vc(U),n instanceof Error&&n.name==="SecurityError")return u(!1),U.return();case 3:u("caches"in window),g.KY(U)}})});
return Y.return(UB)})},ctu=function(){return g.l(function(Y){if(Y.j==1)return g.D(Y,BjB(),2);
if(!Y.K)return Y.return(void 0);oW$||(oW$=new LMq);return Y.return(oW$)})},m6=function(Y,u,n){g.Br(new g.zP("Woffle: "+Y,n?{cotn:n}:""));
u instanceof Error&&g.Br(u)},vWJ=function(Y){var u;
return g.l(function(n){if(n.j==1)return g.D(n,jSu(Y),2);u=n.K;g.ka("offlineStateSnapshot",u);g.KY(n)})},XW=function(Y){g.e.call(this);
var u=this;this.api=Y;this.IH={Y1G:function(){return u.K},
X3q:function(){return u.j}};
typeof g.$e.BroadcastChannel!=="undefined"&&(this.K=new g.$e.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.gT()),this.K.onmessage=this.X.bind(this),this.j=new g.$e.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.gT()),this.j.onmessage=this.G.bind(this))},P8=function(Y,u){Y.api.Yw("onOfflineOperationFailure",u);
var n;(n=Y.K)==null||n.postMessage(u)},RxC=function(Y,u,n){var U=this;
this.Z=Y;this.N=u;this.visibility=n;this.J=this.S=this.W=this.X=this.K=!1;this.G=new g.Vp(function(){U.Af()});
this.IH={Nf:function(){return U.j},
Af:function(){U.Af()},
LOG:function(){return U.G}};
this.visibility.subscribe("visibilitystatechange",function(){U.ke()})},Dvy=function(Y){if(!Y.X&&!Y.K){var u=pgL();
if(u){Y.X=!0;var n=g.gT("OfflineLockManager");u.request("woffle_orchestration_leader:"+n,{},function(){var U,k;return g.l(function(m){switch(m.j){case 1:return g.pY(m,2),Y.j=new g.Nv,Y.K=!0,Y.X=!1,g.D(m,Y.Z(),4);case 4:return g.D(m,Y.j.promise,5);case 5:g.Bc(m,0);break;case 2:U=g.vc(m),Y.Af(),U instanceof Error&&(k=U,k.args=[{name:"WoLockManagerError",vF:U.name}],g.tl(k)),g.KY(m)}})})}}},xvB=function(Y){Y.K&&(Y.J=!0,S7(Y))},lbg=function(Y,u){Y.K&&(Y.W=u,S7(Y))},hxq=function(Y,u){Y.K&&(Y.S=u,S7(Y))},
S7=function(Y){Y.S&&Y.W&&Y.J&&Y.visibility.isBackground()?g.OQ(Y.G,6E4):Y.G.stop()},Cl=function(Y){var u;
Y.offlineDeleteReason=(u=Y.offlineDeleteReason)!=null?u:"OFFLINE_DELETE_REASON_UNKNOWN";var n;Y.offlineModeType=(n=Y.offlineModeType)!=null?n:"OFFLINE_NOW";g.ka("offlineDeleteEvent",Y)},fl=function(Y,u){var n=u.videoId;
var U=u.kO;u=u.offlineModeType;Y.encryptedVideoId=n;Y.cotn=U==null?void 0:U.cotn;Y.offlineabilityFormatType=U==null?void 0:U.maximumDownloadQuality;var k;Y.isRefresh=(k=U==null?void 0:U.isRefresh)!=null?k:!1;var m;Y.softErrorCount=(m=U==null?void 0:U.transferRetryCount)!=null?m:0;Y.offlineModeType=u!=null?u:"OFFLINE_NOW";(Y.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&Y.statusType==="UNKNOWN_STATUS_TYPE"||!Y.transferStatusType&&!Y.statusType)&&g.Br(Error("Woffle unknown transfer status"));
g.ka("offlineTransferStatusChanged",Y)},wgX=function(Y){fl({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},Y)},WMu=function(Y,u,n,U){U={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!U};u&&n&&(u=Math.floor(u/1024).toFixed(),n=Math.floor(n/1024).toFixed(),U.alreadyDownloadedKbytes=u,U.totalFetchedKbytes=u,U.totalContentKbytes=n);fl(U,Y)},exQ=function(Y){fl({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},Y)},bJC=function(Y){fl({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},Y)},IbR=function(Y){switch(Y){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
QJ=function(Y){var u,n,U;
return((U=(u=Y.actionMetadata)==null?void 0:(n=u.retryScheduleIntervalsInSeconds)==null?void 0:n.length)!=null?U:0)>0},Np=function(Y){return Y.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!Y.entityKey},iP=function(Y){return Y.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!Y.entityKey},Z6=function(Y){return Y.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!Y.entityKey},zxg=function(Y){return Y.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!Y.entityKey},
TX=function(Y,u,n,U,k){k=k===void 0?!1:k;
var m,X,S,C,f,Q;return g.l(function(N){if(N.j==1)return m=g.OV(Y,u),X=g.OV(Y,"downloadStatusEntity"),g.D(N,q$(n,{mode:"readonly",A_:!0},function(Z){return g.s$.all([EG(Z,m,u),EG(Z,X,"downloadStatusEntity")])}),2);
S=N.K;C=S.length?S[0]:void 0;if(!C)return N.qF(0);f=gWR;if(Q=S.length>1?S[1]:void 0){if(Q.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!k)return N.return();Q.downloadState=U}else Q={key:X,downloadState:U};g.DI(C,f,Q);return g.D(N,q$(n,{mode:"readwrite",A_:!0},function(Z){return g.s$.all([VI(Z,C,u),VI(Z,Q,"downloadStatusEntity")])}),0)})},rv=function(Y,u){return Y.actionType===u.actionType&&Y.entityKey===u.entityKey},Mp=function(Y,u){if(Y&&Y.transferState!=="TRANSFER_STATE_COMPLETE"&&Y.transferState!==
"TRANSFER_STATE_FAILED"){var n=g.Vw(Y.key).entityId;
fl({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:n,kO:Y,offlineModeType:u})}},sB=function(Y){if(!Y||!Y.thumbnails)return[];
var u=[];Y=g.A(Y.thumbnails);for(var n=Y.next();!n.done;n=Y.next())n=n.value,n.url&&u.push(n.url);return u},EWu=function(Y,u,n){n=n===void 0?[]:n;
var U,k,m,X,S,C,f,Q,N,Z,T,r,K;return g.l(function(L){if(L.j==1)return n.length?g.D(L,Yx(Y,u),2):L.return([]);U=L.K;k=new Set;m=g.A(U);for(X=m.next();!X.done;X=m.next())if(S=X.value,C=S.id||S.key)f=g.Vw(C).entityId,k.add(f);Q=[];N=g.A(n);for(Z=N.next();!Z.done;Z=N.next())T=Z.value,r=T.offlineVideoData,K=void 0,((K=r)==null?0:K.videoId)&&!k.has(r.videoId)&&Q.push(T);return L.return(Q)})},HJu=function(Y,u,n){return new g.sZ(Y,{cotn:u,
raw_player_response:n,download_media:!0,start:Infinity,disable_watch_next:!0})},ytG=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},dv=function(Y,u,n,U,k,m,X,S,C,f,Q){this.entityType=Y;
this.actionId=u;this.action=n;this.parentActionId=U;this.rootActionId=k===void 0?u:k;this.childActionIds=m;this.prereqActionId=X;this.postreqActionIds=S;this.hasChildActionFailed=f;this.retryScheduleIndex=0;this.K=Q||Date.now();this.retryScheduleIndex=C||0},GX=function(Y){if(!Y.key)throw Error("Entity key is required.");
if(!Y.actionProto)throw Error("OfflineOrchestrationAction is required.");var u=g.Vw(Y.key),n=g.Vw(Y.actionProto.entityKey);return new dv(n.entityType,u.entityId,Y.actionProto,Y.parentActionId,Y.rootActionId,Y.childActionIds,Y.prereqActionId,Y.postreqActionIds,Y.retryScheduleIndex,Y.hasChildActionFailed,Number(Y.enqueueTimeSec)*1E3)},AK=function(Y){return{key:g.OV(Y.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:Y.action,parentActionId:Y.parentActionId,rootActionId:Y.rootActionId,childActionIds:Y.childActionIds,prereqActionId:Y.prereqActionId,postreqActionIds:Y.postreqActionIds,retryScheduleIndex:Y.retryScheduleIndex,hasChildActionFailed:Y.hasChildActionFailed,enqueueTimeSec:(Y.K/1E3).toFixed()}},Veq=function(){var Y;
return g.l(function(u){return u.j==1?g.D(u,ctu(),2):(Y=u.K)?u.return(Y.delete("yt-player-local-img")):u.return(!0)})},j7=function(Y){var u,n;
return g.l(function(U){if(U.j==1)return g.D(U,ctu(),2);if(U.j!=3){u=U.K;if(!u)throw Error("Cache API not supported");return Y.length?g.D(U,u.open("yt-player-local-img"),3):U.return()}n=U.K;return g.D(U,Promise.all(Y.map(function(k){return n.delete(k)})),0)})},Kl=function(Y){var u,n;
return g.l(function(U){if(U.j==1)return g.D(U,ctu(),2);if(U.j!=3){u=U.K;if(!u)throw Error("Cache API not supported");return Y.length?g.D(U,u.open("yt-player-local-img"),3):U.return()}n=U.K;return g.D(U,n.addAll(Y),0)})},pl=function(Y,u,n,U,k){var m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0,SM,CY,uB,cc,J7,uQ,sq,CR,Du,XH;
return g.l(function(Wu){switch(Wu.j){case 1:return m=g.OV(Y,"mainVideoEntity"),X=g.OV(Y,"ytMainChannelEntity"),S=g.OV(Y,"transfer"),C=g.OV(Y,"videoDownloadContextEntity"),g.D(Wu,q$(u,{mode:"readonly",A_:!0},function(Hu){return g.s$.all([EG(Hu,m,"mainVideoEntity"),EG(Hu,X,"ytMainChannelEntity"),EG(Hu,S,"transfer"),EG(Hu,C,"videoDownloadContextEntity"),H$(Hu,"ytMainChannelEntity"),H$(Hu,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:f=Wu.K;Q=g.A(f);N=Q.next().value;Z=Q.next().value;T=Q.next().value;r=Q.next().value;K=Q.next().value;L=Q.next().value;R=N;c=Z;x=T;W=r;E=K;J=L;if(!R&&!c){Wu.qF(3);break}O=R?sB(R.thumbnail):[];if(!c){Xd=[];Wu.qF(4);break}return g.D(Wu,OJ$(c,E),5);case 5:Xd=Wu.K;case 4:return T0=Xd,g.D(Wu,j7(O.concat(T0)),3);case 3:SM=[];CY=g.OV(Y,"downloadStatusEntity");uB=g.A(J);for(cc=uB.next();!cc.done;cc=uB.next())J7=cc.value,uQ=g.Vw(J7.key).entityId,sq=GX(J7),CR=g.Vw(sq.action.entityKey).entityId,uQ!==Y&&
CR!==Y||rv(n,J7.actionProto)||SM.push(J7.key);return g.D(Wu,q$(u,{mode:"readwrite",A_:!0},function(Hu){var Pq=SM.map(function(v){return OG(Hu,v)});
Pq.push(OG(Hu,m,{Q5:!0}));Pq.push(OG(Hu,CY,{Q5:!0}));return g.s$.all(Pq)}),7);
case 7:XH=(Du=W)==null?void 0:Du.offlineModeType,k&&(Cl(k),k.offlineModeType&&(XH=k.offlineModeType)),Mp(x,XH),P8(U,{entityKey:m,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.KY(Wu)}})},qvL=function(Y,u,n,U){var k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0,SM,CY,uB,cc,J7,uQ,sq,CR,Du,XH,Wu,Hu,Pq,v,IK,x$,Uu,ty,p,nY,Dn,Cu,z$,Ou,Uq,nu,zd,t;
return g.l(function(G){switch(G.j){case 1:return k=g.OV(Y,"mainPlaylistEntity"),m=g.OV(Y,"ytMainChannelEntity"),g.D(G,q$(u,{mode:"readonly",A_:!0},function(B){return g.s$.all([EG(B,k,"mainPlaylistEntity"),EG(B,m,"ytMainChannelEntity"),H$(B,"mainPlaylistEntity"),H$(B,"mainDownloadsListEntity"),H$(B,"ytMainChannelEntity"),H$(B,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:X=G.K;S=g.A(X);C=S.next().value;f=S.next().value;Q=S.next().value;N=S.next().value;Z=S.next().value;T=S.next().value;r=C;K=f;L=Q;R=N;c=Z;x=T;if(!r&&!K){G.qF(3);break}W=r?FMq(r):[];if(!K){E=[];G.qF(4);break}return g.D(G,OJ$(K,c),5);case 5:E=G.K;case 4:return J=E,g.D(G,j7(W.concat(J)),3);case 3:O=[];Xd=new Map;if(!r){G.qF(7);break}return g.D(G,JtC(r,L,R),8);case 8:O=G.K;T0=g.A(O);for(SM=T0.next();!SM.done;SM=T0.next())CY=SM.value,Xd.set(CY,{videoId:CY,playlistId:Y,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.D(G,q$(u,{mode:"readonly",A_:!0},function(B){return g.s$.all([H$(B,"transfer"),H$(B,"videoDownloadContextEntity")])}),9);
case 9:uB=G.K;cc=g.A(uB);J7=cc.next().value;uQ=cc.next().value;sq=J7;CR=uQ;Du=g.A(sq);for(XH=Du.next();!XH.done;XH=Du.next())Wu=XH.value,Hu=g.Vw(Wu.key).entityId,(Pq=Xd.get(Hu))&&Wu&&(Pq.cotn=Wu.cotn);v=g.A(CR);for(IK=v.next();!IK.done;IK=v.next())x$=IK.value,Uu=g.Vw(x$.key).entityId,(ty=Xd.get(Uu))&&x$&&(ty.offlineModeType=x$.offlineModeType);case 7:p=[];nY=g.A(x);for(Dn=nY.next();!Dn.done;Dn=nY.next())Cu=Dn.value,z$=g.Vw(Cu.key).entityId,Ou=GX(Cu),z$!==Y&&Ou.rootActionId!==Y||rv(n,Cu.actionProto)||
p.push(Cu.key);Uq=g.OV(Y,"mainPlaylistEntity");return g.D(G,q$(u,{mode:"readwrite",A_:!0},function(B){var h=p.map(function(I){return OG(B,I)});
h.push(OG(B,Uq,{Q5:!0}));return g.s$.all(h)}),10);
case 10:if(!r){G.qF(0);break}O.reverse();if(!O){G.qF(0);break}nu=g.A(O);zd=nu.next();case 13:if(zd.done){G.qF(0);break}t=zd.value;return g.D(G,pl(t,u,n,U,Xd.get(t)),14);case 14:zd=nu.next(),G.qF(13)}})},$vJ=function(Y,u,n,U){var k,m,X,S,C,f,Q,N,Z;
return g.l(function(T){if(T.j==1)return k=g.OV("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),m=new Map,g.D(T,q$(Y,{mode:"readwrite",A_:!0},function(r){var K=H$(r,"transfer"),L=H$(r,"offlineOrchestrationActionWrapperEntity"),R=H$(r,"videoDownloadContextEntity"),c=EG(r,k,"mainDownloadsListEntity");return g.s$.all([K,L,R,c]).then(function(x){x=g.A(x);var W=x.next().value;var E=x.next().value;var J=x.next().value;var O=x.next().value;x=abg.map(function(T0){return VdR(r,T0)});
E=g.A(E);for(var Xd=E.next();!Xd.done;Xd=E.next())Xd=Xd.value,rv(u,Xd.actionProto)||x.push(OG(r,Xd.key,{Q5:!0}));O&&(O.downloads=[],x.push(VI(r,O,"mainDownloadsListEntity")));if(J)for(J=g.A(J),O=J.next();!O.done;O=J.next())O=O.value,E=g.Vw(O.key).entityId,E=g.OV(E,"transfer"),m.set(E,O.offlineModeType);return g.s$.all(x).then(function(){return W})})}),2);
X=T.K;S=g.A(X);for(C=S.next();!C.done;C=S.next())f=C.value,Mp(f,m.get(f.key)),Q=g.Vw(f.key).entityId,N={videoId:Q,offlineDeleteReason:U,cotn:f.cotn,offlineModeType:m.get(f.key)},Cl(N),Z=g.OV(Q,"mainVideoEntity"),P8(n,{entityKey:Z,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.D(T,Veq(),0)})},FMq=function(Y,u){var n=[];
if(Y.thumbnailStyleData){Y=g.A(Y.thumbnailStyleData);for(var U=Y.next();!U.done;U=Y.next()){var k=void 0,m=void 0,X=void 0;n=n.concat(sB((k=U.value)==null?void 0:(m=k.value)==null?void 0:(X=m.collageThumbnail)==null?void 0:X.coverThumbnail))}}u=sB(u);return n.concat(u)},JtC=function(Y,u,n){var U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0;
return g.l(function(SM){U=[];k=new Set;if(n.length)for(m=g.A(n),X=m.next();!X.done;X=m.next())if(S=X.value,C=void 0,(C=S.downloads)==null?0:C.length)for(f=g.A(S.downloads),Q=f.next();!Q.done;Q=f.next())N=Q.value,N.videoItem&&(Z=g.Vw(N.videoItem).entityId,k.add(Z));if(Y.videos){T=g.A(Y.videos);for(r=T.next();!r.done;r=T.next())K=r.value,L=JSON.parse(g.Vw(K).entityId),L.videoId&&!k.has(L.videoId)&&U.push(L.videoId);R=g.A(u);for(c=R.next();!c.done;c=R.next())if(x=c.value,x.key!==Y.key&&(W=x.videos))for(E=
g.A(W),J=E.next();!J.done;J=E.next())O=J.value,Xd=JSON.parse(g.Vw(O).entityId),Xd.videoId&&(T0=U.indexOf(Xd.videoId),T0!==-1&&U.splice(T0,1))}return SM.return(U)})},OJ$=function(Y,u){var n,U,k,m,X,S,C,f;
return g.l(function(Q){n=sB(Y.avatar);U=g.A(u);for(k=U.next();!k.done;k=U.next())if(m=k.value,m.id!==Y.id)for(X=g.A(sB(m.avatar)),S=X.next();!S.done;S=X.next())C=S.value,f=n.indexOf(C),f!==-1&&n.splice(f,1);return Q.return(n)})},YQC=function(Y){var u;
return g.l(function(n){u=g.z(Y.frameworkUpdates,Ll);return Y.frameworkUpdates&&u?g.D(n,XgG(u),0):n.return()})},n8$=function(Y){var u;
if((u=Y.onResponseReceivedActions)!=null&&u.length){var n;Y=(n=g.z(g.z(Y.onResponseReceivedActions[0],uDQ),g.PNB))==null?void 0:n.actions;if(Y!=null&&Y.length)return Y}},Usg=function(Y){var u,n,U;
return g.l(function(k){if(k.j==1)return Y?g.D(k,$M(Y,g.IM,"mainDownloadsListEntity"),2):k.return([]);u=k.K;return((n=u)==null?0:(U=n.downloads)==null?0:U.length)?k.return(u.downloads.map(function(m){var X;return(X=m.videoItem)!=null?X:""})):k.return([])})},msu=function(Y,u){var n;
return g.l(function(U){return U.j==1?g.D(U,kLL(Y,u),2):(n=U.K)?g.D(U,q$(Y,{mode:"readwrite",A_:!0},function(k){var m=[VI(k,n.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];n.mainDownloadsListEntity&&m.push(VI(k,n.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.s$.all(m)}),0):U.qF(0)})},kLL=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x;
return g.l(function(W){if(W.j==1)return n=g.OV("main_downloads_library_id","mainDownloadsLibraryEntity"),U=g.OV("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.D(W,q$(Y,{mode:"readonly",A_:!0},function(E){return g.s$.all([EG(E,n,"mainDownloadsLibraryEntity"),EG(E,U,"mainDownloadsListEntity")])}),2);
k=W.K;m=g.A(k);X=m.next().value;S=m.next().value;C=X;f=S;C||(C={id:n});Q=g.A(u);for(N=Q.next();!N.done;N=Q.next())if(Z=N.value,Z===g.IM){if(C.smartDownloadsList)return W.return();C.smartDownloadsList=Z}else if(T=g.Vw(Z).entityType,r={},T==="mainPlaylistEntity"?r.playlistItem=Z:T==="mainVideoEntity"&&(r.videoItem=Z),!g.i4(r)){K=void 0;if((K=f)==null?0:K.downloads){L=!1;R=g.A(f.downloads);for(c=R.next();!c.done;c=R.next())if(x=c.value,x.playlistItem===Z||x.videoItem===Z){L=!0;break}L||f.downloads.push(r)}else f=
{id:U,downloads:[r]};C.downloadsList=U}return W.return({mainDownloadsLibraryEntity:C,mainDownloadsListEntity:f})})},XAX=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L;
return g.l(function(R){if(R.j==1)return n=g.OV("main_downloads_library_id","mainDownloadsLibraryEntity"),U=g.OV("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.D(R,q$(Y,{mode:"readonly",A_:!0},function(c){return g.s$.all([EG(c,n,"mainDownloadsLibraryEntity"),EG(c,U,"mainDownloadsListEntity"),EG(c,g.IM,"mainDownloadsListEntity")])}),2);
k=R.K;m=g.A(k);X=m.next().value;S=m.next().value;C=m.next().value;f=X;Q=S;N=C;if(!f)return R.qF(0);if(u===g.IM&&((Z=N)==null?0:Z.downloads))N.downloads=[];else if((T=Q)==null?0:T.downloads)for(r=g.Vw(u).entityType,K=0;K<Q.downloads.length;K++)if(L=Q.downloads[K],r==="mainVideoEntity"&&L.videoItem===u){Q.downloads.splice(K,1);break}else if(r==="mainPlaylistEntity"&&L.playlistItem===u){Q.downloads.splice(K,1);break}return g.D(R,q$(Y,{mode:"readwrite",A_:!0},function(c){var x=[VI(c,f,"mainDownloadsLibraryEntity")];
Q&&x.push(VI(c,Q,"mainDownloadsListEntity"));N&&x.push(VI(c,N,"mainDownloadsListEntity"));return g.s$.all(x)}),0)})},tK=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z;
return g.l(function(T){if(T.j==1)return n=g.OV(u,"transfer"),U=g.OV(u,"videoDownloadContextEntity"),g.D(T,q$(Y,{mode:"readonly",A_:!0},function(r){return g.s$.all([EG(r,n,"transfer"),EG(r,U,"videoDownloadContextEntity")])}),2);
k=T.K;m=g.A(k);X=m.next().value;S=m.next().value;C=X;f=S;Z={videoId:u,cotn:(Q=C)==null?void 0:Q.cotn,offlineModeType:(N=f)==null?void 0:N.offlineModeType};return T.return(Z)})},B8=function(Y,u,n,U,k){var m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd;
return g.l(function(T0){switch(T0.j){case 1:return m=g.OV(Y,"musicTrack"),X=g.OV(Y,"transfer"),g.D(T0,q$(u,{mode:"readonly",A_:!0},function(SM){return g.s$.all([EG(SM,m,"musicTrack"),EG(SM,X,"transfer"),H$(SM,"musicTrack"),H$(SM,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:S=T0.K;C=g.A(S);f=C.next().value;Q=C.next().value;N=C.next().value;Z=C.next().value;T=f;r=Q;K=N;L=Z;if(!T){T0.qF(3);break}return g.D(T0,PkL(T,K),4);case 4:return R=T0.K,g.D(T0,j7(R),3);case 3:c=[];x=g.A(L);for(W=x.next();!W.done;W=x.next())E=W.value,J=g.Vw(E.key).entityId,O=GX(E),Xd=g.Vw(O.action.entityKey).entityId,J!==Y&&Xd!==Y||rv(n,E.actionProto)||c.push(E.key);return g.D(T0,q$(u,{mode:"readwrite",A_:!0},function(SM){var CY=c.map(function(uB){return OG(SM,uB)});
CY.push(OG(SM,m,{Q5:!0}));return g.s$.all(CY)}),6);
case 6:Mp(r),k&&Cl(k),P8(U,{entityKey:m,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.KY(T0)}})},oy=function(Y,u,n,U,k){var m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0,SM,CY,uB,cc,J7,uQ,sq,CR,Du,XH,Wu,Hu,Pq,v,IK;
return g.l(function(x$){switch(x$.j){case 1:return m=g.OV(Y,u),X=g.OV("music_downloads_library_id","musicDownloadsLibraryEntity"),g.D(x$,q$(n,{mode:"readonly",A_:!0},function(Uu){return g.s$.all([EG(Uu,m,u),EG(Uu,X,"musicDownloadsLibraryEntity"),H$(Uu,u),H$(Uu,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:S=x$.K;C=g.A(S);f=C.next().value;Q=C.next().value;N=C.next().value;Z=C.next().value;T=f;r=Q;K=N;L=Z;if(!T){x$.qF(3);break}return g.D(x$,PkL(T,K),4);case 4:return R=x$.K,g.D(x$,j7(R),3);case 3:c=[];x=new Map;if(!T){x$.qF(6);break}return g.D(x$,SQX(T,K,r),7);case 7:c=x$.K;W=g.A(c);for(E=W.next();!E.done;E=W.next())J=E.value,O=g.Vw(J).entityId,x.set(O,{videoId:O,playlistId:Y,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.D(x$,Yx(n,"transfer"),8);case 8:for(Xd=x$.K,T0=
g.A(Xd),SM=T0.next();!SM.done;SM=T0.next())CY=SM.value,uB=g.Vw(CY.key).entityId,(cc=x.get(uB))&&CY&&(cc.cotn=CY.cotn);case 6:J7=[];uQ=g.A(L);for(sq=uQ.next();!sq.done;sq=uQ.next())CR=sq.value,Du=g.Vw(CR.key).entityId,XH=GX(CR),Du!==Y&&XH.rootActionId!==Y||rv(U,CR.actionProto)||J7.push(CR.key);Wu=g.OV(Y,u);return g.D(x$,q$(n,{mode:"readwrite",A_:!0},function(Uu){var ty=J7.map(function(p){return OG(Uu,p)});
ty.push(OG(Uu,Wu,{Q5:!0}));return g.s$.all(ty)}),9);
case 9:if(!T){x$.qF(0);break}c.reverse();if(!c.length){x$.qF(0);break}Hu=g.A(c);Pq=Hu.next();case 12:if(Pq.done){x$.qF(0);break}v=Pq.value;IK=g.Vw(v).entityId;if(!IK){x$.qF(13);break}return g.D(x$,B8(IK,n,U,k,x.get(IK)),13);case 13:Pq=Hu.next(),x$.qF(12)}})},c8=function(Y,u,n){var U,k,m,X,S,C,f;
return g.l(function(Q){if(Q.j==1)return g.D(Q,q$(Y,{mode:"readwrite",A_:!0},function(N){var Z=H$(N,"transfer"),T=H$(N,"offlineOrchestrationActionWrapperEntity");return g.s$.all([Z,T]).then(function(r){r=g.A(r);var K=r.next().value;var L=r.next().value;r=CkQ.map(function(W){return VdR(N,W)});
L=g.A(L);for(var R=L.next();!R.done;R=L.next()){R=R.value;var c=g.Vw(R.actionProto.entityKey).entityType==="musicTrack",x=R.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";rv(u,R.actionProto)||c&&(!c||x)||r.push(OG(N,R.key,{Q5:!0}))}return g.s$.all(r).then(function(){return K})})}),2);
U=Q.K;k=g.A(U);for(m=k.next();!m.done;m=k.next())X=m.value,Mp(X),S=g.Vw(X.key).entityId,C={videoId:S,offlineDeleteReason:void 0,cotn:X.cotn},Cl(C),f=g.OV(S,"musicTrack"),P8(n,{entityKey:f,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.D(Q,Veq(),0)})},f7Q=function(Y){for(var u,n=g.A(Y.additionalMetadatas),U=n.next();!U.done;U=n.next())U=U.value,U.offlineMusicVideoData&&(u=U.offlineMusicVideoData);
var k,m,X,S,C;return{id:g.OV(Y.videoId,"musicTrack"),videoId:Y.videoId,title:Y.title,thumbnailDetails:Y.thumbnail,lengthMs:String(Number(Y.lengthSeconds)*1E3),albumTitle:(k=u)==null?void 0:k.releaseTitle,musicVideoType:(m=u)==null?void 0:m.musicVideoType,contentRating:{explicitType:(X=u)==null?void 0:X.explicitType},artistNames:((S=u)==null?void 0:S.byline)||((C=u)==null?void 0:C.channelName),downloadMetadata:g.OV(Y.videoId,"musicTrackDownloadMetadataEntity")}},SQX=function(Y,u,n){var U,k,m,X,S,C,
f,Q,N,Z,T,r,K,L,R,c,x,W;
return g.l(function(E){U=[];k=new Set;if((m=n)==null?0:(X=m.downloadedTracks)==null?0:X.length)for(S=g.A(n.downloadedTracks),C=S.next();!C.done;C=S.next())f=C.value,k.add(f);if(Y.tracks){Q=g.A(Y.tracks);for(N=Q.next();!N.done;N=Q.next())Z=N.value,k.has(Z)||U.push(Z);T=g.A(u);for(r=T.next();!r.done;r=T.next())if(K=r.value,K.id!==Y.id&&(L=K.tracks))for(R=g.A(L),c=R.next();!c.done;c=R.next())x=c.value,W=U.indexOf(x),W!==-1&&U.splice(W,1)}return E.return(U)})},PkL=function(Y,u){var n,U,k,m,X,S,C,f;
return g.l(function(Q){n=sB(Y.thumbnailDetails);U=g.A(u);for(k=U.next();!k.done;k=U.next())if(m=k.value,m.id!==Y.id)for(X=g.A(sB(m.thumbnailDetails)),S=X.next();!S.done;S=X.next())C=S.value,f=n.indexOf(C),f!==-1&&n.splice(f,1);return Q.return(n)})},QeX=function(Y,u){var n,U,k,m,X,S,C,f,Q;
return g.l(function(N){if(N.j==1)return n=g.OV("music_downloads_library_id","musicDownloadsLibraryEntity"),g.D(N,$M(Y,n,"musicDownloadsLibraryEntity"),2);(U=N.K)||(U={id:n});k=g.Vw(u).entityType;k==="musicTrack"?(m=U.downloadedTracks)!=null&&m.includes(u)||(U.downloadedTracks=((X=U.downloadedTracks)!=null?X:[]).concat(u)):k==="musicPlaylist"?(S=U.downloadedPlaylists)!=null&&S.includes(u)||(U.downloadedPlaylists=((C=U.downloadedPlaylists)!=null?C:[]).concat(u)):k!=="musicAlbumRelease"||(f=U.downloadedAlbumReleases)!=
null&&f.includes(u)||(U.downloadedAlbumReleases=((Q=U.downloadedAlbumReleases)!=null?Q:[]).concat(u));return g.D(N,aq(Y,U,"musicDownloadsLibraryEntity"),0)})},NHL=function(Y,u){var n,U,k,m,X,S,C;
return g.l(function(f){if(f.j==1)return n=g.OV("music_downloads_library_id","musicDownloadsLibraryEntity"),g.D(f,$M(Y,n,"musicDownloadsLibraryEntity"),2);U=f.K;if(!U)return f.qF(0);k=g.Vw(u).entityType;k==="musicTrack"?m=U.downloadedTracks:k==="musicPlaylist"&&(m=U.downloadedPlaylists);if((X=m)==null?0:X.length)for(S=0;S<m.length;S++)if(C=m[S],C===u){m.splice(S,1);break}return g.D(f,aq(Y,U,"musicDownloadsLibraryEntity"),0)})},ip$=function(Y){var u=Y.videos;
Y=[];var n=[];if(u){u=g.A(u);for(var U=u.next();!U.done;U=u.next()){var k=U.value.offlineVideoData.videoId;U=g.OV(k,"musicTrack");k=g.OV(k,"musicTrackDownloadMetadataEntity");Y.push(U);n.push(k)}}return{Id:Y,xi:n}},v8=function(Y,u,n){u={track:f7Q(u)};
n&&(u.playlistId=n);if(Y=g.z(Y.actionMetadata,ZpR))u.maximumDownloadQuality=Y.maximumDownloadQuality;return{musicTrackEntityActionMetadata:u}},rFR=function(Y){var u,n,U,k,m,X,S,C;
return g.l(function(f){switch(f.j){case 1:return u=g.gV(),n=ZJX(Y),U=g.Fj(THJ),g.pY(f,2),m={NO:!0},g.D(f,g.RV(u,n,U,void 0,m),4);case 4:k=f.K;g.Bc(f,3);break;case 2:X=g.vc(f);if(X instanceof g.bS)throw S="GetOffline network manager error: "+X.message,m6(S,X),Error(S);m6("GetOffline fetch request error",X);throw Error("GetOffline fetch request error");case 3:C=Ry(k);if(!k)throw m6("Network request failed"),Error("Network request failed");if(C!==void 0)D6(C);else if(!k.videos||!k.videos.length)throw m6("No data"),
Error("No data");return f.return(k.videos.map(function(Q){return Q.offlineVideoData}))}})},MUX=function(Y){var u,n,U,k,m,X,S,C;
return g.l(function(f){switch(f.j){case 1:return u=g.gV(),n=TjL(Y),U=g.Fj(THJ),g.pY(f,2),m={NO:!0},g.D(f,g.RV(u,n,U,void 0,m),4);case 4:k=f.K;g.Bc(f,3);break;case 2:X=g.vc(f);if(X instanceof g.bS)throw S="GetOffline network manager error for playlist: "+X.message,m6(S,X),Error(S);m6("GetOffline fetch request error for playlist",X);throw Error("GetOffline fetch request error for playlist");case 3:C=Ry(k);if(!k)throw m6("Network request failed for playlist"),Error("Network request failed for playlist");
if(C!==void 0)D6(C,"playlist");else if(!k.playlists||!k.playlists.length)throw m6("No data for playlist"),Error("No data for playlist");return f.return(k.playlists.map(function(Q){return Q.offlinePlaylistData}))}})},dsC=function(Y,u,n,U){var k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0,SM,CY,uB,cc,J7,uQ,sq,CR;
return g.l(function(Du){switch(Du.j){case 1:return g.D(Du,uP(),2);case 2:k=Du.K;if(!k)return Du.return([]);m=[];if((X=U)==null?0:X.length){m=U;Du.qF(3);break}return g.D(Du,Yx(k,"mainPlaylistEntity"),4);case 4:m=Du.K;case 3:if(!m.length)return Du.return([]);S=[];C=Date.now()/1E3;f=g.A(m);Q=f.next();case 5:if(Q.done)return S.length?g.D(Du,seJ(S),10):Du.return([]);N=Q.value;if(!N.downloadState){Z=void 0;Du.qF(8);break}return g.D(Du,$M(k,N.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:Z=
Du.K;case 8:T=Z;r=void 0;L=(K=(r=N)==null?void 0:r.entityMetadata)&&K.nextAutoRefreshIntervalSeconds?Number(K.nextAutoRefreshIntervalSeconds):NaN;R=Number.isNaN(L)?Y:L;x=c=void 0;W=((c=T)==null?0:c.lastSyncedTimestampMillis)?Number((x=T)==null?void 0:x.lastSyncedTimestampMillis)/1E3:0;J=E=void 0;O=((E=T)==null?0:E.addedTimestampMillis)?Number((J=T)==null?void 0:J.addedTimestampMillis)/1E3:0;if(n||!K||W+R<=C){Xd=[];T0=void 0;if((T0=N.videos)==null?0:T0.length)for(SM=g.A(N.videos),CY=SM.next();!CY.done;CY=
SM.next())uB=CY.value,cc=JSON.parse(g.Vw(uB).entityId),cc.videoId&&Xd.push(cc.videoId);J7="0";K&&(uQ=void 0,J7=String(Number((uQ=K.offlineLastModifiedTimestampSeconds)!=null?uQ:0).toFixed()));sq={playlistId:N.playlistId,videoIds:Xd,offlineLastModifiedTimestamp:J7,autoSync:u,offlineDateAddedTimestamp:String(O.toFixed())};S.push(sq)}Q=f.next();Du.qF(5);break;case 10:return CR=Du.K,Du.return(CR)}})},GLR=function(){var Y,u,n,U,k;
return g.l(function(m){if(m.j==1)return g.D(m,uP(),2);if(m.j!=3)return(Y=m.K)?g.D(m,Yx(Y,"refresh"),3):m.return(!1);u=m.K;if((n=u[0])==null||!n.refreshTime)return m.return(!1);U=Number(u[0].refreshTime);k=Date.now()/1E3;return m.return(isFinite(U)&&k>=U)})},jeQ=function(Y,u){var n,U,k;
return g.l(function(m){switch(m.j){case 1:return g.pY(m,2),g.D(m,AFu(Y,u),4);case 4:return U=m.K,g.D(m,YQC(U),5);case 5:n=n8$(U);g.Bc(m,3);break;case 2:k=g.vc(m),m6("getAndProcessSmartDownloadsResponse request or processing error",k);case 3:return m.return(n)}})},KJQ=function(Y,u,n,U){var k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0,SM,CY,uB,cc,J7,uQ,sq,CR;
return g.l(function(Du){switch(Du.j){case 1:return g.D(Du,uP(),2);case 2:k=Du.K;if(!k)return Du.return([]);m=[];if((X=U)==null?0:X.length){m=U;Du.qF(3);break}return g.D(Du,Yx(k,"musicPlaylist"),4);case 4:m=Du.K;case 3:if(!m.length)return Du.return([]);S=[];C=Date.now()/1E3;f=g.A(m);Q=f.next();case 5:if(Q.done)return S.length?g.D(Du,seJ(S),10):Du.return([]);N=Q.value;Z=void 0;r=(T=(Z=N)==null?void 0:Z.entityMetadata)&&T.nextAutoRefreshIntervalSeconds?Number(T.nextAutoRefreshIntervalSeconds):NaN;K=
Number.isNaN(r)?Y:r;R=L=0;c="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!N.downloadMetadata){Du.qF(8);break}return g.D(Du,$M(k,N.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:x=Du.K,E=W=void 0,L=Number((E=(W=x)==null?void 0:W.addedTimestampMillis)!=null?E:"0")/1E3,O=J=void 0,R=Number((O=(J=x)==null?void 0:J.lastModifiedTimestampMillis)!=null?O:"0")/1E3,T0=Xd=void 0,c=(T0=(Xd=x)==null?void 0:Xd.syncState)!=null?T0:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:SM=void 0;if(n||c!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!T||Number((SM=T.lastSyncedTimestampSeconds)!=null?SM:0)+K<=C){CY=[];uB=void 0;if((uB=N.tracks)==null?0:uB.length)for(cc=g.A(N.tracks),J7=cc.next();!J7.done;J7=cc.next())uQ=J7.value,CY.push(g.Vw(uQ).entityId);sq={playlistId:N.playlistId,videoIds:CY,offlineLastModifiedTimestamp:String(R.toFixed()),autoSync:u,offlineDateAddedTimestamp:String(L.toFixed())};S.push(sq)}Q=f.next();Du.qF(5);break;case 10:return CR=Du.K,Du.return(CR)}})},AFu=function(Y,u){var n,U,k,m,X,S,C,f,Q,N;
return g.l(function(Z){switch(Z.j){case 1:return n=g.gV(),g.D(Z,uP(),2);case 2:U=Z.K;if(!U){Z.qF(3);break}return g.D(Z,jSu(U),4);case 4:k=Z.K;case 3:var T=k;m={context:g.yj(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:Y},offlineClientState:T,clientStateRequestData:{preferredFormatType:u}}}};X=g.Fj(pAR);g.pY(Z,5);C={NO:!0};return g.D(Z,g.RV(n,m,X,void 0,C),7);case 7:S=Z.K;g.Bc(Z,6);break;case 5:f=g.vc(Z);if(f instanceof g.bS)throw Q=
"DPS network manager error for smart downloads: "+f.message,m6(Q,f),Error(Q);m6("DPS fetch request error for smart downloads",f);throw Error("DPS fetch request error for smart downloads");case 6:N=Ry(S);if(S)N!==void 0&&D6(N,"smart downloads");else throw m6("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return Z.return(S)}})},tUG=function(Y,u){var n,U,k,m,X,S,C,f;
return g.l(function(Q){switch(Q.j){case 1:return n=g.gV(),U={context:g.yj(),videoPlaybackPositionEntities:Y,lastSyncTimestampUsec:u},k=g.Fj(LJX),g.pY(Q,2),X={NO:!0},g.D(Q,g.RV(n,U,k,void 0,X),4);case 4:m=Q.K;g.Bc(Q,3);break;case 2:S=g.vc(Q);if(S instanceof g.bS)throw C="VPPS network manager error: "+S.message,m6(C,S),Error(C);m6("VPPS fetch request error",S);throw Error("VPPS fetch request error");case 3:f=Ry(m);if(m)f!==void 0&&D6(f,"position sync");else throw m6("Network request failed for position sync"),
Error("Network request failed for position sync");return Q.return(m)}})},o8Q=function(Y,u,n){var U,k,m,X,S,C,f,Q;
return g.l(function(N){switch(N.j){case 1:U=g.gV();var Z=n.refreshData,T=n.isEnqueuedForExpiredStreamUrlRefetch,r=n.Zs,K=n.offlineSourceData,L=n.mediaCapabilities,R={entityKey:Y};Z&&(R.refreshData=Z);T&&(R.isExpiredStreamUrlRefetch=T);r&&(R.downloadParameters=r);K&&(R.offlineSourceData=K);Z={context:g.LQ(u),signatureTimestamp:20300,videos:[R]};L&&(Z.mediaCapabilities=L);k=Z;m=g.Fj(BHG);g.pY(N,2);S={NO:!0};return g.D(N,g.RV(U,k,m,void 0,S),4);case 4:X=N.K;g.Bc(N,3);break;case 2:C=g.vc(N);if(C instanceof
g.bS)throw f="GetPDE network manager error: "+C.message,m6(f,C),Error(f);m6("GetPDE fetch request error",C);throw Error("GetPDE fetch request error");case 3:Q=Ry(X);if(X)Q!==void 0&&D6(Q,"PDE");else throw m6("Network request failed for PDE"),Error("Network request failed for PDE");return N.return(X)}})},Ry=function(Y){var u;
return(u=Y.errorMetadata)==null?void 0:u.status},D6=function(Y,u){u=u?" for "+u:"";
if(Y===0)throw Y="Empty response body"+u,m6(Y),Error(Y);Y="Response with error"+u;m6(Y);throw Error(Y);},seJ=function(Y){var u,n,U,k,m,X,S,C;
return g.l(function(f){switch(f.j){case 1:return u=g.gV(),n=rtB(Y),U=g.Fj(cFu),g.pY(f,2),m={NO:!0},g.D(f,g.RV(u,n,U,void 0,m),4);case 4:k=f.K;g.Bc(f,3);break;case 2:X=g.vc(f);if(X instanceof g.bS)throw S="offlinePlaylistSyncCheck network manager error: "+X.message,m6(S,X),Error(S);m6("offlinePlaylistSyncCheck fetch request error",X);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:C=Ry(k);if(!k)throw m6("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(C!==void 0)D6(C,"playlist sync");else if(!k.offlinePlaylistSyncCheckDatas||!k.offlinePlaylistSyncCheckDatas.length)throw m6("No data for playlist sync"),Error("No data for playlist sync");return f.return(k.offlinePlaylistSyncCheckDatas.map(function(Q){return Q.offlinePlaylistSyncCheckData}))}})},xx=function(Y){this.K=Y},v8u=function(Y,u){var n,U,k,m,X,S;
return g.l(function(C){switch(C.j){case 1:n=new Map,U=g.A(u),k=U.next();case 2:if(k.done){C.qF(4);break}m=k.value;X=n;S=X.set;return g.D(C,Y.j(m),5);case 5:S.call(X,m,C.K);k=U.next();C.qF(2);break;case 4:return C.return(n)}})},lP=function(Y,u,n,U,k,m){u=g.OV(u,n);
U=Object.assign({},m,{priority:U,retryScheduleIntervalsInSeconds:k});return{actionType:Y,entityKey:u,actionMetadata:U}},hK=function(Y,u,n,U,k,m){this.status=Y;
this.K=u;this.G=n;this.j=U;this.X=k;this.downloadState=m},RW$=function(Y,u,n){this.K=Y;
this.xw=u;this.X=n},l7$=function(Y,u){var n,U,k,m,X,S,C,f,Q;
return g.l(function(N){switch(N.j){case 1:return n=u.entityKey,k=(U=g.z(u.actionMetadata,wv))==null?void 0:U.isEnqueuedForExpiredStreamUrlRefetch,g.pY(N,2),m=void 0,g.D(N,DsC(Y,u),4);case 4:m=N.K;g.pY(N,5);var Z=(Z=g.z(u.actionMetadata,wv))?{maximumDownloadQuality:Z.maximumDownloadQuality}:void 0;return g.D(N,o8Q(n,Y.xw,{isEnqueuedForExpiredStreamUrlRefetch:k,Zs:Z,offlineSourceData:m}),7);case 7:X=N.K;g.Bc(N,6,2);break;case 5:return g.vc(N,2),S=QJ(u)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",m6("PDE handleAdd error"),N.return(W8(u,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",S,"DOWNLOAD_STATE_FAILED"));case 6:return g.D(N,xsG(Y,X,u),8);case 8:return N.return(W8(u,!0,X.orchestrationActions));case 2:return C=g.vc(N),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",C instanceof g.QK&&C.type==="QUOTA_EXCEEDED"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
Q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),m6("PDE handleAdd error"),N.return(W8(u,!1,void 0,f,Q,"DOWNLOAD_STATE_FAILED"))}})},WJg=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0;
return g.l(function(SM){switch(SM.j){case 1:return n=u.entityKey,U=g.Vw(n).entityId,g.D(SM,q$(Y.K,{mode:"readonly",A_:!0},function(CY){var uB=EG(CY,n,"playbackData"),cc=EG(CY,g.OV(U,"offlineVideoPolicy"),"offlineVideoPolicy");CY=EG(CY,g.OV(U,"transfer"),"transfer");return g.s$.all([uB,cc,CY])}),2);
case 2:k=SM.K;m=g.A(k);X=m.next().value;S=m.next().value;C=m.next().value;f=X;Q=S;N=C;if(!f||!Q)return SM.return(W8(u,!0));Z=[];K=((r=f)==null?0:r.playerResponseJson)?JSON.parse(f.playerResponseJson):null;if(!(N&&K&&Y.xw.V("html5_refresh_deprecated_downloads"))){SM.qF(3);break}T=hW$(Y,K,N);return g.D(SM,wAX(Y,N),4);case 4:Z=SM.K;case 3:L={lastPlayerResponseTimestampSeconds:f.playerResponseTimestamp,offlineToken:Q.offlineToken,formatIds:Z};R={};if((c=N)==null?0:c.maximumDownloadQuality)R.maximumDownloadQuality=
N.maximumDownloadQuality;g.pY(SM,5);x=void 0;return g.D(SM,DsC(Y,u),7);case 7:return x=SM.K,g.pY(SM,8),g.D(SM,o8Q(n,Y.xw,{refreshData:L,Zs:R,offlineSourceData:x,mediaCapabilities:T}),10);case 10:W=SM.K;g.Bc(SM,9,5);break;case 8:return g.vc(SM,5),E=QJ(u)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",m6("PDE handleRefresh error"),SM.return(W8(u,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",E,
"DOWNLOAD_STATE_FAILED"));case 9:return g.D(SM,xsG(Y,W,u),11);case 11:return SM.return(W8(u,!0,W.orchestrationActions));case 5:return J=g.vc(SM),O="PDE handleRefresh error",J instanceof Error&&(O="PDE handleRefresh error: "+J.message),Xd="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",T0="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",J instanceof g.QK&&J.type==="QUOTA_EXCEEDED"&&(Xd="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",T0="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
m6(O),SM.return(W8(u,!1,void 0,Xd,T0,"DOWNLOAD_STATE_FAILED"))}})},DsC=function(Y,u){var n,U,k,m;
return g.l(function(X){if(X.j==1)return n=g.Vw(u.entityKey).entityId,U=g.OV(n,"videoDownloadContextEntity"),g.D(X,$M(Y.K,U,"videoDownloadContextEntity"),2);k=X.K;return(m=k)!=null&&m.offlineModeType?X.return({offlineModeType:k.offlineModeType}):X.return(void 0)})},xsG=function(Y,u,n){var U,k,m,X,S;
return g.l(function(C){if(C.j==1){if(!u.frameworkUpdates||!g.z(u.frameworkUpdates,Ll))return C.return();if(!(g.z(u.frameworkUpdates,Ll).mutations&&g.z(u.frameworkUpdates,Ll).mutations.length>0&&g.z(u.frameworkUpdates,Ll).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return C.qF(2);U=g.Vw(g.z(u.frameworkUpdates,Ll).mutations[0].entityKey).entityId;return g.D(C,tK(Y.K,U),3)}if(C.j!=2){k=C.K;m=g.z(n.actionMetadata,wv);if(S=(X=m)==null?void 0:X.playlistId)k.playlistId=S;k.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.KV(Y.xw)?g.D(C,pl(U,Y.K,n,Y.X,k),2):g.R8(Y.xw)?g.D(C,B8(U,Y.K,n,Y.X),2):C.qF(2)}return g.D(C,XgG(g.z(u.frameworkUpdates,Ll)),0)})},W8=function(Y,u,n,U,k,m){return new hK(u?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",QJ(Y),n,U,k,m)},hW$=function(Y,u,n){u=HJu(Y.xw,n.cotn,u);
n=g.lR(u);return g.TRY(u,n,Y.xw)},wAX=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z;
return g.l(function(T){if(T.j==1)return n=[],g.D(T,q$(Y.K,{mode:"readonly",A_:!0},function(r){var K=[],L=u.offlineVideoStreams;if(L){L=g.A(L);for(var R=L.next();!R.done;R=L.next())K.push(EG(r,R.value,"offlineVideoStreams"))}return g.s$.all(K)}),2);
if(U=T.K)for(k=g.A(U),m=k.next();!m.done;m=k.next())if(X=m.value,S=void 0,(S=X)==null?0:S.streamsProgress)for(C=X.streamsProgress,f=0;f<C.length;f++)Q=C[f],N=JSON.parse(Q.formatStreamBytes),Z={itag:N.itag,lmt:N.lastModified,xtags:N.xtags},n.push(Z);return T.return(n)})},eWq=function(Y,u){this.K=Y;
this.xw=u},bpX=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T;
return g.l(function(r){switch(r.j){case 1:return n=QJ(u),g.D(r,Yx(Y.K,"videoPlaybackPositionEntity"),2);case 2:U=r.K;if(U.length===0)return r.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));g.pY(r,3);return g.D(r,Iq.getInstance(),5);case 5:k=r.K;if(!k)throw Error("prefStorage is undefined");return g.D(r,k.get("psi"),6);case 6:return m=r.K,C=(S=(X=m)==null?void 0:X.Po)!=null?S:"0",g.D(r,tUG(U,C),7);case 7:return f=r.K,Q={isPaused:f.watchHistoryPaused,Po:f.syncTimestampUsec},g.D(r,k.set("psi",
Q),8);case 8:if(Q.isPaused){r.qF(9);break}N=g.z(f.frameworkUpdates,Ll);if(!f.frameworkUpdates||!N){r.qF(9);break}return g.D(r,XgG(N),9);case 9:g.Bc(r,4);break;case 3:return Z=g.vc(r),T="PPE handleRefresh error: "+(Z instanceof Error?Z.message:"unknown error"),m6(T),r.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return r.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n))}})},zWJ=function(Y,u){var n,U,k,m,X,S,C,f;
return g.l(function(Q){switch(Q.j){case 1:return n=QJ(u),U=g.Vw(u.entityKey).entityId,g.pY(Q,2),g.D(Q,Iq.getInstance(),4);case 4:k=Q.K;if(!k)throw Error("prefStorage is undefined");return g.D(Q,k.get("psi"),5);case 5:m=Q.K;X=g.z(u.actionMetadata,I7$);if(((S=m)==null?void 0:S.isPaused)!==!1||(C=X)==null||!C.lastPlaybackPositionSeconds){Q.qF(6);break}f={key:g.OV(U,"videoPlaybackPositionEntity"),videoId:U,lastPlaybackPositionSeconds:X.lastPlaybackPositionSeconds};return g.D(Q,aq(Y.K,f,"videoPlaybackPositionEntity"),
6);case 6:g.Bc(Q,3);break;case 2:return g.vc(Q),Q.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Q.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n))}})},g8B=function(Y,u){var n,U,k;
return g.l(function(m){switch(m.j){case 1:n=QJ(u);g.pY(m,2);U=g.Vw(u.entityKey).entityId;if(U==="!*$_ALL_ENTITIES_!*$")return g.D(m,uSR(Y.K),5);k=g.OV(U,"videoPlaybackPositionEntity");return g.D(m,YvR(Y.K,k),5);case 5:g.Bc(m,3);break;case 2:return g.vc(m),m.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return m.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n))}})},E8$=function(Y,u){this.api=Y;
this.K=u;this.logger=new g.jW("woffle");this.j=!1;this.IH={OJ:this.OJ};this.logger.debug("Initialized OfflineMediaManager")},Hpy=function(Y){return g.l(function(u){return u.return(iJL(Y))})},yFu=function(Y){var u;
return g.l(function(n){if(n.j==1)return g.D(n,g.yaA(Y),2);u=n.K;return n.return(u.filter(function(U){return!!U.url}).map(function(U){return U.url}))})},e7=function(Y,u){var n=g.kR(u);
if(n===1||n===0)return Promise.resolve();(n=VUg(Y,u))&&n.stopVideo();Y.X=0;return Hpy(u)},bP=function(Y,u,n,U){n=n===void 0?!1:n;
U=U===void 0?!0:U;var k=typeof u==="string"?u:u.videoDetails.videoId;g.kR(k)===2&&((u=VUg(Y,k))?u.stopVideo():Y.logger.info(function(){return"Corresponding player for "+k+" not found. Pausing anyway"}),g.mS(k,2),Y.X=2,n?OpX(Y.K):U&&FJq(Y.K))},VUg=function(Y,u){var n;
return((n=Y.player)==null?void 0:n.getVideoData().videoId)===u?Y.player:null},JFu=function(Y,u,n){u.getPlayerResponse();
g.mS(u.videoId,2);Y.X=2;Y.j=!1;var U;(U=Y.player)==null||U.dispose();Y.player=Y.api.yT(u);u={};Y.player.BD((u.localmediachange=Y.k9,u.signatureexpired=Y.YY,u.statechange=Y.IFc,u),Y);Y.V("html5_generate_content_po_token")&&Y.player.Nl();var k=Y.OJ(n);Y.player.zd(g.c5(k,k,!0,"m"),!1);Y.logger.debug(function(){return"Starting headless playback with quality: "+k});
Y.player.Xo(!1)},qQC=function(Y,u){this.K=Y;
this.xw=u},$sL=function(Y,u){var n,U;
return g.l(function(k){switch(k.j){case 1:return n=QJ(u),g.D(k,$M(Y.K,u.entityKey,"transfer"),2);case 2:if(U=k.K)return k.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));g.pY(k,3);return g.D(k,a7R(Y,u),5);case 5:g.Bc(k,4);break;case 3:return g.vc(k),k.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return k.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n))}})},YNu=function(Y,u){var n,U;
return g.l(function(k){switch(k.j){case 1:return n=QJ(u),g.D(k,$M(Y.K,u.entityKey,"transfer"),2);case 2:U=k.K;if(!U||U.transferState!=="TRANSFER_STATE_COMPLETE")return k.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));g.pY(k,3);return g.D(k,a7R(Y,u,!0),5);case 5:g.Bc(k,4);break;case 3:return g.vc(k),k.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return k.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n))}})},uEq=function(Y,u){var n,U,k,m,X,S,C,f,Q,N;
return g.l(function(Z){switch(Z.j){case 1:return n=QJ(u),U=g.Vw(u.entityKey).entityId,g.D(Z,q$(Y.K,{mode:"readonly",A_:!0},function(T){var r=EG(T,u.entityKey,"transfer");T=EG(T,g.OV(U,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.s$.all([r,T])}),2);
case 2:k=Z.K;m=g.A(k);X=m.next().value;S=m.next().value;C=X;f=S;if(!C||C.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return Z.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));g.pY(Z,3);C.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.D(Z,aq(Y.K,C,"transfer"),5);case 5:Q=g.Vw(C.key).entityId;exQ({videoId:Q,kO:C,offlineModeType:(N=f)==null?void 0:N.offlineModeType});g.Bc(Z,4);break;case 3:return g.vc(Z),Z.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Z.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n))}})},a7R=function(Y,u,n){n=n===void 0?!1:n;
var U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R;return g.l(function(c){switch(c.j){case 1:return U=g.z(u.actionMetadata,nv$),k=g.Vw(u.entityKey).entityId,m=g.OV(k,"downloadStatusEntity"),g.D(c,q$(Y.K,{mode:"readonly",A_:!0},function(x){var W=EG(x,m,"downloadStatusEntity");x=EG(x,g.OV(k,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.s$.all([W,x])}),2);
case 2:return X=c.K,S=g.A(X),C=S.next().value,f=S.next().value,Q=C,N=f,Z="TRANSFER_STATE_TRANSFER_IN_QUEUE",((T=Q)==null?void 0:T.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(Z="TRANSFER_STATE_PAUSED_BY_USER"),L={key:u.entityKey,transferState:Z,cotn:g.TS(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(r=U)==null?void 0:r.maximumDownloadQuality,preferredAudioTrack:(K=U)==null?void 0:K.preferredAudioTrack,transferRetryCount:0,isRefresh:n,hasLoggedFirstStarted:!1},g.D(c,q$(Y.K,
{mode:"readwrite",A_:!0},function(x){var W=[];n&&W.push(OG(x,g.OV(k,"offlineVideoStreams")));W.push(VI(x,L,"transfer"));return g.s$.all(W)}),3);
case 3:if(!n){c.qF(4);break}return g.D(c,Hpy(k),4);case 4:wgX({videoId:k,kO:L,offlineModeType:(R=N)==null?void 0:R.offlineModeType}),g.KY(c)}})},kKQ=function(Y,u,n,U){if(!Y.action.entityKey)throw Error("entityKey is missing.");
var k=g.Vw(Y.action.entityKey);k={entityType:k.aJ,entityId:k.entityId,offlineOrchestrationActionType:Y.action.actionType,orchestrationAction:{orchestrationActionId:Y.actionId}};u&&(k.offlineOrchestrationActionResult=u.status,k.isRetryable=n?!1:u.K,u.X&&(k.offlineOrchestrationFailureReason=U8u(u.X,k.isRetryable)));var m,X;if((m=Y.action.actionMetadata)==null?0:(X=m.offlineLoggingData)==null?0:X.offlineModeType)k.offlineModeType=Y.action.actionMetadata.offlineLoggingData.offlineModeType;U&&(k.additionalOrchestrationActions=
U.map(function(S){return{orchestrationActionId:S.actionId}}));
return k},U8u=function(Y,u){return Y!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||u?Y==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&u?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":Y:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},m8R=function(Y,u){var n={offlineOrchestrationContext:kKQ(Y)};
u=GsB(u,n);AtX(dvX(),u,Y.rootActionId)},XPy=function(Y,u,n,U){U=U===void 0?[]:U;
u={offlineOrchestrationContext:kKQ(Y,u,n,U)};u=GsB(3,u);AtX(dvX(),u,Y.rootActionId)},P9B=function(){this.actions=[]},SNQ=function(Y,u){u=g.A(u);
for(var n=u.next();!n.done;n=u.next())n=n.value,m8R(n,1),Y.actions.push(n);Y.actions.sort(Y.K)},C9Q=function(Y,u){if(u)for(var n=0;n<Y.actions.length;n++)if(u==="!*$_ALL_ENTITIES_!*$"&&Y.actions[n].actionId!==u||u!=="!*$_ALL_ENTITIES_!*$"&&Y.actions[n].rootActionId===u&&Y.actions[n].actionId!==u)Y.actions.splice(n,1),n--},fBB=function(Y,u){Y=g.A(Y.actions);
for(var n=Y.next();!n.done;n=Y.next())if(n.value.actionId===u)return!0;return!1},Iy=function(Y,u,n,U,k){g.e.call(this);
var m=this;this.j=Y;this.jG=u;this.KG=n;this.S=U;this.xw=k;this.K=new P9B;this.W=new g.bD;this.X=new g.Vp(function(){m.retry()});
this.Z=NaN;this.J=!1;this.IH={DeZ:function(){return m.K},
K9:function(){return m.W},
HQc:function(){return m.X},
retry:function(){return m.retry()}};
g.b(this,this.X);this.N=this.j.observe(this.oV.bind(this))},iEL=function(Y,u,n,U,k){var m;
return g.l(function(X){if(X.j==1)return m=new Iy(Y,u,n,U,k),g.D(X,Q0g(m),2);NE$(m);return X.return(m)})},NE$=function(Y){var u=Y.K.actions[0];
return Y.G?((u==null?void 0:u.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&Y.G[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Y.J=!0),Promise.resolve()):ZEJ(Y)},ZEJ=function(Y){var u,n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R;
return g.l(function(c){switch(c.j){case 1:if(Y.G)throw Error("Already processing an action");if(Y.gg())return c.return();u=Y.K.actions.shift();lbg(Y.KG,!u);if(u===void 0)return c.return();u.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&u.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&C9Q(Y.K,u.actionId);n="";u.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&u.rootActionId===u.actionId&&(n=u.actionId);U=[u];Y.G=U;if(k=Y.jG[u.entityType]){c.qF(2);break}Y.G=
void 0;return g.D(c,ZEJ(Y),3);case 3:return c.return();case 2:m=g.A(U);for(X=m.next();!X.done;X=m.next())S=X.value,m8R(S,2);g.pY(c,4,5);return g.D(c,v8u(k,U.map(function(x){return x.action})),7);
case 7:C=c.K,f=g.A(U),Q=f.next();case 8:if(Q.done){c.qF(10);break}N=Q.value;Z=C.get(N.action);return g.D(c,TE$(Y,N,Z),9);case 9:Q=f.next();c.qF(8);break;case 10:C9Q(Y.K,n);case 5:g.lB(c);Y.G=void 0;g.wG(c,6);break;case 4:return T=g.vc(c),m6("Orchestration error",T),g.pY(c,12),g.D(c,rG$(Y,U),14);case 14:g.Bc(c,5);break;case 12:r=g.vc(c);m6("Orchestration retry error",r);K=g.A(U);for(L=K.next();!L.done;L=K.next())R=L.value,R.retryScheduleIndex<3&&SNQ(Y.K,[R]);c.qF(5);break;case 6:return g.D(c,ZEJ(Y),
0)}})},TE$=function(Y,u,n){var U,k,m,X,S,C,f,Q,N,Z,T,r;
return g.l(function(K){switch(K.j){case 1:U=u.retryScheduleIndex+2===3;if(n.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){K.qF(2);break}if(n.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){K.qF(0);break}XPy(u,n,U);if(n.K&&u.retryScheduleIndex+1<3)return g.D(K,rG$(Y,[u]),0);m=((k=n)==null?0:k.j)?n.j:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";X={entityKey:u.action.entityKey,failureReason:m};S=void 0;g.KV(Y.xw)?S="mainVideoDownloadStateEntity":g.R8(Y.xw)&&(S="musicTrackDownloadMetadataEntity");
if(!S||!n.downloadState){K.qF(7);break}C=g.Vw(u.action.entityKey).entityId;return g.D(K,TX(C,S,Y.j,n.downloadState),7);case 7:P8(Y.S,X);if(n.downloadState==="DOWNLOAD_STATE_FAILED"&&Y.xw.V("html5_auto_retry_failed_pde_actions")){K.qF(0);break}m6("Orchestration result is not retryable, deleting action");return g.D(K,YvR(Y.j,AK(u).key),0);case 2:f=void 0;try{f=(Q=n.G)==null?void 0:Q.map(function(L){return Y.createAction(L,u)})}catch(L){return XPy(u,n,U),N={entityKey:u.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},P8(Y.S,N),m6("Orchestration subactions creation error",L),K.return()}XPy(u,n,U,f);if(!f){K.qF(12);break}Z=f.map(function(L){return AK(L)});
T=0;case 13:if(!(T<f.length)||Y.J){K.qF(15);break}return g.D(K,q$(Y.j,{mode:"readwrite",A_:!0},function(L){var R=[];R.push(E1C(L,Z.slice(T,T+10),"offlineOrchestrationActionWrapperEntity"));return g.s$.all(R)}),16);
case 16:T+=10;K.qF(13);break;case 15:if(Y.J)return Y.J=!1,K.return();case 12:return r=AK(u),g.D(K,YvR(Y.j,r.key),17);case 17:m8R(u,4),g.KY(K)}})},GKR=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T;
return g.l(function(r){n=[];U=Infinity;k=4E3;m=g.A(u);for(X=m.next();!X.done;X=m.next())S=X.value,C=Number(S.enqueueTimeSec),f=MKC(C),Q=S.retryScheduleIndex,N=Q!=null&&Q>0,f>0&&N?(U=Math.min(U,C),k=Math.min(f,k)):n.push(S);isFinite(U)&&(!Y.X.isActive()||U<Y.Z)&&(Y.Z=U,Y.X.start(k));Y.W.XP()||(Z=n.length,n=n.filter(function(K){var L;K=((L=K.actionProto)==null?void 0:L.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!s0$.includes(K)}),T=n.length<Z,!Y.X.isActive()&&T&&Y.X.start(1));
n.length>0&&d8y(Y,n);return g.D(r,NE$(Y),0)})},j0Q=function(Y){var u,n,U,k,m,X,S;
return g.l(function(C){if(C.j==1)return g.D(C,AGG(Y),2);u=C.K;n=[];U=g.A(u);for(k=U.next();!k.done;k=U.next())m=k.value,X=g.Vw(m.key),S=X.entityId,fBB(Y.K,S)||n.push(m);return g.D(C,GKR(Y,n),0)})},MKC=function(Y){Y=Y*1E3-Date.now();
return Y>4E3?4E3:Y},rG$=function(Y,u){var n,U,k;
return g.l(function(m){n=g.A(u);for(U=n.next();!U.done;U=n.next()){k=U.value;var X=void 0,S=void 0,C=((S=k.action)==null?void 0:(X=S.actionMetadata)==null?void 0:X.retryScheduleIntervalsInSeconds)||[1,2,4];X=1;k.retryScheduleIndex<C.length&&(X=C[k.retryScheduleIndex]);k.K=X*1E3+Date.now();k.retryScheduleIndex++}return g.D(m,KUL(Y,u),0)})},Q0g=function(Y){var u;
return g.l(function(n){if(n.j==1)return g.D(n,Yx(Y.j,"offlineOrchestrationActionWrapperEntity"),2);u=n.K;return g.D(n,GKR(Y,u),0)})},d8y=function(Y,u){u.length!==0&&u.forEach(function(n){n=GX(n);
n.retryScheduleIndex<3&&SNQ(Y.K,[n])})},AGG=function(Y,u){var n;
return g.l(function(U){if(U.j==1)return g.D(U,Yx(Y.j,"offlineOrchestrationActionWrapperEntity",u),2);n=U.K;return U.return(n.filter(PJX))})},KUL=function(Y,u){if(u.length===0)return Promise.resolve([]);
u=u.map(function(n){return AK(n)});
return $ER(Y.j,u)},pPC=function(Y){this.Bz=Y;
this.K=void 0},LU$=function(Y,u){var n,U,k,m;
return g.l(function(X){n=u.videoId;U=!0;if(u.captionTracks.length)k=wdJ(u),Y.K=new g.xg(Y.Bz,u,k);else if(u.Cs)m=g.Ylu(u),Y.K=new g.hL(Y.Bz,u.Cs,n,m,u.d9,u.eventId),U=u.d9;else return X.return();return X.return(new Promise(function(S){var C;(C=Y.K)==null||C.dl({Wc:function(){return g.l(function(f){if(f.j==1)return g.D(f,Y.Wc(n,U),2);S();g.KY(f)})},
a8:function(){}})}))})},tKX=function(Y){var u;
return g.l(function(n){if(n.j==1)return g.D(n,NjR(Y),2);u=n.K;return n.return(!!u&&u.length>0)})},zX=function(Y){g.e.call(this);
this.K=Y;this.j=this.K.observe(this.X.bind(this))},BE$=function(Y,u){var n,U,k,m,X,S,C;
return g.l(function(f){switch(f.j){case 1:if(u.length===0)return f.return([]);n=u.map(function(Q){return g.OV(Q,"transfer")});
return g.D(f,Yx(Y.K,"transfer",n),2);case 2:U=f.K;k=U.filter(PJX).map(function(Q){return g.Vw(Q.key).entityId});
m=u.filter(function(Q){return k.indexOf(Q)===-1});
if(m.length===0)return f.return([]);X=g.A(m);S=X.next();case 3:if(S.done){f.qF(5);break}C=S.value;return g.D(f,Hpy(C),4);case 4:S=X.next();f.qF(3);break;case 5:return f.return(m)}})},vvy=function(Y,u,n,U,k,m){var X,S,C;
return g.l(function(f){X="STREAM_TYPE_UNKNOWN";n.video&&n.audio?(X="STREAM_TYPE_AUDIO_AND_VIDEO",m6("unexpected stream type")):n.video&&!n.audio?X="STREAM_TYPE_VIDEO":!n.video&&n.audio&&(X="STREAM_TYPE_AUDIO");S=g.OV(u,"offlineVideoStreams");C={numBytesDownloaded:k.toFixed(),numTotalBytes:m.toFixed(),streamType:X,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(U),itag:X==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(n.itag):void 0};return g.D(f,q$(Y,{mode:"readwrite",A_:!0},
function(Q){var N=EG(Q,S,"offlineVideoStreams"),Z=EG(Q,g.OV(u,"transfer"),"transfer");return g.s$.all([N,Z]).then(function(T){T=g.A(T);var r=T.next().value;T=T.next().value;if(!T)return OG(Q,S).then(function(){});
var K=ovR(r);r=cGX(r,U,C,S);var L=VI(Q,r,"offlineVideoStreams");ovR(r)>K&&(T.lastProgressTimeMs=Date.now().toString());K=[L];T.offlineVideoStreams||(T.offlineVideoStreams=[]);T.offlineVideoStreams.indexOf(S)===-1&&(T.offlineVideoStreams.push(S),K.push(VI(Q,T,"transfer")));return g.s$.all(K)})}),0)})},R9R=function(Y,u){var n,U,k,m,X;
return g.l(function(S){if(S.j==1)return n=g.OV(u,"offlineVideoStreams"),g.D(S,$M(Y,n,"offlineVideoStreams"),2);U=S.K;if(!U||!U.streamsProgress)return S.return();k=g.A(U.streamsProgress);for(m=k.next();!m.done;m=k.next())X=m.value,X.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",X.numTotalBytes!==X.numBytesDownloaded&&(X.numBytesDownloaded=X.numTotalBytes);return g.D(S,aq(Y,U,"offlineVideoStreams"),0)})},cGX=function(Y,u,n,U){if(Y&&Y.streamsProgress){U=Y;
a:{u=u.itag+";"+u.xtags;for(var k=Y.streamsProgress,m=0;m<k.length;m++){var X=JSON.parse(k[m].formatStreamBytes);if(X.itag+";"+X.xtags===u){k[m]=n;n=k;break a}}k.push(n);n=k}U.streamsProgress=n}else Y={key:U,streamsProgress:[n]};return Y},ovR=function(Y){if(Y==null?0:Y.streamsProgress){var u=0;
Y=Y.streamsProgress;for(var n=0;n<Y.length;n++){var U=Y[n];isNaN(Number(U.numBytesDownloaded))?m6("stream progress bytes number invalid"):u+=Number(U.numBytesDownloaded)}return u}return 0},D8$=function(Y,u,n,U){g.e.call(this);
var k=this;this.j=Y;this.api=u;this.CG=n;this.oV=U;this.W=new g.bD;this.G=new g.Vp(function(){k.K&&k.K.transferState==="TRANSFER_STATE_TRANSFERRING"&&k.W.XP()&&((k.K.transferRetryCount||0)<3?bP(k.S,k.J,!1,!1):e7(k.S,k.J.videoDetails.videoId),k.uS("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.KG=this.rg=0;this.N=this.Z=!1;this.zZ=g.YF(this.api.Y().experiments,"html5_transfer_processing_logs_interval");this.JJ=new g.j3(this);this.IH={l6V:function(){return k.G},
nxF:function(){return k.oV},
K9:function(){return k.W}};
this.jG=this.j.observe(this.Xv.bind(this));this.S=new E8$(u,this);this.TZ=new pPC(u);this.DW=new zX(this.j);this.Fk=this.W.listen("publicytnetworkstatus-online",this.Si.bind(this));this.MF=this.W.listen("publicytnetworkstatus-offline",this.lkw.bind(this));this.N=this.api.Y().V("html5_less_transfer_processing_logs");g.b(this,this.JJ);this.JJ.B(u,"offlinetransferpause",this.isz);if(g.KV(this.api.Y()))this.X="mainVideoDownloadStateEntity";else if(g.R8(this.api.Y())||g.LV(this.api.Y()))this.X="musicTrackDownloadMetadataEntity"},
x8C=function(Y){return g.l(function(u){if(u.j==1)u=g.D(u,fbq(),2);
else{var n=Y.DW;var U=g.UZ();U=Object.keys(U);n=BE$(n,U);u=g.D(u,n,0)}return u})},EB=function(Y,u){u=u===void 0?!1:u;
var n;return g.l(function(U){if(U.j==1){if(Y.K)throw Error("Already downloading a video");Y.KG=0;Y.Z=!1;return g.D(U,lB$(Y),2)}return U.j!=4?(n=U.K,hxq(Y.CG,!n),n&&Y.W.XP()?u?g.D(U,new Promise(function(k){g.QS(k,1E3)}),4):U.qF(4):(!n&&Y.K&&gv(Y),U.qF(0))):g.D(U,h9$(Y,n),0)})},wPJ=function(Y){return g.l(function(u){if(u.j==1)return Y.J?g.D(u,e7(Y.S,Y.J.videoDetails.videoId),3):u.qF(0);
gv(Y);g.KY(u)})},WUu=function(Y,u){var n,U,k;
return g.l(function(m){switch(m.j){case 1:return g.pY(m,2),(n=!!u.captionTracks.length||!!u.Cs)?g.D(m,tKX(u.videoId),4):m.return();case 4:return(U=m.K)?m.return():g.D(m,LU$(Y.TZ,u),5);case 5:g.Bc(m,0);break;case 2:k=g.vc(m),m6("Caption downloading error",k,u.cotn),g.KY(m)}})},h9$=function(Y,u){var n,U,k,m,X,S;
return g.l(function(C){switch(C.j){case 1:if(Y.Z)return C.return();Y.Z=!0;Y.K=u;n=g.Vw(Y.K.key);U=n.entityId;k=void 0;if(Y.K.transferState==="TRANSFER_STATE_TRANSFERRING")return g.D(C,H8(Y,U),7);if(Y.K.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||Y.K.transferRetryCount||Y.K.hasLoggedFirstStarted){C.qF(3);break}return g.D(C,H8(Y,U),5);case 5:return k=C.K,Y.K.hasLoggedFirstStarted=!0,g.D(C,e9R(Y),6);case 6:WMu({videoId:U,kO:Y.K,offlineModeType:k},void 0,void 0,!0);C.qF(3);break;case 7:k=C.K,
fl({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:U,kO:Y.K,offlineModeType:k});case 3:return g.D(C,bEJ(Y),8);case 8:return m=null,g.pY(C,9),g.D(C,IBX(Y,u),11);case 11:m=C.K;Y.J=m;g.Bc(C,10);break;case 9:return X=g.vc(C),m6("error getting player response",X,u.cotn),g.D(C,Y.uS("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return C.return();case 10:return S=HJu(Y.api.Y(),u.cotn,m),g.D(C,WUu(Y,S),13);case 13:return g.D(C,yFu(S.videoId),
14);case 14:S.LL=C.K,JFu(Y.S,S,u.maximumDownloadQuality),Y.G.start(108E5),g.KY(C)}})},lB$=function(Y){var u,n;
return g.l(function(U){if(U.j==1)return g.D(U,Yx(Y.j,"transfer"),2);u=U.K;n=u.filter(z9G).sort(gvq);return n.length===0?U.return():U.return(n[0])})},bEJ=function(Y){var u,n,U;
return g.l(function(k){if(k.j==1){if(!Y.K)return yJ(Y,"onTransferStart"),k.return();Y.G.start(108E5);return g.D(k,VJ(Y,"TRANSFER_STATE_TRANSFERRING"),2)}u=Y.K;return(U=((n=u)==null?0:n.key)?g.Vw(u.key).entityId:"")&&Y.X?g.D(k,TX(U,Y.X,Y.j,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):k.qF(0)})},OpX=function(Y){var u,n,U,k;
g.l(function(m){switch(m.j){case 1:if(!Y.K){yJ(Y,"onTransferPausedByUser");m.qF(2);break}u=Y.K;Y.G.stop();return g.D(m,VJ(Y,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:U=((n=u)==null?0:n.key)?g.Vw(u.key).entityId:"";if(!U||!Y.X){m.qF(4);break}return g.D(m,TX(U,Y.X,Y.j,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.D(m,H8(Y,U),6);case 6:k=m.K,bJC({videoId:U,kO:u,offlineModeType:k});case 2:gv(Y),EB(Y),g.KY(m)}})},FJq=function(Y){var u,n,U;
g.l(function(k){if(k.j==1){if(!Y.K)return yJ(Y,"onTransferPausedByNetwork"),k.return();Y.G.stop();return g.D(k,VJ(Y,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(k.j!=3)return u=Y.K,(U=((n=u)==null?0:n.key)?g.Vw(u.key).entityId:"")&&Y.X?g.D(k,TX(U,Y.X,Y.j,"DOWNLOAD_STATE_PAUSED"),3):k.qF(3);gv(Y);g.KY(k)})},EvL=function(Y){var u,n,U,k,m;
g.l(function(X){switch(X.j){case 1:if(!Y.K)return yJ(Y,"onTransferComplete"),X.return();u=Y.K;Y.G.stop();if(!u||!Y.J){X.qF(2);break}n=HJu(Y.api.Y(),u.cotn,Y.J);return g.D(X,WUu(Y,n),2);case 2:return g.D(X,VJ(Y,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:k=((U=u)==null?0:U.key)?g.Vw(u.key).entityId:"";if(!k||!Y.X){X.qF(5);break}return g.D(X,TX(k,Y.X,Y.j,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.D(X,R9R(Y.j,k),7);case 7:return g.D(X,H8(Y,k),8);case 8:m=X.K,fl({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:k,kO:u,offlineModeType:m}),gv(Y),EB(Y),g.KY(X)}})},HEC=function(Y,u,n){var U,k;
g.l(function(m){switch(m.j){case 1:if(!Y.K)return yJ(Y,"onTransferProgress: "+u),m.return();if(Y.K.transferState==="TRANSFER_STATE_TRANSFERRING"){m.qF(2);break}return g.D(m,bEJ(Y),2);case 2:U=Date.now();if(!(U-Y.rg>1E3)){m.qF(4);break}Y.rg=U;return g.D(m,vvy(Y.j,n.videoId,n.j,n.fl,n.bytesDownloaded,n.K),5);case 5:if(Y.N&&!(Y.N&&U-Y.KG>Y.zZ)){m.qF(4);break}Y.KG=U;return g.D(m,H8(Y,u),7);case 7:k=m.K,WMu({videoId:u,kO:Y.K,offlineModeType:k},n.bytesDownloaded,n.K);case 4:Y.G.start(108E5),g.KY(m)}})},
yGL=function(Y){var u=(Y.K.transferRetryCount||0)<3;
u&&(Y=Y.K,Y.transferRetryCount=(Y.transferRetryCount||0)+1);return u},VK$=function(Y,u){u=u===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":u;
var n,U,k,m;return g.l(function(X){if(X.j==1)return Y.K||yJ(Y,"setTransferToFailed: "+u),n="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u==="TRANSFER_FAILURE_REASON_NETWORK"?n="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":u==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(n="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.D(X,VJ(Y,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",u),2);if(X.j!=3)return P8(Y.oV,{entityKey:(U=Y.K)==null?void 0:U.key,failureReason:n}),
k=Y.K?g.Vw(Y.K.key).entityId:"",g.D(X,H8(Y,k),3);m=X.K;var S={videoId:k,kO:Y.K,offlineModeType:m},C=u,f={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};C&&(f.transferFailureReason=C,f.failureReason=IbR(C));fl(f,S);g.KY(X)})},VJ=function(Y,u,n,U){var k;
return g.l(function(m){if(m.j==1){if(!Y.K)return yJ(Y,"saveTransferState: "+u),m.return();Y.K.transferState=u;Y.K.failureReason=U;g.pY(m,2);return g.D(m,e9R(Y,function(X){return n?H$(X,"offlineVideoStreams",Y.K.offlineVideoStreams).then(function(S){for(var C=g.A(S),f=C.next();!f.done;f=C.next())if((f=f.value)&&f.streamsProgress){f=g.A(f.streamsProgress);for(var Q=f.next();!Q.done;Q=f.next())Q.value.streamState=n}return E1C(X,S.filter(function(N){return!!N}),"offlineVideoStreams")}):g.s$.resolve(void 0)}),
4)}if(m.j!=2)return g.Bc(m,0);
k=g.vc(m);return k instanceof g.QK&&k.type==="QUOTA_EXCEEDED"?g.D(m,Y.uS("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):m.qF(0)})},e9R=function(Y,u){var n;
return g.l(function(U){if(!Y.K)return U.return();n=Y.K;return g.D(U,q$(Y.j,{mode:"readwrite",A_:!0},function(k){var m=[VI(k,n,"transfer")];u&&m.push(u(k));return g.s$.all(m)}),0)})},gv=function(Y){Y.K=void 0;
Y.J=void 0;Y.G.stop()},IBX=function(Y,u){var n,U,k,m,X;
return g.l(function(S){if(S.j==1)return n=g.Vw(u.key),U=n.entityId,k=g.OV(U,"playbackData"),g.D(S,$M(Y.j,k,"playbackData"),2);m=S.K;if((X=m)==null?0:X.playerResponseJson)return S.return(JSON.parse(m.playerResponseJson));throw Error("No PlayerResponse found");})},yJ=function(Y,u){Y.api.fG("woffle",{mcte:u});
m6("missing current transfer entity.")},H8=function(Y,u){var n,U,k;
return g.l(function(m){if(m.j==1)return g.D(m,$M(Y.j,g.OV(u,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);n=m.K;return m.return((k=(U=n)==null?void 0:U.offlineModeType)!=null?k:void 0)})},z9G=function(Y){return OE$[Y.transferState]!==void 0},gvq=function(Y,u){var n=OE$[Y.transferState],U=OE$[u.transferState];
return n!==U?n-U:Number(Y.enqueuedTimestampMs)-Number(u.enqueuedTimestampMs)},OB=function(Y,u){var n=this;
this.xw=Y;this.api=u;this.W=new g.bD;this.J=new g.Nv;this.IH={Nf:function(){return n.X.IH.Nf()},
K9:function(){return n.W},
hCa:function(){return n.X},
V2:function(){return n.V2()},
vY:function(){return n.vY()},
t2:function(){return n.t2()},
Rw:function(){return n.Rw()},
Iw:function(){return n.Iw()},
jR:function(U){return n.jR(U)}};
this.X=new RxC(function(){return FUC(n)},function(){n.t2()},this.api.XY(),this.api.V.bind(this.api));
this.K=new XW(this.api);Dvy(this.X)},FUC=function(Y){return g.l(function(u){Y.api.Yw("onOrchestrationBecameLeader");
return g.D(u,Y.vY(),0)})},qNu=function(Y){var u,n;
return g.l(function(U){if(U.j==1)return g.D(U,uP(),2);if(U.j!=3){u=U.K;if(!u)return m6("PES is undefined"),U.return();Y.j=new D8$(u,Y.api,Y.X,Y.K);n=Y.xu(u);return g.D(U,iEL(u,n,Y.X,Y.K,Y.xw),3)}Y.S=U.K;return g.D(U,JGQ(Y),0)})},JGQ=function(Y){var u;
return g.l(function(n){switch(n.j){case 1:if(!Y.j)return m6("transferManager is undefined"),n.return();if(Y.j.K){n.qF(2);break}return g.D(n,EB(Y.j),2);case 2:if(!Y.xw.V("woffle_enable_main_downloads_library")){n.qF(4);break}return g.D(n,Y.vR(),4);case 4:if(!Y.xw.V("html5_offline_playback_position_sync")){n.qF(6);break}return g.D(n,Y.gU(),7);case 7:return g.D(n,Y.jR(864E5),6);case 6:return g.D(n,Y.refreshAllStaleEntities(43200,!0),9);case 9:return g.D(n,Y.nK(),10);case 10:if(!Y.xw.V("html5_retry_downloads_for_expiration")){n.qF(11);
break}return g.D(n,Y.Iw(),11);case 11:return Y.Z=g.NI(function(){Y.refreshAllStaleEntities(43200,!0);Y.nK()},9E5),g.VT(g.FJ(),function(){return Y.Rw()}),g.D(n,uP(),13);
case 13:return u=n.K,g.D(n,vWJ(u),14);case 14:xvB(Y.X),g.KY(n)}})},aBg=function(){var Y,u,n,U,k,m;
return g.l(function(X){switch(X.j){case 1:return g.D(X,uP(),2);case 2:Y=X.K;if(!Y)return X.return([]);u=Date.now()/1E3;return g.D(X,Yx(Y,"offlineVideoPolicy"),3);case 3:n=X.K,U=g.A(n),k=U.next();case 4:if(k.done){X.qF(6);break}m=k.value;if(!(m.expirationTimestamp&&Number(m.expirationTimestamp)<u)){X.qF(5);break}m.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";m.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.D(X,aq(Y,m,"offlineVideoPolicy"),5);
case 5:k=U.next();X.qF(4);break;case 6:return X.return(n.map(function(S){return S.key}))}})},FW=function(Y,u,n,U,k){var m,X,S;
return g.l(function(C){if(C.j==1)return g.D(C,uP(),2);m=C.K;if(!m)return C.return([]);X=u.map(function(f){var Q=g.OV(f,n);Q={actionType:U,entityKey:Q,actionMetadata:Object.assign({},ytG(),k)};U!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(Q.actionMetadata.priority=0);f=new dv(n,f,Q);return AK(f)});
S=$ER(m,X);Dvy(Y.X);return C.return(S)})},$8Q=function(Y,u,n,U){var k,m,X,S,C,f,Q,N;
return g.l(function(Z){switch(Z.j){case 1:k=[],m=g.A(u),X=m.next();case 2:if(X.done){Z.qF(4);break}S=X.value;if(S.upToDate||n&&!S.shouldAutoSyncMetadata||!S.playlistId){Z.qF(3);break}C={};switch(U){case "mainPlaylistEntity":f={nextAutoRefreshIntervalSeconds:S.checkInSeconds,autoSync:n};C={mainPlaylistEntityActionMetadata:f};break;case "musicPlaylist":Q={autoSync:n},C={musicPlaylistEntityActionMetadata:Q}}return g.D(Z,FW(Y,[S.playlistId],U,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",C),6);case 6:(N=
Z.K)&&k.push.apply(k,g.Zu(N));case 3:X=m.next();Z.qF(2);break;case 4:return Z.return(k)}})},Y_$=function(Y,u){var n;
return g.l(function(U){return u.length?(n=ytG(),g.DI(n,wv,{isEnqueuedForExpiredStreamUrlRefetch:!0}),Y.api.fG("qrd",{v:u.length}),U.return(FW(Y,u,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",n))):U.return([])})},ucL=function(Y,u,n){this.K=Y;
this.xw=u;this.X=n},k6q=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c;
return g.l(function(x){switch(x.j){case 1:return n=QJ(u),U=g.Vw(u.entityKey),k=U.entityId,m=[],g.pY(x,2),g.D(x,nKX(Y,k),4);case 4:m=x.K;if(!(Y.xw.V("woffle_enable_main_downloads_library")&&((X=m)==null?0:X.length))){x.qF(5);break}return g.D(x,msu(Y.K,[u.entityKey]),5);case 5:g.Bc(x,3);break;case 2:return S=g.vc(x),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.QK&&S.type==="QUOTA_EXCEEDED"?(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):m6("Playlist add error"),x.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,C,f));case 3:Q=[];if(!Y.xw.V("html5_offline_prevent_redownload_downloaded_video")){x.qF(7);break}return g.D(x,EWu(Y.K,"mainVideoEntity",m),8);case 8:m=x.K;case 7:if((N=m)==null?0:N.length)for(Z=g.A(m),T=Z.next();!T.done;T=Z.next())if(r=T.value,K=r.offlineVideoData,L=void 0,(L=K)==null?0:L.videoId)R=void 0,c=Number(((R=u.actionMetadata)==null?void 0:R.priority)||
0)+1,Q.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",K.videoId,"mainVideoEntity",c,JK,UdL(u,K,k)));return x.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,Q))}})},XQQ=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0,SM,CY,uB,cc,J7,uQ,sq,CR,Du,XH,Wu,Hu,Pq,v,IK,x$,Uu,ty,p,nY,Dn,Cu,z$,Ou,Uq,nu,zd,t,G,B,h,I,Nm,y,a,w,h7,Eu,Pc,NX,xe,t7,UD,LR,eB,ot,pi,Rt,lQ,Bu;
return g.l(function(S8){switch(S8.j){case 1:return n=QJ(u),U=u.entityKey,k=g.Vw(U).entityId,m=[],X=!1,k==="!*$_ALL_ENTITIES_!*$"?(X=!0,g.D(S8,Yx(Y.K,"mainPlaylistEntity"),5)):g.D(S8,$M(Y.K,U,"mainPlaylistEntity"),4);case 4:(S=S8.K)&&m.push(S);S8.qF(3);break;case 5:m=S8.K;case 3:if((C=m)==null||!C.length)return S8.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));f=g.z(u.actionMetadata,mdq);N=(Q=f)==null?void 0:Q.nextAutoRefreshIntervalSeconds;T=(Z=f)==null?void 0:Z.autoSync;r=[];L=K=
!0;R=!1;if(!X&&T===!1){S8.qF(6);break}g.pY(S8,7);return g.D(S8,dsC(0,!!T,!0,m),9);case 9:r=S8.K;g.Bc(S8,8);break;case 7:c=g.vc(S8);if(!(c instanceof Error&&c.message==="No data")){c instanceof Error&&c.message==="Empty response body"&&m6(c.message);S8.qF(8);break}return k==="!*$_ALL_ENTITIES_!*$"?g.D(S8,$vJ(Y.K,u,Y.X,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.D(S8,qvL(k,Y.K,u,Y.X),8);case 8:if(!r.length||!X&&r[0].playlistId!==k)return S8.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n));case 6:if(X){x=[];W=g.A(r);for(E=W.next();!E.done;E=W.next())J=E.value,J.upToDate||T&&!J.shouldAutoSyncMetadata||!J.playlistId||(O={nextAutoRefreshIntervalSeconds:J.checkInSeconds,autoSync:T},x.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",J.playlistId,"mainPlaylistEntity",0,JK,{mainPlaylistEntityActionMetadata:O})));return S8.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,x))}r.length&&(Xd=r[0],R=!!Xd.upToDate,T&&(K=(T0=Xd.shouldAutoSyncMetadata)!=null?T0:!0,L=(SM=Xd.shouldAutoSyncVideos)!=
null?SM:!0,Xd.checkInSeconds&&(N=Xd.checkInSeconds)));if(R||!K)return S8.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));CY=[];uB=m[0];if(!uB.downloadState){cc=void 0;S8.qF(15);break}return g.D(S8,$M(Y.K,uB.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:cc=S8.K;case 15:return J7=cc,sq=((uQ=J7)==null?0:uQ.addedTimestampMillis)?String(J7.addedTimestampMillis):void 0,g.pY(S8,17),g.D(S8,nKX(Y,k,sq,N),19);case 19:CY=S8.K;g.Bc(S8,18);break;case 17:CR=g.vc(S8);if(!(CR instanceof
Error&&CR.message==="No data for playlist")){if(CR instanceof Error&&CR.message==="Empty response body for playlist")m6(CR.message);else return Du="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",XH="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",CR instanceof g.QK&&CR.type==="QUOTA_EXCEEDED"&&(Du="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",XH="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),S8.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,Du,XH));
S8.qF(18);break}return g.D(S8,qvL(k,Y.K,u,Y.X),18);case 18:if(!L)return S8.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));Wu=[];Hu=new Map;if((Pq=CY)==null?0:Pq.length)for(v=g.A(CY),IK=v.next();!IK.done;IK=v.next())x$=IK.value,Uu=x$.offlineVideoData,ty=void 0,((ty=Uu)==null?0:ty.videoId)&&Hu.set(Uu.videoId,Uu);p=new Map;nY=[];if((Dn=uB)==null?0:(Cu=Dn.videos)==null?0:Cu.length)for(z$=g.A(uB.videos),Ou=z$.next();!Ou.done;Ou=z$.next())if(Uq=Ou.value,nu=JSON.parse(g.Vw(Uq).entityId),
zd=nu.videoId)Hu.has(zd)?(p.set(zd,Hu.get(zd)),Hu.delete(zd)):nY.push(zd);G=Number(((t=u.actionMetadata)==null?void 0:t.priority)||0)+1;B=g.A(Hu.entries());for(h=B.next();!h.done;h=B.next())I=h.value,Nm=g.A(I),y=Nm.next().value,a=Nm.next().value,w=y,h7=a,Wu.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",w,"mainVideoEntity",G,JK,UdL(u,h7,k)));Eu=g.A(p.entries());for(Pc=Eu.next();!Pc.done;Pc=Eu.next())NX=Pc.value,xe=g.A(NX),t7=xe.next().value,UD=xe.next().value,LR=t7,eB=UD,Wu.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
LR,"mainVideoEntity",G,JK,UdL(u,eB,k)));ot=g.A(nY);for(pi=ot.next();!pi.done;pi=ot.next())Rt=pi.value,lQ={playlistId:k},Bu={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:lQ},Wu.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Rt,"mainVideoEntity",0,JK,Bu));return S8.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,Wu))}})},PYB=function(Y,u){var n,U,k,m;
return g.l(function(X){switch(X.j){case 1:return n=QJ(u),g.pY(X,2),U=g.Vw(u.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.D(X,$vJ(Y.K,u,Y.X,(k=u.actionMetadata)==null?void 0:(m=k.offlineLoggingData)==null?void 0:m.offlineDeleteReason),5):g.D(X,qvL(U,Y.K,u,Y.X),6);case 6:if(!Y.xw.V("woffle_enable_main_downloads_library")){X.qF(5);break}return g.D(X,XAX(Y.K,u.entityKey),5);case 5:g.Bc(X,3);break;case 2:return g.vc(X),X.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return X.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n))}})},nKX=function(Y,u,n,U){var k,m,X,S,C,f,Q;
return g.l(function(N){switch(N.j){case 1:return g.D(N,MUX([u]),2);case 2:return k=N.K,g.D(N,S_u(Y,k[0],n,U),3);case 3:return m=N.K,X=m.mainPlaylistEntity,S=m.w4g,f=FMq(X,(C=S)==null?void 0:C.avatar),g.pY(N,4),g.D(N,Kl(f),6);case 6:g.Bc(N,5);break;case 4:Q=g.vc(N),Q instanceof Error&&Q.message==="Failed to fetch"&&m6(Q.message);case 5:return N.return(k[0].videos)}})},S_u=function(Y,u,n,U){var k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W;
return g.l(function(E){switch(E.j){case 1:k=Date.now().toString();n||(n=k);m=u.videos;X=u.playlistId;S=[];C=[];if(m)for(f=g.A(m),Q=f.next();!Q.done;Q=f.next()){N=Q.value;Z=N.offlineVideoData;if(!Z||!Z.videoId)throw m6("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");T=Z.videoId;r={videoId:T,playlistId:X};K={id:g.OV(JSON.stringify(r),"mainPlaylistVideoEntity"),video:g.OV(T,"mainVideoEntity")};S.push(K);C.push(K.id)}R={key:g.OV(X,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:n,lastSyncedTimestampMillis:k};c={key:g.OV(X,"mainPlaylistEntity"),playlistId:X,videos:C,title:u.title,thumbnailStyleData:CYy(u),visibility:fCq(u),downloadState:R.key};u.channel&&(x=u.channel.offlineChannelData,L=QJq(g.OV(X,"ytMainChannelEntity"),x),c.channelOwner=L.id);((W=c)==null?0:W.entityMetadata)?(c.entityMetadata.offlineLastModifiedTimestampSeconds=u.lastModifiedTimestamp,U&&(c.entityMetadata.nextAutoRefreshIntervalSeconds=String(U))):c&&(c.entityMetadata={nextAutoRefreshIntervalSeconds:U?
String(U):void 0,offlineLastModifiedTimestampSeconds:u.lastModifiedTimestamp});g.pY(E,2);return g.D(E,q$(Y.K,{mode:"readwrite",A_:!0},function(J){var O=VI(J,c,"mainPlaylistEntity"),Xd=VI(J,R,"mainPlaylistDownloadStateEntity");O=[O,Xd];Xd=g.A(S);for(var T0=Xd.next();!T0.done;T0=Xd.next())O.push(VI(J,T0.value,"mainPlaylistVideoEntity"));L&&O.push(VI(J,L,"ytMainChannelEntity"));return g.s$.all(O)}),4);
case 4:g.Bc(E,3);break;case 2:throw g.vc(E),m6("PES failure for playlist"),Error("PES failure for playlist");case 3:return E.return({mainPlaylistEntity:c,w4g:L,BuF:S})}})},QJq=function(Y,u){return{id:Y,
channelId:u.channelId,title:u.title,avatar:u.thumbnail}},CYy=function(Y){var u=[],n=Y.videos;
n&&n.length>0&&u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:n[0].offlineVideoData.thumbnail}}});if((Y=Y.additionalMetadadatas)&&Y.length>0)for(Y=g.A(Y),n=Y.next();!n.done;n=Y.next()){var U=n.value.offlineBundleItemPlaylistData,k=void 0;n=(k=U)==null?void 0:k.style;k=void 0;U={collageThumbnail:{coverThumbnail:(k=U)==null?void 0:k.coverThumbnail}};switch(n){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:U});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:U});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:U});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":u.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:U})}}return u},fCq=function(Y){switch(Y.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},UdL=function(Y,u,n){u={offlineVideoData:u,
playlistId:n};if(Y=g.z(Y.actionMetadata,mdq))u.maximumDownloadQuality=Y.maximumDownloadQuality;return{mainVideoEntityActionMetadata:u}},Ns$=function(Y,u,n){this.K=Y;
this.xw=u;this.X=n},TsR=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r;
return g.l(function(K){switch(K.j){case 1:return n=QJ(u),U=g.Vw(u.entityKey),k=U.entityId,m=g.z(u.actionMetadata,qp),S=!((X=m)==null?0:X.playlistId),g.pY(K,2),g.D(K,iNQ(Y,k,void 0,(C=m)==null?void 0:C.offlineVideoData,S),4);case 4:g.Bc(K,3);break;case 2:return f=g.vc(K),Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.QK&&f.type==="QUOTA_EXCEEDED"&&(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
K.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,Q,N));case 3:Z=1;Z=Number(((T=u.actionMetadata)==null?void 0:T.priority)||0)+1;var L=(L=g.z(u.actionMetadata,qp))?{playbackDataActionMetadata:{maximumDownloadQuality:L.maximumDownloadQuality}}:void 0;r=lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"playbackData",Z,ZNB,L);return K.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,[r]))}})},rwL=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c;
return g.l(function(x){switch(x.j){case 1:return n=QJ(u),U=g.Vw(u.entityKey),k=U.entityId,g.D(x,$M(Y.K,u.entityKey,"mainVideoEntity"),2);case 2:m=x.K;if(!m){X=void 0;x.qF(3);break}return g.D(x,$M(Y.K,m.downloadState,"mainVideoDownloadStateEntity"),4);case 4:X=x.K;case 3:S=X;if(!m||!S)return x.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));g.pY(x,5);return g.D(x,iNQ(Y,k,S.addedTimestampMillis,(f=g.z(u.actionMetadata,qp))==null?void 0:f.offlineVideoData),7);case 7:Q=1;Q=Number(((N=
u.actionMetadata)==null?void 0:N.priority)||0)+1;C=lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k,"playbackData",Q,ZNB);g.Bc(x,6);break;case 5:Z=g.vc(x);if(!(Z instanceof Error&&Z.message==="No data")){if(Z instanceof Error&&Z.message==="Empty response body")m6(Z.message);else return T="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",r="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.QK&&Z.type==="QUOTA_EXCEEDED"&&(T="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
r="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),x.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,T,r));x.qF(6);break}return g.D(x,tK(Y.K,k),9);case 9:K=x.K;L=g.z(u.actionMetadata,qp);if(c=(R=L)==null?void 0:R.playlistId)K.playlistId=c;K.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.D(x,pl(k,Y.K,u,Y.X,K),6);case 6:return x.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,C?[C]:void 0))}})},MuL=function(Y,u){var n,U,k,m,X,S,C,f,Q,N;
return g.l(function(Z){switch(Z.j){case 1:return n=QJ(u),g.pY(Z,2),U=g.Vw(u.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.D(Z,$vJ(Y.K,u,Y.X,(Q=u.actionMetadata)==null?void 0:(N=Q.offlineLoggingData)==null?void 0:N.offlineDeleteReason),5):g.D(Z,tK(Y.K,U),6);case 6:k=Z.K;m=g.z(u.actionMetadata,qp);if(S=(X=m)==null?void 0:X.playlistId)k.playlistId=S;k.offlineDeleteReason=(C=u.actionMetadata)==null?void 0:(f=C.offlineLoggingData)==null?void 0:f.offlineDeleteReason;return g.D(Z,pl(U,Y.K,u,Y.X,k),7);
case 7:if(!Y.xw.V("woffle_enable_main_downloads_library")){Z.qF(5);break}return g.D(Z,XAX(Y.K,u.entityKey),5);case 5:g.Bc(Z,3);break;case 2:return g.vc(Z),Z.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n))}})},iNQ=function(Y,u,n,U,k){var m,X,S,C,f,Q;
return g.l(function(N){switch(N.j){case 1:if(m=U){N.qF(2);break}return g.D(N,rFR([u]),3);case 3:X=N.K,m=X[0];case 2:return g.D(N,sJG(Y,m,n,k),4);case 4:S=N.K;C=S.mainVideoEntity;f=S.channelEntity;g.pY(N,5);var Z=sB(C.thumbnail),T=sB(f.avatar);return g.D(N,Kl(Z.concat(T)),7);case 7:g.Bc(N,0);break;case 5:Q=g.vc(N),Q instanceof Error&&Q.message==="Failed to fetch"&&m6(Q.message),g.KY(N)}})},sJG=function(Y,u,n,U){var k,m,X,S,C,f,Q,N,Z,T,r,K,L;
return g.l(function(R){switch(R.j){case 1:n||(n=Date.now().toString());m=(k=u.channel)==null?void 0:k.offlineChannelData;X={id:g.OV(u.videoId,"ytMainChannelEntity"),channelId:m.channelId,title:m.title,avatar:m.thumbnail};S={key:g.OV(u.videoId,"mainVideoDownloadStateEntity"),playbackData:g.OV(u.videoId,"playbackData"),addedTimestampMillis:n,videoDownloadContextEntity:g.OV(u.videoId,"videoDownloadContextEntity")};C={key:g.OV(u.videoId,"videoPlaybackPositionEntity"),videoId:u.videoId,lastPlaybackPositionSeconds:"0"};
Y.xw.V("html5_offline_playback_position_sync")&&(f={playbackPosition:C.key});Q=g.OV(u.videoId,"mainVideoEntity");N={key:Q,videoId:u.videoId,title:u.title,thumbnail:u.thumbnail,localizedStrings:{viewCount:u.shortViewCountText},userState:f,lengthSeconds:u.lengthSeconds?Number(u.lengthSeconds):void 0,publishedTimestampMillis:u.publishedTimestamp?(Number(u.publishedTimestamp)*1E3).toString():void 0,formattedDescription:u.description,owner:X.id,downloadState:S.key};if(!Y.xw.V("woffle_enable_main_downloads_library")||
!U){R.qF(2);break}return g.D(R,kLL(Y.K,[Q]),3);case 3:if(r=R.K)Z=r.mainDownloadsLibraryEntity,T=r.mainDownloadsListEntity;case 2:return L=gWR,K={key:g.OV(u.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.DI(S,L,K),g.D(R,q$(Y.K,{mode:"readwrite",A_:!0},function(c){var x=VI(c,X,"ytMainChannelEntity"),W=VI(c,S,"mainVideoDownloadStateEntity"),E=VI(c,N,"mainVideoEntity");x=[x,W,E];Y.xw.V("html5_offline_playback_position_sync")&&(W=VI(c,C,"videoPlaybackPositionEntity"),
x.push(W));Z&&(W=VI(c,Z,"mainDownloadsLibraryEntity"),x.push(W));T&&(W=VI(c,T,"mainDownloadsListEntity"),x.push(W));K&&(c=VI(c,K,"downloadStatusEntity"),x.push(c));return g.s$.all(x)}),4);
case 4:return R.return({mainVideoEntity:N,channelEntity:X})}})},ddg=function(Y,u,n){this.K=Y;
this.xw=u;this.X=n},AwB=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0,SM,CY,uB;
return g.l(function(cc){switch(cc.j){case 1:return n=QJ(u),U=[],g.D(cc,Iq.getInstance(),2);case 2:k=cc.K;if(!k){cc.qF(3);break}return g.D(cc,k.get("sdois"),4);case 4:return m=cc.K,g.D(cc,(S=k)==null?void 0:S.get("lmqf"),5);case 5:X=cc.K;case 3:g.pY(cc,6);if(m===void 0)throw Error("prefStorage or opt-in state is undefined");C=[];if(m){cc.qF(8);break}return g.D(cc,Usg(Y.K),9);case 9:C=cc.K,C.reverse();case 8:if(!C.length){cc.qF(10);break}f=g.A(C);Q=f.next();case 11:if(Q.done){cc.qF(10);break}N=Q.value;
if(!N){cc.qF(12);break}Z=g.Vw(N).entityId;return g.D(cc,tK(Y.K,Z),14);case 14:return T=cc.K,T.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.D(cc,pl(Z,Y.K,{entityKey:N,actionType:u.actionType},Y.X,T),12);case 12:Q=f.next();cc.qF(11);break;case 10:return g.D(cc,AFu(m,(r=X)!=null?r:"SD"),16);case 16:return K=cc.K,g.D(cc,YQC(K),17);case 17:L=n8$(K);if(!Y.xw.V("woffle_enable_main_downloads_library")){cc.qF(18);break}if(m){cc.qF(19);break}return g.D(cc,XAX(Y.K,g.IM),19);case 19:return g.D(cc,
msu(Y.K,[g.IM]),18);case 18:if((R=L)==null?0:R.length)for(c=g.A(L),x=c.next();!x.done;x=c.next())if(E=W=x.value,J=E.actionType,O=E.entityKey,Xd=E.actionMetadata,J&&O&&Xd&&!g.z(Xd,G6$)){J==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Xd.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(T0=g.z(W.actionMetadata,qp))T0.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",W.actionMetadata=Object.assign({},W.actionMetadata,{mainVideoEntityActionMetadata:T0});U.push(W)}g.Bc(cc,
7);break;case 6:return SM=g.vc(cc),CY="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",uB="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",SM instanceof g.QK&&SM.type==="QUOTA_EXCEEDED"&&(CY="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",uB="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),cc.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,CY,uB));case 7:return cc.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,U))}})},jJu=function(){OB.apply(this,
arguments);
this.N="mainVideoEntity"},KDJ=function(Y,u,n){u=u===void 0?43200:u;
n=n===void 0?!0:n;var U=U===void 0?!1:U;var k,m,X;return g.l(function(S){switch(S.j){case 1:if(!Y.W.XP())return S.return([]);k=[];g.pY(S,2);return g.D(S,dsC(u,n,U),4);case 4:k=S.K;g.Bc(S,3);break;case 2:m=g.vc(S),m instanceof Error&&m.message==="No data"||m instanceof Error&&m.message==="Empty response body"&&m6(m.message);case 3:return X=$8Q(Y,k,n,"mainPlaylistEntity"),S.return(X)}})},pQC=function(Y,u,n,U){U=U===void 0?!1:U;
var k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c;return g.l(function(x){switch(x.j){case 1:return k=[],g.D(x,GLR(),2);case 2:return(m=x.K)||U?g.D(x,jeQ(u,n),3):x.return([]);case 3:X=x.K;if((S=X)==null||!S.length)return x.return([]);C={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};f=g.A(X);Q=f.next();case 4:if(Q.done){x.qF(6);break}Z=N=Q.value;T=Z.actionType;r=Z.entityKey;K=Z.actionMetadata;if(!(T&&r&&K)||g.z(K,G6$)){x.qF(5);break}T==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(K.offlineLoggingData=
C);L=g.Vw(r);R=L.entityId;return g.D(x,FW(Y,[R],"mainVideoEntity",T,K),8);case 8:c=x.K,k=k.concat(c);case 5:Q=f.next();x.qF(4);break;case 6:return x.return(k)}})},LDu=function(Y,u){this.K=Y;
this.X=u},BsR=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R;
return g.l(function(c){switch(c.j){case 1:return n=QJ(u),U=g.Vw(u.entityKey),k=U.entityId,m=[],g.pY(c,2),g.D(c,tuJ(Y,k),4);case 4:m=c.K;if((X=m)==null||!X.length){c.qF(5);break}return g.D(c,QeX(Y.K,u.entityKey),5);case 5:g.Bc(c,3);break;case 2:return S=g.vc(c),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.QK&&S.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
c.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,C,f));case 3:return Q=[],g.D(c,EWu(Y.K,"musicTrack",m),7);case 7:m=c.K;if(m.length)for(N=g.A(m),Z=N.next();!Z.done;Z=N.next())if(T=Z.value,r=T.offlineVideoData,K=void 0,(K=r)==null?0:K.videoId)L=void 0,R=Number(((L=u.actionMetadata)==null?void 0:L.priority)||0)+1,Q.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",r.videoId,"musicTrack",R,ay,v8(u,r,k)));return c.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,Q))}})},
oKX=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0,SM,CY,uB,cc,J7,uQ,sq,CR,Du,XH,Wu,Hu,Pq,v,IK,x$,Uu,ty,p,nY,Dn,Cu,z$,Ou,Uq,nu,zd,t,G,B,h,I,Nm,y,a;
return g.l(function(w){switch(w.j){case 1:return n=QJ(u),U=u.entityKey,k=g.Vw(U).entityId,m=[],X=!1,k==="!*$_ALL_ENTITIES_!*$"?(X=!0,g.D(w,Yx(Y.K,"musicAlbumRelease"),5)):g.D(w,$M(Y.K,U,"musicAlbumRelease"),4);case 4:(S=w.K)&&m.push(S);w.qF(3);break;case 5:m=w.K;case 3:if((C=m)==null||!C.length)return w.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));if(X){f=[];Q=g.A(m);for(N=Q.next();!N.done;N=Q.next())Z=N.value,T=g.Vw(Z.id).entityId,f.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
T,"musicAlbumRelease",0,ay));return w.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,f))}r=[];K=m[0];L=void 0;if(!K.downloadMetadata){w.qF(6);break}return g.D(w,$M(Y.K,K.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:R=w.K,L=Number((x=(c=R)==null?void 0:c.addedTimestampMillis)!=null?x:"0")/1E3;case 6:return g.pY(w,8),g.D(w,tuJ(Y,k,(W=L)==null?void 0:W.toString()),10);case 10:r=w.K;g.Bc(w,9);break;case 8:E=g.vc(w);if(!(E instanceof Error&&E.message==="No data")){if(E instanceof
Error&&E.message==="Empty response body")m6(E.message);else return J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",E instanceof g.QK&&E.type==="QUOTA_EXCEEDED"&&(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",O="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),w.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,J,O));w.qF(9);break}return g.D(w,oy(k,"musicAlbumRelease",Y.K,u,Y.X),9);case 9:Xd=[];T0=new Map;
if((SM=r)==null?0:SM.length)for(CY=g.A(r),uB=CY.next();!uB.done;uB=CY.next())cc=uB.value,J7=cc.offlineVideoData,uQ=void 0,((uQ=J7)==null?0:uQ.videoId)&&T0.set(J7.videoId,J7);sq=new Map;CR=[];if((Du=K)==null?0:(XH=Du.tracks)==null?0:XH.length)for(Wu=g.A(K.tracks),Hu=Wu.next();!Hu.done;Hu=Wu.next())if(Pq=Hu.value,v=g.Vw(Pq).entityId)T0.has(v)?(sq.set(v,T0.get(v)),T0.delete(v)):CR.push(v);x$=Number(((IK=u.actionMetadata)==null?void 0:IK.priority)||0)+1;Uu=g.A(T0.entries());for(ty=Uu.next();!ty.done;ty=
Uu.next())p=ty.value,nY=g.A(p),Dn=nY.next().value,Cu=nY.next().value,z$=Dn,Ou=Cu,Xd.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",z$,"musicTrack",x$,ay,v8(u,Ou)));Uq=g.A(sq.entries());for(nu=Uq.next();!nu.done;nu=Uq.next())zd=nu.value,t=g.A(zd),G=t.next().value,B=t.next().value,h=G,I=B,Xd.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",h,"musicTrack",x$,ay,v8(u,I)));Nm=g.A(CR);for(y=Nm.next();!y.done;y=Nm.next())a=y.value,Xd.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",a,"musicTrack",
0,ay));return w.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,Xd))}})},cwu=function(Y,u){var n,U;
return g.l(function(k){switch(k.j){case 1:return n=QJ(u),g.pY(k,2),U=g.Vw(u.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.D(k,c8(Y.K,u,Y.X),5):g.D(k,oy(U,"musicAlbumRelease",Y.K,u,Y.X),6);case 6:return g.D(k,NHL(Y.K,u.entityKey),5);case 5:g.Bc(k,3);break;case 2:return g.vc(k),k.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n))}})},tuJ=function(Y,u,n){var U,k,m;
return g.l(function(X){switch(X.j){case 1:return g.D(X,MUX([u]),2);case 2:return U=X.K,g.D(X,vK$(Y,U[0],n),3);case 3:return k=X.K,m=sB(k.thumbnailDetails),g.D(X,Kl(m),4);case 4:return X.return(U[0].videos)}})},vK$=function(Y,u,n){var U,k,m,X,S,C,f,Q,N,Z,T,r,K,L;
return g.l(function(R){if(R.j==1){U=u.additionalMetadadatas;k=void 0;if(U&&U.length>0)for(m=g.A(U),X=m.next();!X.done;X=m.next())if(S=X.value,S.offlineMusicPlaylistData){k=S.offlineMusicPlaylistData;break}C=u.playlistId;f=ip$(u);Q=f.Id;N=f.xi;Z=n?(Number(n)*1E3).toString():Date.now().toString();T=u.lastModifiedTimestamp?(Number(u.lastModifiedTimestamp)*1E3).toString():"0";r={id:g.OV(C,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:N,lastModifiedTimestampMillis:T,addedTimestampMillis:Z,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};K={id:g.OV(C,"musicAlbumRelease"),title:u.title,audioPlaylistId:C,trackCount:u.totalVideoCount,tracks:Q,downloadMetadata:r.id};k&&(K.thumbnailDetails=(L=k.albumHqThumbnail)!=null?L:k.albumArtistThumbnail,K.artistDisplayName=k.albumArtistDisplayName,K.releaseDate=k.albumReleaseDate,K.contentRating={explicitType:k.albumReleaseExplicitType},K.releaseType=k.albumReleaseType);return g.D(R,q$(Y.K,{mode:"readwrite",A_:!0},function(c){var x=VI(c,K,"musicAlbumRelease");
c=VI(c,r,"musicAlbumReleaseDownloadMetadataEntity");return g.s$.all([x,c])}),2)}return R.return(K)})},RhX=function(Y,u){this.K=Y;
this.X=u},xdG=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R;
return g.l(function(c){switch(c.j){case 1:return n=QJ(u),U=g.Vw(u.entityKey),k=U.entityId,m=[],g.pY(c,2),g.D(c,Ddg(Y,k),4);case 4:m=c.K;if((X=m)==null||!X.length){c.qF(5);break}return g.D(c,QeX(Y.K,u.entityKey),5);case 5:g.Bc(c,3);break;case 2:return S=g.vc(c),C="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",S instanceof g.QK&&S.type==="QUOTA_EXCEEDED"&&(C="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",f="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
c.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,C,f));case 3:return Q=[],g.D(c,EWu(Y.K,"musicTrack",m),7);case 7:m=c.K;if(m.length)for(N=g.A(m),Z=N.next();!Z.done;Z=N.next())if(T=Z.value,r=T.offlineVideoData,K=void 0,(K=r)==null?0:K.videoId)L=void 0,R=Number(((L=u.actionMetadata)==null?void 0:L.priority)||0)+1,Q.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",r.videoId,"musicTrack",R,$x,v8(u,r,k)));return c.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,Q))}})},
lCB=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0,SM,CY,uB,cc,J7,uQ,sq,CR,Du,XH,Wu,Hu,Pq,v,IK,x$,Uu,ty,p,nY,Dn,Cu,z$,Ou,Uq,nu,zd,t,G,B,h,I,Nm,y,a,w,h7,Eu,Pc,NX,xe,t7,UD,LR,eB,ot,pi;
return g.l(function(Rt){switch(Rt.j){case 1:return n=QJ(u),U=u.entityKey,k=g.Vw(U).entityId,m=[],X=!1,k==="!*$_ALL_ENTITIES_!*$"?(X=!0,g.D(Rt,Yx(Y.K,"musicPlaylist"),5)):g.D(Rt,$M(Y.K,U,"musicPlaylist"),4);case 4:(S=Rt.K)&&m.push(S);Rt.qF(3);break;case 5:m=Rt.K;case 3:if((C=m)==null||!C.length)return Rt.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));f=g.z(u.actionMetadata,ZpR);N=(Q=f)==null?void 0:Q.autoSync;Z=[];r=T=!0;K=!1;L=void 0;if(!X&&N===!1){Rt.qF(6);break}g.pY(Rt,7);return g.D(Rt,
KJQ(0,!!N,!0,m),9);case 9:Z=Rt.K;g.Bc(Rt,8);break;case 7:R=g.vc(Rt);if(!(R instanceof Error&&R.message==="No data")){R instanceof Error&&R.message==="Empty response body"&&m6(R.message);Rt.qF(8);break}return k==="!*$_ALL_ENTITIES_!*$"?g.D(Rt,c8(Y.K,u,Y.X),8):g.D(Rt,oy(k,"musicPlaylist",Y.K,u,Y.X),8);case 8:if(!Z.length||!X&&Z[0].playlistId!==k)return Rt.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));case 6:if(X){c=[];x=g.A(Z);for(W=x.next();!W.done;W=x.next())E=W.value,E.upToDate||
N&&!E.shouldAutoSyncMetadata||!E.playlistId||(J={autoSync:N},c.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",E.playlistId,"musicPlaylist",0,$x,{musicPlaylistEntityActionMetadata:J})));return Rt.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,c))}Z.length&&(O=Z[0],K=!!O.upToDate,N&&(T=(Xd=O.shouldAutoSyncMetadata)!=null?Xd:!0,r=(T0=O.shouldAutoSyncVideos)!=null?T0:!0,O.checkInSeconds&&(L=O.checkInSeconds)));if(K||!T)return Rt.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n));SM=[];CY=m[0];uB=void 0;if(!CY.downloadMetadata){Rt.qF(15);break}return g.D(Rt,$M(Y.K,CY.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:cc=Rt.K,uB=Number((uQ=(J7=cc)==null?void 0:J7.addedTimestampMillis)!=null?uQ:"0")/1E3;case 15:return g.pY(Rt,17),g.D(Rt,Ddg(Y,k,(sq=uB)==null?void 0:sq.toString(),L),19);case 19:SM=Rt.K;g.Bc(Rt,18);break;case 17:CR=g.vc(Rt);if(!(CR instanceof Error&&CR.message==="No data")){if(CR instanceof Error&&CR.message==="Empty response body")m6(CR.message);
else return Du="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",XH="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",CR instanceof g.QK&&CR.type==="QUOTA_EXCEEDED"&&(Du="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",XH="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Rt.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,Du,XH));Rt.qF(18);break}return g.D(Rt,oy(k,"musicPlaylist",Y.K,u,Y.X),18);case 18:if(!r)return Rt.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n));Wu=[];Hu=new Map;if((Pq=SM)==null?0:Pq.length)for(v=g.A(SM),IK=v.next();!IK.done;IK=v.next())x$=IK.value,Uu=x$.offlineVideoData,ty=void 0,((ty=Uu)==null?0:ty.videoId)&&Hu.set(Uu.videoId,Uu);p=new Map;nY=[];if((Dn=CY)==null?0:(Cu=Dn.tracks)==null?0:Cu.length)for(z$=g.A(CY.tracks),Ou=z$.next();!Ou.done;Ou=z$.next())if(Uq=Ou.value,nu=g.Vw(Uq).entityId)Hu.has(nu)?(p.set(nu,Hu.get(nu)),Hu.delete(nu)):nY.push(nu);t=Number(((zd=u.actionMetadata)==null?void 0:zd.priority)||0)+1;G=g.A(Hu.entries());for(B=
G.next();!B.done;B=G.next())h=B.value,I=g.A(h),Nm=I.next().value,y=I.next().value,a=Nm,w=y,Wu.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",a,"musicTrack",t,$x,v8(u,w)));h7=g.A(p.entries());for(Eu=h7.next();!Eu.done;Eu=h7.next())Pc=Eu.value,NX=g.A(Pc),xe=NX.next().value,t7=NX.next().value,UD=xe,LR=t7,Wu.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",UD,"musicTrack",t,$x,v8(u,LR)));eB=g.A(nY);for(ot=eB.next();!ot.done;ot=eB.next())pi=ot.value,Wu.push(lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
pi,"musicTrack",0,$x));return Rt.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,Wu))}})},hh$=function(Y,u){var n,U;
return g.l(function(k){switch(k.j){case 1:return n=QJ(u),g.pY(k,2),U=g.Vw(u.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.D(k,c8(Y.K,u,Y.X),5):g.D(k,oy(U,"musicPlaylist",Y.K,u,Y.X),6);case 6:return g.D(k,NHL(Y.K,u.entityKey),5);case 5:g.Bc(k,3);break;case 2:return g.vc(k),k.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n))}})},Ddg=function(Y,u,n,U){var k,m,X;
return g.l(function(S){switch(S.j){case 1:return g.D(S,MUX([u]),2);case 2:return k=S.K,g.D(S,wQ$(Y,k[0],n,U),3);case 3:return m=S.K,X=sB(m.thumbnailDetails),g.D(S,Kl(X),4);case 4:return S.return(k[0].videos)}})},wQ$=function(Y,u,n,U){var k,m,X,S,C,f,Q,N,Z;
return g.l(function(T){return T.j==1?(k=u.playlistId,m=ip$(u),X=m.Id,S=m.xi,C=n?(Number(n)*1E3).toString():Date.now().toString(),f=u.lastModifiedTimestamp?(Number(u.lastModifiedTimestamp)*1E3).toString():"0",Q={id:g.OV(k,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:S,lastModifiedTimestampMillis:f,addedTimestampMillis:C,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},N={id:g.OV(k,"musicPlaylist"),title:u.title,playlistId:k,thumbnailDetails:u.thumbnail,visibility:WDL(u),trackCount:u.totalVideoCount,
tracks:X,downloadMetadata:Q.id},U&&(((Z=N)==null?0:Z.entityMetadata)?N.entityMetadata.nextAutoRefreshIntervalSeconds=String(U):N&&(N.entityMetadata={nextAutoRefreshIntervalSeconds:String(U)})),g.D(T,q$(Y.K,{mode:"readwrite",A_:!0},function(r){var K=VI(r,N,"musicPlaylist");r=VI(r,Q,"musicPlaylistDownloadMetadataEntity");return g.s$.all([K,r])}),2)):T.return(N)})},WDL=function(Y){switch(Y.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},ehX=function(Y,u){this.K=Y;
this.X=u},gKR=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r;
return g.l(function(K){switch(K.j){case 1:return n=QJ(u),U=g.Vw(u.entityKey),k=U.entityId,m=g.z(u.actionMetadata,bNB),g.pY(K,2),g.D(K,ICG(Y,k,void 0,(X=m)==null?void 0:X.track,(S=m)==null?void 0:S.albumRelease),4);case 4:if((C=m)==null?0:C.playlistId){K.qF(5);break}return g.D(K,QeX(Y.K,u.entityKey),5);case 5:g.Bc(K,3);break;case 2:return f=g.vc(K),Q="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.QK&&f.type==="QUOTA_EXCEEDED"&&
(Q="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),K.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,Q,N));case 3:T=Number(((Z=u.actionMetadata)==null?void 0:Z.priority)||0)+1;var L=(L=g.z(u.actionMetadata,bNB))?{playbackDataActionMetadata:{maximumDownloadQuality:L.maximumDownloadQuality}}:void 0;r=lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",k,"playbackData",T,zhy,L);return K.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n,[r]))}})},EKL=function(Y,u){var n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L;
return g.l(function(R){switch(R.j){case 1:return n=QJ(u),U=g.Vw(u.entityKey),k=U.entityId,g.D(R,$M(Y.K,u.entityKey,"musicTrack"),2);case 2:m=R.K;if(!m){X=void 0;R.qF(3);break}return g.D(R,$M(Y.K,m.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:X=R.K;case 3:S=X;if(!m||!S)return R.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n));f=g.z(u.actionMetadata,bNB);g.pY(R,5);return g.D(R,ICG(Y,k,S.addedTimestampMillis,(Q=f)==null?void 0:Q.track,(N=f)==null?void 0:N.albumRelease),
7);case 7:T=Number(((Z=u.actionMetadata)==null?void 0:Z.priority)||0)+1;C=lP("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",k,"playbackData",T,zhy);g.Bc(R,6);break;case 5:r=g.vc(R);if(!(r instanceof Error&&r.message==="No data")){if(r instanceof Error&&r.message==="Empty response body")m6(r.message);else return K="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",r instanceof g.QK&&r.type==="QUOTA_EXCEEDED"&&(K="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),R.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,K,L));R.qF(6);break}return g.D(R,B8(k,Y.K,u,Y.X),6);case 6:return R.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",n,C?[C]:void 0))}})},HNu=function(Y,u){var n,U;
return g.l(function(k){switch(k.j){case 1:return n=QJ(u),g.pY(k,2),U=g.Vw(u.entityKey).entityId,U==="!*$_ALL_ENTITIES_!*$"?g.D(k,c8(Y.K,u,Y.X),5):g.D(k,B8(U,Y.K,u,Y.X),6);case 6:return g.D(k,NHL(Y.K,u.entityKey),5);case 5:g.Bc(k,3);break;case 2:return g.vc(k),k.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",n,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return k.return(new hK("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
n))}})},ICG=function(Y,u,n,U,k){var m,X,S,C,f,Q;
return g.l(function(N){switch(N.j){case 1:if(m=U){N.qF(2);break}return g.D(N,rFR([u]),3);case 3:X=N.K,S=X[0],m=f7Q(S);case 2:return g.D(N,ywg(Y,m,u,k,n),4);case 4:C=N.K;f=C.musicTrackEntity;Q=C.eN;var Z=sB(f.thumbnailDetails),T=[];Q&&(T=sB(Q.thumbnailDetails));return g.D(N,Kl(Z.concat(T)),0)}})},ywg=function(Y,u,n,U,k){var m;
return g.l(function(X){return X.j==1?(k||(k=Date.now().toString()),m={id:g.OV(n,"musicTrackDownloadMetadataEntity"),playbackData:g.OV(n,"playbackData"),addedTimestampMillis:k,videoDownloadContextEntity:g.OV(n,"videoDownloadContextEntity")},U&&(u.albumRelease=U.id),g.D(X,q$(Y.K,{mode:"readwrite",A_:!0},function(S){var C=[],f=VI(S,m,"musicTrackDownloadMetadataEntity");C.push(f);f=VI(S,u,"musicTrack");C.push(f);U&&(S=VI(S,U,"musicAlbumRelease"),C.push(S));return g.s$.all(C)}),2)):X.j!=3?g.D(X,TX(n,"musicTrackDownloadMetadataEntity",
Y.K,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):X.return({musicTrackEntity:u,
eN:U})})},Y2=function(){OB.apply(this,arguments);
this.N="musicTrack"},Vu$=function(Y,u,n){u=u===void 0?43200:u;
n=n===void 0?!0:n;var U=U===void 0?!1:U;var k,m;return g.l(function(X){switch(X.j){case 1:if(!Y.W.XP())return X.return([]);k=[];g.pY(X,2);return g.D(X,KJQ(u,n,U),4);case 4:k=X.K;g.Bc(X,3);break;case 2:g.vc(X);case 3:return m=$8Q(Y,k,n,"musicPlaylist"),X.return(m)}})},ONB=function(){g.vH.apply(this,arguments);
var Y=this;this.events=new g.j3(this);this.xw=this.player.Y();this.IH={bQF:function(){return Y.K},
uA:function(){return Y.uA()},
I1:function(u){return Y.I1(u)}}},FD$=function(Y){var u;
Y=g.z((u=Y.getWatchNextResponse())==null?void 0:u.currentVideoEndpoint,g.pk);if(Y==null?0:Y.playlistId)var n=Y.playlistId;return n},JwX=function(Y,u){var n,U,k,m;
return g.l(function(X){if(X.j==1){n=u.clientPlaybackNonce;U={cpn:n,offlineSourceVisualElement:g.Tn(u.Fk||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};u.j&&(U.videoFmt=Number(u.j.itag));u.G&&(U.audioFmt=Number(u.G.itag));if((k=FD$(u))&&u.videoId){var S=u.videoId;S=k!=="PPSV"?Promise.resolve(!1):Y.K.Dm(S);X=g.D(X,S,3)}else X=X.qF(2);return X}X.j!=2&&(m=X.K)&&(U.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");Y.j=n;g.ka("offlinePlaybackStarted",U);g.KY(X)})};
g.Vs.prototype.yT=g.ke(45,function(Y){return this.app.yT(Y)});
g.Af.prototype.yT=g.ke(44,function(Y){return g.UhA(this,9,Y)});
g.d(eT,W$);g.mW.Object.defineProperties(eT.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.K.entityMetadata},
set:function(Y){this.K.entityMetadata=Y}}});
g.d(eFB,eT);eFB.prototype.j=function(){return[]};
g.d(btg,eT);btg.prototype.j=function(){return[]};
g.d(IM$,eT);IM$.prototype.j=function(){return[]};
g.d(zFy,eT);zFy.prototype.j=function(){return[]};
g.d(gVG,eT);gVG.prototype.j=function(){return[]};
g.d(EV$,eT);EV$.prototype.j=function(){var Y=[];this.K.alternateChannel&&Y.push(this.K.alternateChannel);this.K.alternateChannelList&&Y.push.apply(Y,g.Zu(this.K.alternateChannelList));this.K.oneofChannelEntity&&Y.push(this.K.oneofChannelEntity);return[].concat(g.Zu(new Set(Y)))};
g.d(HtB,eT);HtB.prototype.j=function(){var Y=[];this.K.entryCollection&&Y.push(this.K.entryCollection);return[].concat(g.Zu(new Set(Y)))};
g.d(yJg,W$);yJg.prototype.j=function(){var Y=[];this.K.video&&Y.push(this.K.video);return[].concat(g.Zu(new Set(Y)))};
g.d(VC$,eT);VC$.prototype.j=function(){var Y=[];this.K.parentPlaylist&&Y.push(this.K.parentPlaylist);if(this.K.entries)for(var u=g.A(this.K.entries),n=u.next();!n.done;n=u.next())Y.push.apply(Y,g.Zu((new yJg(n.value)).j()));return[].concat(g.Zu(new Set(Y)))};
g.d(OtX,eT);OtX.prototype.j=function(){var Y=[];this.K.descriptionEntity&&Y.push(this.K.descriptionEntity);this.K.creators&&Y.push.apply(Y,g.Zu(this.K.creators));this.K.theBiggestFan&&Y.push(this.K.theBiggestFan);return[].concat(g.Zu(new Set(Y)))};
g.d(F5y,eT);F5y.prototype.j=function(){return[]};
g.d(JJJ,eT);JJJ.prototype.j=function(){return[]};
g.d(qhg,eT);qhg.prototype.j=function(){return[]};
g.d(aMB,eT);aMB.prototype.j=function(){return[]};
g.d($SL,eT);$SL.prototype.j=function(){return[]};
g.d(YsX,eT);YsX.prototype.j=function(){return[]};
g.d(usg,eT);usg.prototype.j=function(){return[]};
g.d(nyq,eT);nyq.prototype.j=function(){return[]};
g.d(UYG,eT);UYG.prototype.j=function(){return[]};
g.d(kyB,eT);kyB.prototype.j=function(){var Y=[];this.K.downloadsList&&Y.push(this.K.downloadsList);this.K.smartDownloadsList&&Y.push(this.K.smartDownloadsList);this.K.recommendedDownloadsList&&Y.push(this.K.recommendedDownloadsList);this.K.refresh&&Y.push(this.K.refresh);return[].concat(g.Zu(new Set(Y)))};
g.d(mYq,W$);mYq.prototype.j=function(){var Y=[];this.K.video&&Y.push(this.K.video);this.K.playlist&&Y.push(this.K.playlist);this.K.videoItem&&Y.push(this.K.videoItem);this.K.playlistItem&&Y.push(this.K.playlistItem);return[].concat(g.Zu(new Set(Y)))};
g.d(XmR,eT);XmR.prototype.j=function(){var Y=[];this.K.refresh&&Y.push(this.K.refresh);if(this.K.downloads)for(var u=g.A(this.K.downloads),n=u.next();!n.done;n=u.next())Y.push.apply(Y,g.Zu((new mYq(n.value)).j()));return[].concat(g.Zu(new Set(Y)))};
g.d(Pry,eT);Pry.prototype.j=function(){var Y=[];this.K.localImageEntities&&Y.push.apply(Y,g.Zu(this.K.localImageEntities));return[].concat(g.Zu(new Set(Y)))};
g.d(Ssu,eT);Ssu.prototype.j=function(){var Y=[];this.K.playbackData&&Y.push(this.K.playbackData);this.K.localImageEntities&&Y.push.apply(Y,g.Zu(this.K.localImageEntities));this.K.videoDownloadContextEntity&&Y.push(this.K.videoDownloadContextEntity);return[].concat(g.Zu(new Set(Y)))};
g.d(Cr$,eT);Cr$.prototype.j=function(){return[]};
g.d(fkq,eT);fkq.prototype.j=function(){var Y=[];this.K.fakeChildren&&Y.push.apply(Y,g.Zu(this.K.fakeChildren));return[].concat(g.Zu(new Set(Y)))};
g.d(QFq,eT);QFq.prototype.j=function(){var Y=[];this.K.video&&Y.push(this.K.video);this.K.playbackData&&Y.push(this.K.playbackData);this.K.offlineVideoPolicy&&Y.push(this.K.offlineVideoPolicy);return[].concat(g.Zu(new Set(Y)))};
g.d(Ne$,eT);Ne$.prototype.j=function(){return[]};
g.d(ix$,eT);ix$.prototype.j=function(){var Y=[];this.K.channelOwner&&Y.push(this.K.channelOwner);this.K.videos&&Y.push.apply(Y,g.Zu(this.K.videos));this.K.collaboratorChannels&&Y.push.apply(Y,g.Zu(this.K.collaboratorChannels));this.K.downloadState&&Y.push(this.K.downloadState);this.K.refresh&&Y.push(this.K.refresh);return[].concat(g.Zu(new Set(Y)))};
g.d(ZxC,eT);ZxC.prototype.j=function(){var Y=[];this.K.video&&Y.push(this.K.video);this.K.channelContributor&&Y.push(this.K.channelContributor);return[].concat(g.Zu(new Set(Y)))};
g.d(Te$,W$);Te$.prototype.j=function(){var Y=[];this.K.localImageEntities&&Y.push.apply(Y,g.Zu(this.K.localImageEntities));this.K.videoDownloadContextEntity&&Y.push(this.K.videoDownloadContextEntity);return[].concat(g.Zu(new Set(Y)))};
g.d(rpR,W$);rpR.prototype.j=function(){var Y=[];this.K.recommendedVideoMetadata&&Y.push.apply(Y,g.Zu((new Te$(this.K.recommendedVideoMetadata)).j()));return[].concat(g.Zu(new Set(Y)))};
g.d(Maq,W$);Maq.prototype.j=function(){var Y=[];this.K.playbackPosition&&Y.push(this.K.playbackPosition);return[].concat(g.Zu(new Set(Y)))};
g.d(sFX,eT);sFX.prototype.j=function(){var Y=[];this.K.owner&&Y.push(this.K.owner);this.K.downloadState&&Y.push(this.K.downloadState);this.K.userState&&Y.push.apply(Y,g.Zu((new Maq(this.K.userState)).j()));this.K.additionalMetadata&&Y.push.apply(Y,g.Zu((new rpR(this.K.additionalMetadata)).j()));return[].concat(g.Zu(new Set(Y)))};
g.d(dYX,eT);dYX.prototype.j=function(){var Y=[];this.K.userChannelDetails&&Y.push(this.K.userChannelDetails);return[].concat(g.Zu(new Set(Y)))};
g.d(GyR,eT);GyR.prototype.j=function(){var Y=[];this.K.channelOwner&&Y.push(this.K.channelOwner);this.K.playbackPosition&&Y.push(this.K.playbackPosition);this.K.localImageEntities&&Y.push.apply(Y,g.Zu(this.K.localImageEntities));this.K.downloadStatus&&Y.push(this.K.downloadStatus);return[].concat(g.Zu(new Set(Y)))};
g.d(ApC,eT);ApC.prototype.j=function(){return[]};
g.d(jFX,eT);jFX.prototype.j=function(){return[]};
g.d(KvQ,eT);KvQ.prototype.j=function(){return[]};
g.d(pmG,eT);pmG.prototype.j=function(){return[]};
g.d(LvX,eT);LvX.prototype.j=function(){return[]};
g.d(taL,eT);taL.prototype.j=function(){return[]};
g.d(Beg,eT);Beg.prototype.j=function(){return[]};
g.d(oyG,eT);oyG.prototype.j=function(){return[]};
g.d(cpR,eT);cpR.prototype.j=function(){return[]};
g.d(vyX,eT);vyX.prototype.j=function(){return[]};
g.d(RIX,eT);RIX.prototype.j=function(){return[]};
g.d(DY$,eT);DY$.prototype.j=function(){return[]};
g.d(xY$,eT);xY$.prototype.j=function(){var Y=[];this.K.trackDownloadMetadatas&&Y.push.apply(Y,g.Zu(this.K.trackDownloadMetadatas));return[].concat(g.Zu(new Set(Y)))};
g.d(lk$,eT);
lk$.prototype.j=function(){var Y=[];this.K.downloadedTracks&&Y.push.apply(Y,g.Zu(this.K.downloadedTracks));this.K.smartDownloadedTracks&&Y.push.apply(Y,g.Zu(this.K.smartDownloadedTracks));this.K.downloadedEpisodes&&Y.push.apply(Y,g.Zu(this.K.downloadedEpisodes));this.K.downloadedAlbumReleases&&Y.push.apply(Y,g.Zu(this.K.downloadedAlbumReleases));this.K.smartDownloadedAlbumReleases&&Y.push.apply(Y,g.Zu(this.K.smartDownloadedAlbumReleases));this.K.downloadedPlaylists&&Y.push.apply(Y,g.Zu(this.K.downloadedPlaylists));this.K.smartDownloadedPlaylists&&
Y.push.apply(Y,g.Zu(this.K.smartDownloadedPlaylists));this.K.metadataOnlyTracks&&Y.push.apply(Y,g.Zu(this.K.metadataOnlyTracks));return[].concat(g.Zu(new Set(Y)))};
g.d(hIQ,eT);hIQ.prototype.j=function(){var Y=[];this.K.trackDownloadMetadatas&&Y.push.apply(Y,g.Zu(this.K.trackDownloadMetadatas));return[].concat(g.Zu(new Set(Y)))};
g.d(wm$,eT);wm$.prototype.j=function(){var Y=[];this.K.playbackData&&Y.push(this.K.playbackData);this.K.localImageEntities&&Y.push.apply(Y,g.Zu(this.K.localImageEntities));this.K.videoDownloadContextEntity&&Y.push(this.K.videoDownloadContextEntity);return[].concat(g.Zu(new Set(Y)))};
g.d(Wv$,eT);Wv$.prototype.j=function(){var Y=[];this.K.musicLibraryStatusEntity&&Y.push(this.K.musicLibraryStatusEntity);this.K.primaryArtists&&Y.push.apply(Y,g.Zu(this.K.primaryArtists));this.K.details&&Y.push(this.K.details);this.K.userDetails&&Y.push(this.K.userDetails);this.K.tracks&&Y.push.apply(Y,g.Zu(this.K.tracks));this.K.share&&Y.push(this.K.share);this.K.downloadMetadata&&Y.push(this.K.downloadMetadata);this.K.refresh&&Y.push(this.K.refresh);return[].concat(g.Zu(new Set(Y)))};
g.d(eIR,eT);eIR.prototype.j=function(){var Y=[];this.K.albumRelease&&Y.push(this.K.albumRelease);this.K.tracks&&Y.push.apply(Y,g.Zu(this.K.tracks));return[].concat(g.Zu(new Set(Y)))};
g.d(bxg,eT);bxg.prototype.j=function(){var Y=[];this.K.albumRelease&&Y.push(this.K.albumRelease);return[].concat(g.Zu(new Set(Y)))};
g.d(Ik$,eT);Ik$.prototype.j=function(){var Y=[];this.K.details&&Y.push(this.K.details);this.K.userDetails&&Y.push(this.K.userDetails);return[].concat(g.Zu(new Set(Y)))};
g.d(zIX,eT);zIX.prototype.j=function(){var Y=[];this.K.parentArtist&&Y.push(this.K.parentArtist);return[].concat(g.Zu(new Set(Y)))};
g.d(gyJ,eT);gyJ.prototype.j=function(){var Y=[];this.K.parentArtist&&Y.push(this.K.parentArtist);return[].concat(g.Zu(new Set(Y)))};
g.d(Ey$,eT);Ey$.prototype.j=function(){return[]};
g.d(Hx$,eT);Hx$.prototype.j=function(){return[]};
g.d(yp$,W$);yp$.prototype.j=function(){var Y=[];this.K.creatorEntity&&Y.push(this.K.creatorEntity);return[].concat(g.Zu(new Set(Y)))};
g.d(VaQ,eT);
VaQ.prototype.j=function(){var Y=[];this.K.tracks&&Y.push.apply(Y,g.Zu(this.K.tracks));this.K.refresh&&Y.push(this.K.refresh);this.K.musicLibraryStatusEntity&&Y.push(this.K.musicLibraryStatusEntity);this.K.details&&Y.push(this.K.details);this.K.downloadMetadata&&Y.push(this.K.downloadMetadata);this.K.sideloadMetadata&&Y.push(this.K.sideloadMetadata);this.K.userDetails&&Y.push(this.K.userDetails);this.K.entryCollection&&Y.push(this.K.entryCollection);this.K.share&&Y.push(this.K.share);this.K.podcastShowAdditionalMetadata&&
Y.push.apply(Y,g.Zu((new yp$(this.K.podcastShowAdditionalMetadata)).j()));return[].concat(g.Zu(new Set(Y)))};
g.d(Ox$,eT);Ox$.prototype.j=function(){return[]};
g.d(FvQ,eT);
FvQ.prototype.j=function(){var Y=[];this.K.musicLibraryStatusEntity&&Y.push(this.K.musicLibraryStatusEntity);this.K.artists&&Y.push.apply(Y,g.Zu(this.K.artists));this.K.audioModeVersion&&Y.push(this.K.audioModeVersion);this.K.videoModeVersion&&Y.push(this.K.videoModeVersion);this.K.userDetails&&Y.push(this.K.userDetails);this.K.details&&Y.push(this.K.details);this.K.albumRelease&&Y.push(this.K.albumRelease);this.K.share&&Y.push(this.K.share);this.K.libraryEdit&&Y.push(this.K.libraryEdit);this.K.downloadMetadata&&
Y.push(this.K.downloadMetadata);this.K.playbackPosition&&Y.push(this.K.playbackPosition);this.K.lyrics&&Y.push(this.K.lyrics);return[].concat(g.Zu(new Set(Y)))};
g.d(JpB,eT);JpB.prototype.j=function(){var Y=[];this.K.parentTrack&&Y.push(this.K.parentTrack);return[].concat(g.Zu(new Set(Y)))};
g.d(qsB,eT);qsB.prototype.j=function(){var Y=[];this.K.parentTrack&&Y.push(this.K.parentTrack);return[].concat(g.Zu(new Set(Y)))};
g.d(ak$,eT);ak$.prototype.j=function(){return[]};
g.d($YC,eT);$YC.prototype.j=function(){return[]};
g.d(Y6$,eT);Y6$.prototype.j=function(){return[]};
g.d(uZ$,eT);uZ$.prototype.j=function(){return[]};
g.d(n1u,eT);n1u.prototype.j=function(){var Y=[];this.K.transfer&&Y.push(this.K.transfer);this.K.adsPlaybackData&&Y.push.apply(Y,g.Zu(this.K.adsPlaybackData));this.K.drmLicense&&Y.push(this.K.drmLicense);this.K.offlineVideoPolicy&&Y.push(this.K.offlineVideoPolicy);this.K.videoDownloadContextEntity&&Y.push(this.K.videoDownloadContextEntity);return[].concat(g.Zu(new Set(Y)))};
g.d(UEq,eT);UEq.prototype.j=function(){return[]};
g.d(kEy,eT);kEy.prototype.j=function(){var Y=[];this.K.offlineVideoStreams&&Y.push.apply(Y,g.Zu(this.K.offlineVideoStreams));this.K.captionTrack&&Y.push.apply(Y,g.Zu(this.K.captionTrack));return[].concat(g.Zu(new Set(Y)))};
g.d(mEq,eT);mEq.prototype.j=function(){return[]};
g.d(XBq,eT);XBq.prototype.j=function(){return[]};
g.d(PsX,eT);PsX.prototype.j=function(){return[]};
g.d(S6B,eT);S6B.prototype.j=function(){return[]};
g.d(CsL,eT);CsL.prototype.j=function(){return[]};
g.d(fe$,eT);fe$.prototype.j=function(){return[]};
g.d(Q1q,eT);Q1q.prototype.j=function(){return[]};
g.d(NrG,eT);NrG.prototype.j=function(){return[]};
g.d(iHy,eT);iHy.prototype.j=function(){return[]};
g.d(ZH$,eT);ZH$.prototype.j=function(){return[]};
g.d(Trq,eT);Trq.prototype.j=function(){return[]};
g.d(rHy,eT);rHy.prototype.j=function(){return[]};
g.d(MdC,eT);MdC.prototype.j=function(){return[]};
g.d(s1$,eT);s1$.prototype.j=function(){return[]};
g.d(dE$,eT);dE$.prototype.j=function(){return[]};
g.d(GE$,eT);GE$.prototype.j=function(){return[]};
g.d(AHg,eT);AHg.prototype.j=function(){return[]};
g.d(j1y,eT);j1y.prototype.j=function(){return[]};
g.d(KiC,eT);KiC.prototype.j=function(){return[]};
g.d(pBQ,eT);pBQ.prototype.j=function(){return[]};
g.d(LiB,eT);LiB.prototype.j=function(){return[]};
var pAR=["browse","music/browse","unplugged/browse"],cFu=["offline/playlist_sync_check"],THJ=["offline"],LJX=["offline/offline_video_playback_position_sync"],BHG=["offline/get_playback_data_entity"],bM;Iq.getInstance=function(){return g.l(function(Y){return Y.return(new Promise(function(u){g.VK().then(function(n){n?(Iq.instance||(Iq.instance=new Iq(n)),u(Iq.instance)):u(void 0)})}))})};
Iq.prototype.get=function(Y){var u=this,n,U,k;return g.l(function(m){if(m.j==1)return g.D(m,cHC(u.token),2);if(m.j!=3)return n=m.K,g.D(m,n.get("prefs",Y),3);U=m.K;if(!U)return m.return();k=(0,g.j2)();return U.expirationTimestampMs<=k?m.return():m.return(U.value)})};
Iq.prototype.set=function(Y,u,n){n=n===void 0?31536E3:n;var U=this,k,m,X;return g.l(function(S){if(S.j==1)return k=(0,g.j2)(),m={key:Y,value:u,expirationTimestampMs:k+n*1E3},g.D(S,cHC(U.token),2);X=S.K;return g.D(S,g.oR(X,"prefs",m),0)})};
Iq.prototype.remove=function(Y){var u=this,n;return g.l(function(U){if(U.j==1)return g.D(U,cHC(u.token),2);n=U.K;return g.D(U,n.delete("prefs",Y),0)})};
g.d(zJ,g.zP);g.d(g4,leg);g4.prototype.X=function(Y,u){u=wBQ(u);Y=(new TextEncoder).encode(JSON.stringify(Y));return this.K.encrypt(Y,u)};
g4.prototype.j=function(Y,u){if(!(Y instanceof Uint8Array))throw v1g(1);var n=new TextDecoder;u=wBQ(u);Y=this.K.decrypt(Y,u);return JSON.parse(n.decode(Y))};
var Wiu={accountLinkStatusEntity:qhg,booleanEntity:zFy,buttonEntity:s1$,captionTrack:ak$,channelHandle:eFB,chipEntity:Q1q,commerceAcquisitionClientPayloadEntity:GE$,commerceCartListEntity:AHg,contextNoteFeedEntityPayload:btg,contextNoteUserRatingEntityPayload:IM$,continuationTokenEntity:Ne$,downloadQualityPickerEntity:usg,downloadsPageRefreshTokenEntity:UYG,downloadsPageViewConfigurationEntity:ApC,downloadStatusEntity:nyq,dismissState:NrG,sfvAudioItemCurrentlyPlayingEntity:S6B,emojiFountainDataEntity:rHy,
emojiCustomizationSetEntity:Trq,fakeChannel:EV$,fakePlaylist:HtB,fakePlaylistEntryCollection:VC$,fakeVideo:OtX,fakeVideoDescription:F5y,featuredProductsEntity:vyX,flowStateEntity:JJJ,iconBadgeEntity:j1y,interstitialInteractionStateEntity:$SL,likeButtonAnimationEntity:jFX,liveChatPollStateEntity:YsX,liveViewerLeaderboardChatEntryPointStateEntity:XBq,liveViewerLeaderboardPointsEntity:PsX,liveReactionsDataEntity:MdC,logoEntity:aMB,macroMarkerEntity:KvQ,mainDownloadsLibraryEntity:kyB,mainDownloadsListEntity:XmR,
mainPlaylistDownloadStateEntity:Pry,mainPlaylistEntity:ix$,mainPlaylistVideoEntity:ZxC,mainVideoDownloadStateEntity:Ssu,mainVideoEntity:sFX,markersEngagementPanelSyncEntity:pmG,markersVisibilityOverrideEntity:LvX,musicAlbumReleaseDetail:eIR,musicAlbumReleaseDownloadMetadataEntity:xY$,musicAlbumRelease:Wv$,musicAlbumReleaseUserDetail:bxg,musicArtistDetail:zIX,musicArtist:Ik$,musicArtistUserDetail:gyJ,musicDownloadsLibraryEntity:lk$,musicLibraryEdit:Ey$,musicLibraryStatusEntity:Hx$,musicPlaylist:VaQ,
musicPlaylistDownloadMetadataEntity:hIQ,musicShare:Ox$,musicTrackDetail:JpB,musicTrackDownloadMetadataEntity:wm$,musicTrack:FvQ,musicTrackUserDetail:qsB,offlineOrchestrationActionWrapperEntity:$YC,offlineVideoPolicy:Y6$,offlineVideoStreams:uZ$,offlineabilityEntity:Cr$,orchestrationWebSamplingEntity:fkq,pageHeaderEntity:iHy,pdpStateEntity:KiC,pinnedProductEntity:RIX,playbackData:n1u,playerStateEntity:taL,quantityIncrementerEntity:pBQ,refresh:UEq,saveToPlaylistListEntity:CsL,selectedChipIndexEntityPayload:Beg,
settingEntity:fe$,stringEntity:gVG,suggestedFeedbackChipStateEntity:oyG,transfer:kEy,trendingOfferEntity:DY$,videoDownloadContextEntity:mEq,videoOverviewAsyncDataEntity:LiB,videoPlaybackPositionEntity:dE$,votingEntity:ZH$,ytMainChannelEntity:dYX,youchatPendingResponseEntity:cpR,ytMainDownloadedVideoEntity:QFq,ytMainVideoEntity:GyR};g.d(Fq,leg);Fq.prototype.X=function(Y){return Y};
Fq.prototype.j=function(Y){if(Y instanceof Uint8Array)throw v1g(0);return Y};
g.d(JN,g.e);JN.prototype.observe=function(Y){var u=this;this.observers.push(Y);return function(){var n=u.observers.indexOf(Y);n>=0&&u.observers.splice(n,1)}};
JN.prototype.j=function(Y){aeG(this,Y.data)};
JN.prototype.nG=function(){this.channel.close()};
var Uv$,uDQ=new g.ju("elementsCommand");var Ll=new g.ju("entityBatchUpdate");var gWR=new g.ju("downloadStatusEntity");var mdq=new g.ju("mainPlaylistEntityActionMetadata");var qp=new g.ju("mainVideoEntityActionMetadata");var ZpR=new g.ju("musicPlaylistEntityActionMetadata");var bNB=new g.ju("musicTrackEntityActionMetadata");var G6$=new g.ju("localImageEntityActionMetadata");var wv=new g.ju("playbackDataActionMetadata");var nv$=new g.ju("transferEntityActionMetadata");var I7$=new g.ju("videoPlaybackPositionEntityActionMetadata");var sSq;new g.Nv;new g.Nv;KMq.prototype.request=function(Y,u,n){u=u===void 0?{}:u;return this.locks.request(Y,u,function(U){return n(U)})};var kx=g.$e.caches,UB,oW$;nl.prototype.open=function(Y){return kx.open(teu(Y))};
nl.prototype.has=function(Y){return kx.has(teu(Y))};
nl.prototype.delete=function(Y){return kx.delete(teu(Y))};
nl.prototype.match=function(Y,u){var n=this,U,k,m,X,S,C;return g.l(function(f){switch(f.j){case 1:return g.D(f,n.keys(),2);case 2:U=f.K,k=g.A(U),m=k.next();case 3:if(m.done){f.qF(5);break}X=m.value;return g.D(f,n.open(X),6);case 6:return S=f.K,g.D(f,S.match(Y,u),7);case 7:if(C=f.K)return f.return(C);m=k.next();f.qF(3);break;case 5:return f.return()}})};
g.d(LMq,nl);LMq.prototype.keys=function(){var Y,u,n,U,k,m,X,S,C;return g.l(function(f){if(f.j==1)return Y=[],u=g.gT("CacheStorage keys"),g.D(f,kx.keys(),2);n=f.K;U=g.A(n);for(k=U.next();!k.done;k=U.next()){m=k.value;var Q=m.indexOf(":");X=Q===-1?{vF:m}:{vF:m.substring(0,Q),datasyncId:m.substring(Q+1)};S=X.vF;C=X.datasyncId;C===u&&Y.push(S)}return f.return(Y)})};g.d(XW,g.e);XW.prototype.X=function(Y){this.api.Yw("onOfflineOperationFailure",Y.data)};
XW.prototype.G=function(Y){this.api.publish("offlinetransferpause",Y.data)};
XW.prototype.nG=function(){var Y;(Y=this.K)==null||Y.close();var u;(u=this.j)==null||u.close()};RxC.prototype.ke=function(){this.K&&S7(this)};
RxC.prototype.Af=function(){this.j&&this.j.resolve();this.X=this.K=!1;this.N()};var s0$=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var abg="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var CkQ="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.d(RW$,xx);RW$.prototype.j=function(Y){return Np(Y)?l7$(this,Y):iP(Y)?WJg(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};g.d(eWq,xx);eWq.prototype.j=function(Y){return iP(Y)?bpX(this,Y):zxg(Y)?zWJ(this,Y):Z6(Y)?g8B(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};g.M=E8$.prototype;g.M.IFc=function(Y){var u=this,n,U,k,m;return g.l(function(X){if(!g.V(Y.state,128))return X.qF(0);n=Y.state.Jt;var S=(U=n)==null?void 0:U.errorCode,C=(k=n)==null?void 0:k.yz;m=S==="net.connect"&&C===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(S==null?0:S.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.D(X,u.uS(u.player.getVideoData().videoId,m),0)})};
g.M.uS=function(Y,u){var n=this;return g.l(function(U){if(U.j==1){if(n.j)return U.return();n.j=!0;return u==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(bP(n,Y,!1,!0),U.qF(0)):g.D(U,e7(n,Y),3)}g.mS(Y,4);return g.D(U,n.K.uS(u),0)})};
g.M.k9=function(Y){Y.status===2?(Y.status!==this.X&&(bEJ(this.K),g.mS(Y.videoId,2)),Y.xf&&HEC(this.K,Y.videoId,Y.xf)):Y.status===4?(e7(this,Y.videoId),this.uS(Y.videoId,Y.yS?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):Y.status===1&&EvL(this.K);this.X=Y.status;this.api.Yw("localmediachange",{videoId:Y.videoId,status:Y.status})};
g.M.YY=function(){var Y=this,u;return g.l(function(n){if(n.j==1){if(Y.j)return n.return();Y.j=!0;u=Y.player.getVideoData().videoId;return g.D(n,e7(Y,u),2)}return g.D(n,Y.K.YY(),0)})};
g.M.OJ=function(Y){switch(Y){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.M.V=function(Y){return this.api.Y().V(Y)};g.d(qQC,xx);qQC.prototype.j=function(Y){return Np(Y)?$sL(this,Y):iP(Y)?YNu(this,Y):zxg(Y)?uEq(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};P9B.prototype.K=function(Y,u){var n=Y.action.actionMetadata.priority-u.action.actionMetadata.priority;n===0&&(Y.K<u.K?n=-1:Y.K>u.K&&(n=1));return n};g.d(Iy,g.e);Iy.prototype.nG=function(){this.N&&this.N();g.e.prototype.nG.call(this)};
Iy.prototype.createAction=function(Y,u){var n=g.Vw(Y.entityKey).entityType,U=g.TS(16);return new dv(n,U,Y,u.actionId,u.rootActionId)};
Iy.prototype.oV=function(Y){var u=this,n,U,k,m,X,S,C,f,Q;return g.l(function(N){if(N.j==1){if(u.gg())return N.return();U=(n=Y.offlineOrchestrationActionWrapperEntity)!=null?n:new Set;k=[];m=g.A(U);for(X=m.next();!X.done;X=m.next())S=X.value,C=g.Vw(S),f=C.entityId,fBB(u.K,f)||k.push(S);return g.D(N,AGG(u,k),2)}Q=N.K;return g.D(N,GKR(u,Q),0)})};
Iy.prototype.retry=function(){var Y=this;return g.l(function(u){return g.D(u,j0Q(Y),0)})};pPC.prototype.Wc=function(Y,u){u=u===void 0?!0:u;var n=this,U,k,m,X,S,C,f,Q;return g.l(function(N){switch(N.j){case 1:if(!n.K)return N.return();U=[];k=g.f_(n.K.j,u);m=[];for(X={Yz:0};X.Yz<k.length;X={Yz:X.Yz},X.Yz++)S=k[X.Yz],C=n.K.jY(S,"json3"),f=g.Lv(C,{withCredentials:!0,format:"RAW"},3,500).then(function(Z){return function(T){T={metadata:g.Eg(k[Z.Yz]),trackData:T.xhr.responseText};m.push(T)}}(X)).Qg(function(Z){m6("Caption fetch error",Z)}),U.push(f);
return g.D(N,W5J(U),2);case 2:return g.pY(N,3),g.D(N,QSQ(Y,m),5);case 5:g.Bc(N,0);break;case 3:Q=g.vc(N),m6("Caption DB transaction error",Q),g.KY(N)}})};g.d(zX,g.e);zX.prototype.nG=function(){this.j&&this.j();g.e.prototype.nG.call(this)};
zX.prototype.X=function(Y){var u=this,n,U,k,m,X,S,C,f;return g.l(function(Q){U=(n=Y.transfer)!=null?n:new Set;k=[];m=g.A(U);for(X=m.next();!X.done;X=m.next())S=X.value,C=g.Vw(S),f=C.entityId,k.push(f);return k.length===0?Q.return():g.D(Q,BE$(u,k),0)})};g.d(D8$,g.e);g.M=D8$.prototype;g.M.nG=function(){this.jG&&this.jG();this.DW.dispose();this.G.dispose();this.Fk&&g.aF(this.W.IA,this.Fk);this.MF&&g.aF(this.W.IA,this.MF);g.e.prototype.nG.call(this)};
g.M.isz=function(Y){var u=this,n,U,k;return g.l(function(m){switch(m.j){case 1:n=g.OV(Y,"transfer");if(u.K&&n===u.K.key){bP(u.S,u.J,!0);u.G.stop();m.qF(0);break}return g.D(m,q$(u.j,{mode:"readwrite",A_:!0},function(X){return EG(X,n,"transfer").then(function(S){if(S&&S.transferState!=="TRANSFER_STATE_COMPLETE"&&S.transferState!=="TRANSFER_STATE_FAILED")return S.transferState="TRANSFER_STATE_PAUSED_BY_USER",VI(X,S,"transfer").then(function(){return S})})}),3);
case 3:U=m.K;if(!U){m.qF(0);break}if(!Y||!u.X){m.qF(5);break}return g.D(m,TX(Y,u.X,u.j,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.D(m,H8(u,Y),7);case 7:k=m.K,bJC({videoId:Y,kO:U,offlineModeType:k}),g.KY(m)}})};
g.M.lkw=function(){var Y=this;if(this.K&&this.J){bP(this.S,this.J,!1);var u=this.K,n=(u==null?0:u.key)?g.Vw(u.key).entityId:"";n&&this.X&&(new Promise(function(U,k){TX(n,Y.X,Y.j,"DOWNLOAD_STATE_PAUSED").catch(function(m){k(m)})})).catch(function(U){m6("Download state setting error",U)})}this.G.stop()};
g.M.Si=function(){this.K?h9$(this,this.K):EB(this)};
g.M.Xv=function(Y){var u=this;return g.l(function(n){switch(n.j){case 1:if(!u.K){n.qF(2);break}if(u.K.transferState==="TRANSFER_STATE_COMPLETE"||u.K.transferState==="TRANSFER_STATE_FAILED"||!Y.transfer||!Y.transfer.has(u.K.key)){n.qF(3);break}return g.D(n,$M(u.j,u.K.key,"transfer"),4);case 4:u.K=n.K;if(u.K){n.qF(3);break}return g.D(n,wPJ(u),3);case 3:if(u.K)return n.return();case 2:return g.D(n,EB(u),0)}})};
g.M.uS=function(Y,u){var n=this,U,k,m,X,S;return g.l(function(C){switch(C.j){case 1:if(!n.K){yJ(n,"onTransferFailure: "+Y);C.qF(2);break}U=n.K;m=((k=U)==null?0:k.key)?g.Vw(U.key).entityId:"";a:switch(Y){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var f=!1;break a;default:f=!0}return f&&yGL(n)?g.D(C,VJ(n,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.D(C,
VK$(n,Y),5);case 5:if(!m||!n.X){C.qF(2);break}return g.D(C,TX(m,n.X,n.j,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.D(C,H8(n,m),9);case 9:X=C.K;fl({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:m,kO:U,offlineModeType:X});if(!m||!n.X){C.qF(2);break}return g.D(C,TX(m,n.X,n.j,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:gv(n),S=EB(n,!0),u&&u(S),g.KY(C)}})};
g.M.YY=function(Y){var u=this,n,U,k,m,X,S,C,f,Q,N,Z,T;return g.l(function(r){switch(r.j){case 1:if(!u.K){yJ(u,"onMaybeTransferStreamsExpired");r.qF(2);break}return yGL(u)?g.D(r,VJ(u,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.D(r,VK$(u,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!u.X){r.qF(2);break}n=u.K;k=((U=n)==null?0:U.key)?g.Vw(n.key).entityId:"";if(!k){r.qF(2);break}return g.D(r,TX(k,u.X,u.j,"DOWNLOAD_STATE_FAILED"),2);case 9:return u.K||yJ(u,"onMaybeTransferStreamsExpiredRetryAttempting"),
m=u.K,S=((X=m)==null?0:X.key)?g.Vw(m.key).entityId:"",g.D(r,H8(u,S),10);case 10:return C=r.K,fl({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:S,kO:m,offlineModeType:C}),f=ytG(),g.DI(f,wv,{isEnqueuedForExpiredStreamUrlRefetch:!0}),Q=g.OV(S,"playbackData"),N={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:Q,actionMetadata:f},Z=AK(new dv("playbackData",S,N)),g.D(r,aq(u.j,Z,"offlineOrchestrationActionWrapperEntity"),2);case 2:gv(u),T=EB(u,!0),
Y&&Y(T),g.KY(r)}})};
var q_$={},OE$=(q_$.TRANSFER_STATE_TRANSFERRING=1,q_$.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,q_$);g.M=OB.prototype;g.M.V2=function(){return this.J.promise};
g.M.vY=function(){if(this.j&&this.S)return this.J.promise;qNu(this).then(this.J.resolve).catch(this.J.reject);return this.J.promise};
g.M.xu=function(Y){var u={};return u.playbackData=new RW$(Y,this.xw,this.K),u.transfer=new qQC(Y,this.xw),u.videoPlaybackPositionEntity=new eWq(Y,this.xw),u};
g.M.Rw=function(){var Y=this;return g.l(function(u){return Y.j?g.D(u,x8C(Y.j),0):u.qF(0)})};
g.M.t2=function(){var Y=this,u,n;return g.l(function(U){if(U.j==1)return Y.j||Y.S?g.D(U,Y.V2(),2):U.return();Y.Z!==void 0&&(g.Zz(Y.Z),Y.Z=void 0);Y.G!==void 0&&(g.Zz(Y.G),Y.G=void 0);(u=Y.j)==null||u.dispose();Y.j=void 0;(n=Y.S)==null||n.dispose();Y.S=void 0;Y.api.Yw("onOrchestrationLostLeader");Y.J=new g.Nv;g.KY(U)})};
g.M.isOrchestrationLeader=function(){return this.X.K};
g.M.Dm=function(){return g.l(function(Y){return Y.return(!1)})};
g.M.y6=function(Y){var u=this.K;u.api.publish("offlinetransferpause",Y);var n;(n=u.j)==null||n.postMessage(Y)};
g.M.Si=function(Y){var u,n;return g.l(function(U){if(U.j==1)return g.D(U,uP(),2);u=U.K;if(!u)return U.return();n=g.OV(Y,"transfer");return g.D(U,q$(u,{mode:"readwrite",A_:!0},function(k){var m=EG(k,n,"transfer"),X=EG(k,g.OV(Y,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.s$.all([m,X]).then(function(S){S=g.A(S);var C=S.next().value;var f=S.next().value;return C&&C.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(C.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",VI(k,C,"transfer").then(function(){fl({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:Y,kO:C,offlineModeType:f==null?void 0:f.offlineModeType});return g.s$.resolve(null)})):g.s$.resolve(null)})}),0)})};
g.M.dR=function(Y){Y=Y===void 0?43200:Y;var u=this,n,U,k,m,X,S,C,f;return g.l(function(Q){if(Q.j==1)return u.W.XP()?g.D(Q,uP(),2):Q.return(aBg());if(Q.j!=3){n=Q.K;if(!n)return Q.return([]);U=Date.now()/1E3;return g.D(Q,Yx(n,"offlineVideoPolicy"),3)}k=Q.K;m=[];X=g.A(k);for(S=X.next();!S.done;S=X.next())C=S.value,Number(C.lastUpdatedTimestampSeconds)+Y<=U&&(f=g.Vw(C.key).entityId,m.push(f));return m.length?Q.return(FW(u,m,u.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):Q.return([])})};
g.M.deleteAll=function(){return FW(this,["!*$_ALL_ENTITIES_!*$"],this.N,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.M.refreshAllStaleEntities=function(Y){var u=this;return g.l(function(n){return n.j==1?g.D(n,u.dR(Y),2):n.return(n.K)})};
g.M.setUpPositionSyncInterval=function(Y){var u=this;this.G!==void 0&&(g.Zz(this.G),this.G=void 0);var n=Y!=null?Y:864E5;this.G=g.NI(function(){u.jR(n)},n)};
g.M.jR=function(Y){var u=this,n,U,k,m,X,S;return g.l(function(C){switch(C.j){case 1:return g.pY(C,2),g.D(C,Iq.getInstance(),4);case 4:n=C.K;if(!n)throw Error("prefStorage is undefined");return g.D(C,n.get("psi"),5);case 5:U=C.K;m=((k=U)==null?0:k.Po)?Number(U.Po)/1E3:0;X=Date.now();if(!(m+Y<=X)){C.qF(6);break}return g.D(C,FW(u,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.Bc(C,0);break;case 2:S=g.vc(C),m6("Offline manager error",S),
g.KY(C)}})};
g.M.Iw=function(){var Y=this,u,n,U,k,m,X,S;return g.l(function(C){if(C.j==1)return g.D(C,uP(),2);if(C.j!=3)return(u=C.K)?g.D(C,Yx(u,"transfer"),3):C.return([]);n=C.K;U=[];k=g.A(n);for(m=k.next();!m.done;m=k.next())X=m.value,X.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&X.key&&(S=g.Vw(X.key).entityId,U.push(S));return C.return(Y_$(Y,U))})};
g.M.nK=function(){return g.l(function(Y){return Y.return([])})};
g.M.vR=function(){return g.l(function(Y){g.KY(Y)})};
g.M.gU=function(){return g.l(function(Y){g.KY(Y)})};g.d(ucL,xx);ucL.prototype.j=function(Y){return Np(Y)?k6q(this,Y):iP(Y)?XQQ(this,Y):Z6(Y)?PYB(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};
var JK=[10];g.d(Ns$,xx);Ns$.prototype.j=function(Y){return Np(Y)?TsR(this,Y):iP(Y)?rwL(this,Y):Z6(Y)?MuL(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};
var ZNB=[10];g.d(ddg,xx);ddg.prototype.j=function(Y){return iP(Y)?AwB(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};g.d(jJu,OB);g.M=jJu.prototype;g.M.xu=function(Y){var u=OB.prototype.xu.call(this,Y);u.mainVideoEntity=new Ns$(Y,this.xw,this.K);u.mainPlaylistEntity=new ucL(Y,this.xw,this.K);u.mainDownloadsListEntity=new ddg(Y,this.xw,this.K);return u};
g.M.refreshAllStaleEntities=function(Y,u){var n=this,U,k,m,X,S,C,f,Q,N,Z,T;return g.l(function(r){switch(r.j){case 1:U=[];if(!n.xw.V("web_player_offline_playlist_auto_refresh")){r.qF(2);break}return g.D(r,KDJ(n,Y,u),3);case 3:U=r.K;case 2:return g.D(r,Iq.getInstance(),4);case 4:return k=r.K,g.D(r,(m=k)==null?void 0:m.get("sdois"),5);case 5:return X=r.K,g.D(r,(S=k)==null?void 0:S.get("lmqf"),6);case 6:C=r.K;if(!X){r.qF(7);break}Q=U;N=Q.concat;return g.D(r,pQC(n,X,(f=C)!=null?f:"SD",Y===0),8);case 8:U=
N.call(Q,r.K);case 7:return Z=U,T=Z.concat,g.D(r,OB.prototype.refreshAllStaleEntities.call(n,Y,u),9);case 9:return U=T.call(Z,r.K),r.return(U)}})};
g.M.Dm=function(Y){var u,n,U,k,m,X,S,C;return g.l(function(f){if(f.j==1)return g.D(f,uP(),2);if(f.j!=3)return(u=f.K)?g.D(f,$M(u,g.IM,"mainDownloadsListEntity"),3):f.return(!1);n=f.K;if((U=n)==null?0:(k=U.downloads)==null?0:k.length)for(m=g.OV(Y,"mainVideoEntity"),X=g.A(n.downloads),S=X.next();!S.done;S=X.next())if(C=S.value,C.videoItem===m)return f.return(!0);return f.return(!1)})};
g.M.nK=function(){var Y=this,u,n,U,k,m,X,S,C;return g.l(function(f){if(f.j==1)return g.D(f,uP(),2);if(f.j!=3)return(u=f.K)?g.D(f,Yx(u,"downloadStatusEntity"),3):f.return([]);n=f.K;U=[];k=g.A(n);for(m=k.next();!m.done;m=k.next())X=m.value,X.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&X.key&&(S=g.Vw(X.key).entityId,U.push(S));return U.length?(C={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},f.return(FW(Y,U,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
C))):f.return([])})};
g.M.gU=function(){var Y;return g.l(function(u){return u.j==1?g.D(u,uP(),2):(Y=u.K)?g.D(u,q$(Y,{mode:"readwrite",A_:!0},function(n){return H$(n,"mainVideoEntity").then(function(U){var k=[];U=g.A(U);for(var m=U.next();!m.done;m=U.next()){m=m.value;var X=void 0;(X=m.userState)!=null&&X.playbackPosition||(X=g.Vw(m.key).entityId,X={key:g.OV(X,"videoPlaybackPositionEntity"),videoId:X,lastPlaybackPositionSeconds:"0"},k.push(VI(n,X,"videoPlaybackPositionEntity")),m.userState={playbackPosition:X.key},k.push(VI(n,
m,"mainVideoEntity")))}return g.s$.all(k)})}),0):u.return()})};
g.M.vR=function(){var Y,u,n,U,k,m,X,S,C,f,Q,N,Z,T,r,K,L,R,c,x,W,E,J,O,Xd,T0,SM,CY,uB,cc,J7,uQ,sq,CR,Du,XH,Wu,Hu;return g.l(function(Pq){if(Pq.j==1)return g.D(Pq,uP(),2);if(Pq.j!=3){Y=Pq.K;if(!Y)return Pq.return();u=g.OV("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.D(Pq,q$(Y,{mode:"readonly",A_:!0},function(v){return g.s$.all([EG(v,u,"mainDownloadsListEntity"),EG(v,g.IM,"mainDownloadsListEntity"),H$(v,"mainVideoEntity"),H$(v,"mainPlaylistEntity")])}),3)}n=Pq.K;
U=g.A(n);k=U.next().value;m=U.next().value;X=U.next().value;S=U.next().value;C=k;f=m;Q=X;N=S;Z=new Set;if((T=C)==null?0:(r=T.downloads)==null?0:r.length)for(K=g.A(C.downloads),L=K.next();!L.done;L=K.next())R=L.value,c=void 0,(x=(c=R.videoItem)!=null?c:R.playlistItem)&&Z.add(x);if((W=f)==null?0:(E=W.downloads)==null?0:E.length)for(J=g.A(f.downloads),O=J.next();!O.done;O=J.next())Xd=O.value,Xd.videoItem&&Z.add(Xd.videoItem);T0=new Set;SM=[];CY=g.A(N);for(uB=CY.next();!uB.done;uB=CY.next()){cc=uB.value;
if(cc.videos)for(J7=g.A(cc.videos),uQ=J7.next();!uQ.done;uQ=J7.next())sq=uQ.value,(CR=JSON.parse(g.Vw(sq).entityId).videoId)&&T0.add(CR);cc.key&&!Z.has(cc.key)&&SM.push(cc.key)}Du=g.A(Q);for(XH=Du.next();!XH.done;XH=Du.next())Wu=XH.value,Wu.key&&!Z.has(Wu.key)&&(Hu=g.Vw(Wu.key).entityId,T0.has(Hu)||SM.push(Wu.key));return SM.length?g.D(Pq,msu(Y,SM),0):Pq.qF(0)})};g.d(LDu,xx);LDu.prototype.j=function(Y){return Np(Y)?BsR(this,Y):iP(Y)?oKX(this,Y):Z6(Y)?cwu(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};
var ay=[10];g.d(RhX,xx);RhX.prototype.j=function(Y){return Np(Y)?xdG(this,Y):iP(Y)?lCB(this,Y):Z6(Y)?hh$(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};
var $x=[10];g.d(ehX,xx);ehX.prototype.j=function(Y){return Np(Y)?gKR(this,Y):iP(Y)?EKL(this,Y):Z6(Y)?HNu(this,Y):Promise.reject(Error("Unsupported action type: "+Y.actionType))};
var zhy=[10];g.d(Y2,OB);Y2.prototype.xu=function(Y){var u=OB.prototype.xu.call(this,Y);u.musicTrack=new ehX(Y,this.K);u.musicPlaylist=new RhX(Y,this.K);u.musicAlbumRelease=new LDu(Y,this.K);return u};
Y2.prototype.refreshAllStaleEntities=function(Y,u){var n=this,U,k,m;return g.l(function(X){if(X.j==1)return g.D(X,Vu$(n,Y,u),2);if(X.j!=3)return k=U=X.K,m=k.concat,g.D(X,OB.prototype.refreshAllStaleEntities.call(n,Y,u),3);U=m.call(k,X.K);return X.return(U)})};g.d(ONB,g.vH);g.M=ONB.prototype;g.M.create=function(){var Y=this;g.b(this,this.events);if(g.KV(this.xw))this.K=new jJu(this.xw,this.player);else if(g.R8(this.xw)||g.LV(this.xw))this.K=new Y2(this.xw,this.player);this.events.B(this.player,"onPlaybackStartExternal",function(){Y.uA()});
this.events.B(this.player,"videodatachange",function(){Y.uA()});
this.xw.V("html5_offline_playback_position_sync")&&this.events.B(this.player,"presentingplayerstatechange",this.I1)};
g.M.VO=function(){return!1};
g.M.LD=function(Y,u,n,U){var k=this;return g.l(function(m){return k.K?m.return(FW(k.K,Y,u,n,U)):m.return(Promise.reject())})};
g.M.deleteAll=function(){return this.K.deleteAll()};
g.M.dR=function(Y){return this.K.dR(Y)};
g.M.refreshAllStaleEntities=function(Y){return this.K.refreshAllStaleEntities(Y)};
g.M.setUpPositionSyncInterval=function(Y){this.K.setUpPositionSyncInterval(Y)};
g.M.y6=function(Y){this.K.y6(Y)};
g.M.Si=function(Y){return this.K.Si(Y)};
g.M.uA=function(){var Y=this,u;return g.l(function(n){u=Y.player.getVideoData();return g.d6(u)?FD$(u)&&Y.j!==u.clientPlaybackNonce?g.D(n,JwX(Y,u),0):n.qF(0):n.return()})};
g.M.I1=function(Y){var u=this,n,U,k,m,X,S,C;return g.l(function(f){if(f.j==1)return n=u.player.getVideoData(),U=n.yY,g.C1(Y,2)||g.C1(Y,512)?g.D(f,uP(),2):f.return();if(f.j!=3){k=f.K;if(!k)return m6("PES is undefined"),f.return();m=n.videoId;return g.D(f,$M(k,g.OV(m,"mainVideoEntity"),"mainVideoEntity"),3)}X=f.K;if(!X)return f.return();S=Math.floor(U).toString();C={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:S}};return g.D(f,u.LD([m],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
C),0)})};
g.M.isOrchestrationLeader=function(){return this.K.isOrchestrationLeader()};
g.M.updateDownloadState=function(Y,u){var n,U,k,m;return g.l(function(X){if(X.j==1)return g.D(X,uP(),2);n=X.K;if(!n)return m6("PES is undefined"),X.return();U=g.Vw(Y);k=U.entityType;m=U.entityId;return g.D(X,TX(m,k,n,u,!0),0)})};g.cH("offline",ONB);})(_yt_player);
